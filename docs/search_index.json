[
["index.html", "1 Chapter 1", " 1 Chapter 1 #-*- R -*- library(nlme) #pdf(file = &#39;ch01.pdf&#39;) options( width = 65, digits = 5 ) options( contrasts = c(unordered = &quot;contr.helmert&quot;, ordered = &quot;contr.poly&quot;) ) # Chapter 1 Linear Mixed-Effects Models: Basic Concepts and Examples # 1.1 A Simple Example of Random Effects Rail ## Grouped Data: travel ~ 1 | Rail ## Rail travel ## 1 1 55 ## 2 1 53 ## 3 1 54 ## 4 2 26 ## 5 2 37 ## 6 2 32 ## 7 3 78 ## 8 3 91 ## 9 3 85 ## 10 4 92 ## 11 4 100 ## 12 4 96 ## 13 5 49 ## 14 5 51 ## 15 5 50 ## 16 6 80 ## 17 6 85 ## 18 6 83 fm1Rail.lm &lt;- lm( travel ~ 1, data = Rail ) fm1Rail.lm ## ## Call: ## lm(formula = travel ~ 1, data = Rail) ## ## Coefficients: ## (Intercept) ## 66.5 fm2Rail.lm &lt;- lm( travel ~ Rail - 1, data = Rail ) fm2Rail.lm ## ## Call: ## lm(formula = travel ~ Rail - 1, data = Rail) ## ## Coefficients: ## Rail2 Rail5 Rail1 Rail6 Rail3 Rail4 ## 31.7 50.0 54.0 82.7 84.7 96.0 fm1Rail.lme &lt;- lme(travel ~ 1, data = Rail, random = ~ 1 | Rail) summary( fm1Rail.lme ) ## Linear mixed-effects model fit by REML ## Data: Rail ## AIC BIC logLik ## 128.18 130.68 -61.089 ## ## Random effects: ## Formula: ~1 | Rail ## (Intercept) Residual ## StdDev: 24.805 4.0208 ## ## Fixed effects: travel ~ 1 ## Value Std.Error DF t-value p-value ## (Intercept) 66.5 10.171 12 6.5382 0 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.618827 -0.282177 0.035693 0.219558 1.614377 ## ## Number of Observations: 18 ## Number of Groups: 6 fm1Rail.lmeML &lt;- update( fm1Rail.lme, method = &quot;ML&quot; ) summary( fm1Rail.lmeML ) ## Linear mixed-effects model fit by maximum likelihood ## Data: Rail ## AIC BIC logLik ## 134.56 137.23 -64.28 ## ## Random effects: ## Formula: ~1 | Rail ## (Intercept) Residual ## StdDev: 22.624 4.0208 ## ## Fixed effects: travel ~ 1 ## Value Std.Error DF t-value p-value ## (Intercept) 66.5 9.554 12 6.9604 0 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.610981 -0.288870 0.034542 0.213728 1.622223 ## ## Number of Observations: 18 ## Number of Groups: 6 plot( fm1Rail.lme ) # produces Figure 1.4 intervals( fm1Rail.lme ) ## Approximate 95% confidence intervals ## ## Fixed effects: ## lower est. upper ## (Intercept) 44.339 66.5 88.661 ## attr(,&quot;label&quot;) ## [1] &quot;Fixed effects:&quot; ## ## Random Effects: ## Level: Rail ## lower est. upper ## sd((Intercept)) 13.274 24.805 46.353 ## ## Within-group standard error: ## lower est. upper ## 2.6950 4.0208 5.9987 anova( fm1Rail.lme ) ## numDF denDF F-value p-value ## (Intercept) 1 12 42.748 &lt;.0001 # 1.2 A Randomized Block Design plot.design( ergoStool ) # produces Figure 1.6 contrasts( ergoStool$Type ) ## [,1] [,2] [,3] ## T1 -1 -1 -1 ## T2 1 -1 -1 ## T3 0 2 -1 ## T4 0 0 3 ergoStool1 &lt;- ergoStool[ ergoStool$Subject == &quot;1&quot;, ] model.matrix( effort ~ Type, ergoStool1 ) # X matrix for Subject 1 ## (Intercept) Type1 Type2 Type3 ## 1 1 -1 -1 -1 ## 2 1 1 -1 -1 ## 3 1 0 2 -1 ## 4 1 0 0 3 ## attr(,&quot;assign&quot;) ## [1] 0 1 1 1 ## attr(,&quot;contrasts&quot;) ## attr(,&quot;contrasts&quot;)$Type ## [1] &quot;contr.helmert&quot; fm1Stool &lt;- lme(effort ~ Type, data = ergoStool, random = ~ 1 | Subject) summary( fm1Stool ) ## Linear mixed-effects model fit by REML ## Data: ergoStool ## AIC BIC logLik ## 139.49 148.28 -63.743 ## ## Random effects: ## Formula: ~1 | Subject ## (Intercept) Residual ## StdDev: 1.3325 1.1003 ## ## Fixed effects: effort ~ Type ## Value Std.Error DF t-value p-value ## (Intercept) 10.2500 0.48052 24 21.3309 0.0000 ## Type1 1.9444 0.25934 24 7.4976 0.0000 ## Type2 0.0926 0.14973 24 0.6184 0.5421 ## Type3 -0.3426 0.10588 24 -3.2358 0.0035 ## Correlation: ## (Intr) Type1 Type2 ## Type1 0 ## Type2 0 0 ## Type3 0 0 0 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.802003 -0.643166 0.057831 0.700997 1.631421 ## ## Number of Observations: 36 ## Number of Groups: 9 anova( fm1Stool ) ## numDF denDF F-value p-value ## (Intercept) 1 24 455.01 &lt;.0001 ## Type 3 24 22.36 &lt;.0001 options( contrasts = c( factor = &quot;contr.treatment&quot;, ordered = &quot;contr.poly&quot; ) ) contrasts( ergoStool$Type ) ## T2 T3 T4 ## T1 0 0 0 ## T2 1 0 0 ## T3 0 1 0 ## T4 0 0 1 fm2Stool &lt;- lme(effort ~ Type, data = ergoStool, random = ~ 1 | Subject) summary( fm2Stool ) ## Linear mixed-effects model fit by REML ## Data: ergoStool ## AIC BIC logLik ## 133.13 141.93 -60.565 ## ## Random effects: ## Formula: ~1 | Subject ## (Intercept) Residual ## StdDev: 1.3325 1.1003 ## ## Fixed effects: effort ~ Type ## Value Std.Error DF t-value p-value ## (Intercept) 8.5556 0.57601 24 14.8531 0.0000 ## TypeT2 3.8889 0.51868 24 7.4976 0.0000 ## TypeT3 2.2222 0.51868 24 4.2843 0.0003 ## TypeT4 0.6667 0.51868 24 1.2853 0.2110 ## Correlation: ## (Intr) TypeT2 TypeT3 ## TypeT2 -0.45 ## TypeT3 -0.45 0.50 ## TypeT4 -0.45 0.50 0.50 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.802003 -0.643166 0.057831 0.700997 1.631421 ## ## Number of Observations: 36 ## Number of Groups: 9 anova( fm2Stool ) ## numDF denDF F-value p-value ## (Intercept) 1 24 455.01 &lt;.0001 ## Type 3 24 22.36 &lt;.0001 model.matrix( effort ~ Type - 1, ergoStool1 ) ## TypeT1 TypeT2 TypeT3 TypeT4 ## 1 1 0 0 0 ## 2 0 1 0 0 ## 3 0 0 1 0 ## 4 0 0 0 1 ## attr(,&quot;assign&quot;) ## [1] 1 1 1 1 ## attr(,&quot;contrasts&quot;) ## attr(,&quot;contrasts&quot;)$Type ## [1] &quot;contr.treatment&quot; fm3Stool &lt;- lme(effort ~ Type - 1, data = ergoStool, random = ~ 1 | Subject) summary( fm3Stool ) ## Linear mixed-effects model fit by REML ## Data: ergoStool ## AIC BIC logLik ## 133.13 141.93 -60.565 ## ## Random effects: ## Formula: ~1 | Subject ## (Intercept) Residual ## StdDev: 1.3325 1.1003 ## ## Fixed effects: effort ~ Type - 1 ## Value Std.Error DF t-value p-value ## TypeT1 8.5556 0.57601 24 14.853 0 ## TypeT2 12.4444 0.57601 24 21.605 0 ## TypeT3 10.7778 0.57601 24 18.711 0 ## TypeT4 9.2222 0.57601 24 16.011 0 ## Correlation: ## TypeT1 TypeT2 TypeT3 ## TypeT2 0.595 ## TypeT3 0.595 0.595 ## TypeT4 0.595 0.595 0.595 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.802003 -0.643166 0.057831 0.700997 1.631421 ## ## Number of Observations: 36 ## Number of Groups: 9 anova( fm3Stool ) ## numDF denDF F-value p-value ## Type 4 24 130.52 &lt;.0001 intervals( fm1Stool ) ## Approximate 95% confidence intervals ## ## Fixed effects: ## lower est. upper ## (Intercept) 9.25825 10.250000 11.24175 ## Type1 1.40919 1.944444 2.47970 ## Type2 -0.21644 0.092593 0.40162 ## Type3 -0.56111 -0.342593 -0.12408 ## attr(,&quot;label&quot;) ## [1] &quot;Fixed effects:&quot; ## ## Random Effects: ## Level: Subject ## lower est. upper ## sd((Intercept)) 0.74947 1.3325 2.369 ## ## Within-group standard error: ## lower est. upper ## 0.82946 1.10029 1.45957 plot( fm1Stool, # produces Figure 1.8 form = resid(., type = &quot;p&quot;) ~ fitted(.) | Subject, abline = 0 ) # 1.3 Mixed-effects Models for Replicated, Blocked Designs with(Machines, interaction.plot( Machine, Worker, score, las = 1)) # Figure 1.10 fm1Machine &lt;- lme( score ~ Machine, data = Machines, random = ~ 1 | Worker ) fm1Machine ## Linear mixed-effects model fit by REML ## Data: Machines ## Log-restricted-likelihood: -143.44 ## Fixed: score ~ Machine ## (Intercept) MachineB MachineC ## 52.3556 7.9667 13.9167 ## ## Random effects: ## Formula: ~1 | Worker ## (Intercept) Residual ## StdDev: 5.1466 3.1616 ## ## Number of Observations: 54 ## Number of Groups: 6 fm2Machine &lt;- update( fm1Machine, random = ~ 1 | Worker/Machine ) fm2Machine ## Linear mixed-effects model fit by REML ## Data: Machines ## Log-restricted-likelihood: -107.84 ## Fixed: score ~ Machine ## (Intercept) MachineB MachineC ## 52.3556 7.9667 13.9167 ## ## Random effects: ## Formula: ~1 | Worker ## (Intercept) ## StdDev: 4.781 ## ## Formula: ~1 | Machine %in% Worker ## (Intercept) Residual ## StdDev: 3.7295 0.96158 ## ## Number of Observations: 54 ## Number of Groups: ## Worker Machine %in% Worker ## 6 18 anova( fm1Machine, fm2Machine ) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm1Machine 1 5 296.88 306.54 -143.44 ## fm2Machine 2 6 227.69 239.28 -107.84 1 vs 2 71.191 &lt;.0001 ## delete selected rows from the Machines data MachinesUnbal &lt;- Machines[ -c(2,3,6,8,9,12,19,20,27,33), ] ## check that the result is indeed unbalanced table(MachinesUnbal$Machine, MachinesUnbal$Worker) ## ## 6 2 4 1 3 5 ## A 3 2 2 1 1 3 ## B 3 3 3 1 2 2 ## C 3 3 3 3 3 3 fm1MachinesU &lt;- lme( score ~ Machine, data = MachinesUnbal, random = ~ 1 | Worker/Machine ) fm1MachinesU ## Linear mixed-effects model fit by REML ## Data: MachinesUnbal ## Log-restricted-likelihood: -90.936 ## Fixed: score ~ Machine ## (Intercept) MachineB MachineC ## 52.3540 7.9624 13.9182 ## ## Random effects: ## Formula: ~1 | Worker ## (Intercept) ## StdDev: 4.7387 ## ## Formula: ~1 | Machine %in% Worker ## (Intercept) Residual ## StdDev: 3.7728 0.9332 ## ## Number of Observations: 44 ## Number of Groups: ## Worker Machine %in% Worker ## 6 18 intervals( fm1MachinesU ) ## Approximate 95% confidence intervals ## ## Fixed effects: ## lower est. upper ## (Intercept) 47.2345 52.3540 57.474 ## MachineB 3.0278 7.9624 12.897 ## MachineC 8.9955 13.9182 18.841 ## attr(,&quot;label&quot;) ## [1] &quot;Fixed effects:&quot; ## ## Random Effects: ## Level: Worker ## lower est. upper ## sd((Intercept)) 2.2163 4.7387 10.132 ## Level: Machine ## lower est. upper ## sd((Intercept)) 2.4092 3.7728 5.9083 ## ## Within-group standard error: ## lower est. upper ## 0.71136 0.93320 1.22424 fm4Stool &lt;- lme( effort ~ Type, ergoStool, ~ 1 | Subject/Type ) if (interactive()) intervals( fm4Stool ) (fm1Stool$sigma)^2 ## [1] 1.2106 (fm4Stool$sigma)^2 + 0.79621^2 ## [1] 0.84554 Machine1 &lt;- Machines[ Machines$Worker == &quot;1&quot;, ] model.matrix( score ~ Machine, Machine1 ) # fixed-effects X_i ## (Intercept) MachineB MachineC ## 1 1 0 0 ## 2 1 0 0 ## 3 1 0 0 ## 19 1 1 0 ## 20 1 1 0 ## 21 1 1 0 ## 37 1 0 1 ## 38 1 0 1 ## 39 1 0 1 ## attr(,&quot;assign&quot;) ## [1] 0 1 1 ## attr(,&quot;contrasts&quot;) ## attr(,&quot;contrasts&quot;)$Machine ## [1] &quot;contr.treatment&quot; model.matrix( ~ Machine - 1, Machine1 ) # random-effects Z_i ## MachineA MachineB MachineC ## 1 1 0 0 ## 2 1 0 0 ## 3 1 0 0 ## 19 0 1 0 ## 20 0 1 0 ## 21 0 1 0 ## 37 0 0 1 ## 38 0 0 1 ## 39 0 0 1 ## attr(,&quot;assign&quot;) ## [1] 1 1 1 ## attr(,&quot;contrasts&quot;) ## attr(,&quot;contrasts&quot;)$Machine ## [1] &quot;contr.treatment&quot; fm3Machine &lt;- update( fm1Machine, random = ~Machine - 1 |Worker) summary( fm3Machine ) ## Linear mixed-effects model fit by REML ## Data: Machines ## AIC BIC logLik ## 228.31 247.63 -104.16 ## ## Random effects: ## Formula: ~Machine - 1 | Worker ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## MachineA 4.07928 MachnA MachnB ## MachineB 8.62529 0.803 ## MachineC 4.38948 0.623 0.771 ## Residual 0.96158 ## ## Fixed effects: score ~ Machine ## Value Std.Error DF t-value p-value ## (Intercept) 52.356 1.6807 46 31.1508 0.0000 ## MachineB 7.967 2.4209 46 3.2909 0.0019 ## MachineC 13.917 1.5401 46 9.0362 0.0000 ## Correlation: ## (Intr) MachnB ## MachineB 0.463 ## MachineC -0.374 0.301 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.393540 -0.513776 0.026908 0.472455 2.533387 ## ## Number of Observations: 54 ## Number of Groups: 6 anova( fm1Machine, fm2Machine, fm3Machine ) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm1Machine 1 5 296.88 306.54 -143.44 ## fm2Machine 2 6 227.69 239.28 -107.84 1 vs 2 71.191 &lt;.0001 ## fm3Machine 3 10 228.31 247.63 -104.16 2 vs 3 7.376 0.1173 # 1.4 An Analysis of Covariance Model names( Orthodont ) ## [1] &quot;distance&quot; &quot;age&quot; &quot;Subject&quot; &quot;Sex&quot; levels( Orthodont$Sex ) ## [1] &quot;Male&quot; &quot;Female&quot; OrthoFem &lt;- Orthodont[ Orthodont$Sex == &quot;Female&quot;, ] fm1OrthF.lis &lt;- lmList( distance ~ age, data = OrthoFem ) coef( fm1OrthF.lis ) ## (Intercept) age ## F10 13.55 0.450 ## F09 18.10 0.275 ## F06 17.00 0.375 ## F01 17.25 0.375 ## F05 19.60 0.275 ## F07 16.95 0.550 ## F02 14.20 0.800 ## F08 21.45 0.175 ## F03 14.40 0.850 ## F04 19.65 0.475 ## F11 18.95 0.675 intervals( fm1OrthF.lis ) ## , , (Intercept) ## ## lower est. upper ## F10 10.071 13.55 17.029 ## F09 14.621 18.10 21.579 ## F06 13.521 17.00 20.479 ## F01 13.771 17.25 20.729 ## F05 16.121 19.60 23.079 ## F07 13.471 16.95 20.429 ## F02 10.721 14.20 17.679 ## F08 17.971 21.45 24.929 ## F03 10.921 14.40 17.879 ## F04 16.171 19.65 23.129 ## F11 15.471 18.95 22.429 ## ## , , age ## ## lower est. upper ## F10 0.1401 0.450 0.7599 ## F09 -0.0349 0.275 0.5849 ## F06 0.0651 0.375 0.6849 ## F01 0.0651 0.375 0.6849 ## F05 -0.0349 0.275 0.5849 ## F07 0.2401 0.550 0.8599 ## F02 0.4901 0.800 1.1099 ## F08 -0.1349 0.175 0.4849 ## F03 0.5401 0.850 1.1599 ## F04 0.1651 0.475 0.7849 ## F11 0.3651 0.675 0.9849 plot( intervals ( fm1OrthF.lis ) ) # produces Figure 1.12 fm2OrthF.lis &lt;- update( fm1OrthF.lis, distance ~ I( age - 11 ) ) plot( intervals( fm2OrthF.lis ) ) # produces Figure 1.13 fm1OrthF &lt;- lme( distance ~ age, data = OrthoFem, random = ~ 1 | Subject ) summary( fm1OrthF ) ## Linear mixed-effects model fit by REML ## Data: OrthoFem ## AIC BIC logLik ## 149.22 156.17 -70.609 ## ## Random effects: ## Formula: ~1 | Subject ## (Intercept) Residual ## StdDev: 2.0685 0.78003 ## ## Fixed effects: distance ~ age ## Value Std.Error DF t-value p-value ## (Intercept) 17.3727 0.85874 32 20.2304 0 ## age 0.4795 0.05259 32 9.1186 0 ## Correlation: ## (Intr) ## age -0.674 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.27365 -0.70902 0.17282 0.41221 1.63252 ## ## Number of Observations: 44 ## Number of Groups: 11 fm1OrthFM &lt;- update( fm1OrthF, method = &quot;ML&quot; ) summary( fm1OrthFM ) ## Linear mixed-effects model fit by maximum likelihood ## Data: OrthoFem ## AIC BIC logLik ## 146.03 153.17 -69.015 ## ## Random effects: ## Formula: ~1 | Subject ## (Intercept) Residual ## StdDev: 1.9699 0.76812 ## ## Fixed effects: distance ~ age ## Value Std.Error DF t-value p-value ## (Intercept) 17.3727 0.85063 32 20.4234 0 ## age 0.4795 0.05301 32 9.0471 0 ## Correlation: ## (Intr) ## age -0.685 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.30562 -0.71924 0.17636 0.42580 1.66894 ## ## Number of Observations: 44 ## Number of Groups: 11 fm2OrthF &lt;- update( fm1OrthF, random = ~ age | Subject ) anova( fm1OrthF, fm2OrthF ) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm1OrthF 1 4 149.22 156.17 -70.609 ## fm2OrthF 2 6 149.43 159.85 -68.714 1 vs 2 3.7896 0.1503 random.effects( fm1OrthF ) ## (Intercept) ## F10 -4.005329 ## F09 -1.470449 ## F06 -1.470449 ## F01 -1.229032 ## F05 -0.021947 ## F07 0.340179 ## F02 0.340179 ## F08 0.702304 ## F03 1.064430 ## F04 2.150807 ## F11 3.599309 ranef( fm1OrthFM ) ## (Intercept) ## F10 -3.995835 ## F09 -1.466964 ## F06 -1.466964 ## F01 -1.226119 ## F05 -0.021895 ## F07 0.339372 ## F02 0.339372 ## F08 0.700640 ## F03 1.061907 ## F04 2.145709 ## F11 3.590778 coef( fm1OrthF ) ## (Intercept) age ## F10 13.367 0.47955 ## F09 15.902 0.47955 ## F06 15.902 0.47955 ## F01 16.144 0.47955 ## F05 17.351 0.47955 ## F07 17.713 0.47955 ## F02 17.713 0.47955 ## F08 18.075 0.47955 ## F03 18.437 0.47955 ## F04 19.524 0.47955 ## F11 20.972 0.47955 plot( compareFits(coef(fm1OrthF), coef(fm1OrthFM))) # Figure 1.15 plot( augPred(fm1OrthF), aspect = &quot;xy&quot;, grid = TRUE ) # Figure 1.16 # 1.5 Models for Nested Classification Factors fm1Pixel &lt;- lme( pixel ~ day + I(day^2), data = Pixel, random = list( Dog = ~ day, Side = ~ 1 ) ) intervals( fm1Pixel ) ## Approximate 95% confidence intervals ## ## Fixed effects: ## lower est. upper ## (Intercept) 1053.0968 1073.33914 1093.5814 ## day 4.3797 6.12960 7.8795 ## I(day^2) -0.4349 -0.36735 -0.2998 ## attr(,&quot;label&quot;) ## [1] &quot;Fixed effects:&quot; ## ## Random Effects: ## Level: Dog ## lower est. upper ## sd((Intercept)) 15.92962 28.36990 50.52546 ## sd(day) 1.08150 1.84375 3.14324 ## cor((Intercept),day) -0.89435 -0.55472 0.19053 ## Level: Side ## lower est. upper ## sd((Intercept)) 10.417 16.824 27.172 ## ## Within-group standard error: ## lower est. upper ## 7.6345 8.9896 10.5852 plot( augPred( fm1Pixel ) ) # produces Figure 1.18 VarCorr( fm1Pixel ) ## Variance StdDev Corr ## Dog = pdLogChol(day) ## (Intercept) 804.8514 28.3699 (Intr) ## day 3.3994 1.8438 -0.555 ## Side = pdLogChol(1) ## (Intercept) 283.0572 16.8243 ## Residual 80.8130 8.9896 summary( fm1Pixel ) ## Linear mixed-effects model fit by REML ## Data: Pixel ## AIC BIC logLik ## 841.21 861.97 -412.61 ## ## Random effects: ## Formula: ~day | Dog ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 28.3699 (Intr) ## day 1.8438 -0.555 ## ## Formula: ~1 | Side %in% Dog ## (Intercept) Residual ## StdDev: 16.824 8.9896 ## ## Fixed effects: pixel ~ day + I(day^2) ## Value Std.Error DF t-value p-value ## (Intercept) 1073.34 10.1717 80 105.522 0 ## day 6.13 0.8793 80 6.971 0 ## I(day^2) -0.37 0.0339 80 -10.822 0 ## Correlation: ## (Intr) day ## day -0.517 ## I(day^2) 0.186 -0.668 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.829057 -0.449181 0.025549 0.557216 2.751965 ## ## Number of Observations: 102 ## Number of Groups: ## Dog Side %in% Dog ## 10 20 fm2Pixel &lt;- update( fm1Pixel, random = ~ day | Dog) anova( fm1Pixel, fm2Pixel ) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm1Pixel 1 8 841.21 861.97 -412.61 ## fm2Pixel 2 7 884.52 902.69 -435.26 1 vs 2 45.309 &lt;.0001 fm3Pixel &lt;- update( fm1Pixel, random = ~ 1 | Dog/Side ) anova( fm1Pixel, fm3Pixel ) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm1Pixel 1 8 841.21 861.97 -412.61 ## fm3Pixel 2 6 876.84 892.41 -432.42 1 vs 2 39.629 &lt;.0001 fm4Pixel &lt;- update( fm1Pixel, pixel ~ day + I(day^2) + Side ) summary( fm4Pixel ) ## Linear mixed-effects model fit by REML ## Data: Pixel ## AIC BIC logLik ## 835.85 859.12 -408.93 ## ## Random effects: ## Formula: ~day | Dog ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 28.4636 (Intr) ## day 1.8438 -0.553 ## ## Formula: ~1 | Side %in% Dog ## (Intercept) Residual ## StdDev: 16.507 8.9836 ## ## Fixed effects: pixel ~ day + I(day^2) + Side ## Value Std.Error DF t-value p-value ## (Intercept) 1077.95 10.8627 80 99.234 0.0000 ## day 6.13 0.8790 80 6.973 0.0000 ## I(day^2) -0.37 0.0339 80 -10.829 0.0000 ## SideR -9.22 7.6268 9 -1.209 0.2576 ## Correlation: ## (Intr) day I(d^2) ## day -0.484 ## I(day^2) 0.174 -0.667 ## SideR -0.351 0.000 0.000 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.809825 -0.471334 0.026103 0.541154 2.774701 ## ## Number of Observations: 102 ## Number of Groups: ## Dog Side %in% Dog ## 10 20 # 1.6 A Split-Plot Experiment fm1Oats &lt;- lme( yield ~ ordered(nitro) * Variety, data = Oats, random = ~ 1 | Block/Variety ) anova( fm1Oats ) ## numDF denDF F-value p-value ## (Intercept) 1 45 245.143 &lt;.0001 ## ordered(nitro) 3 45 37.686 &lt;.0001 ## Variety 2 10 1.485 0.2724 ## ordered(nitro):Variety 6 45 0.303 0.9322 fm2Oats &lt;- update( fm1Oats, yield ~ ordered(nitro) + Variety ) anova( fm2Oats ) ## numDF denDF F-value p-value ## (Intercept) 1 51 245.145 &lt;.0001 ## ordered(nitro) 3 51 41.053 &lt;.0001 ## Variety 2 10 1.485 0.2724 summary( fm2Oats ) ## Linear mixed-effects model fit by REML ## Data: Oats ## AIC BIC logLik ## 587.46 607.16 -284.73 ## ## Random effects: ## Formula: ~1 | Block ## (Intercept) ## StdDev: 14.645 ## ## Formula: ~1 | Variety %in% Block ## (Intercept) Residual ## StdDev: 10.473 12.75 ## ## Fixed effects: yield ~ ordered(nitro) + Variety ## Value Std.Error DF t-value p-value ## (Intercept) 104.500 7.7975 51 13.4017 0.0000 ## ordered(nitro).L 32.945 3.0052 51 10.9627 0.0000 ## ordered(nitro).Q -5.167 3.0052 51 -1.7193 0.0916 ## ordered(nitro).C -0.447 3.0052 51 -0.1488 0.8823 ## VarietyMarvellous 5.292 7.0789 10 0.7475 0.4720 ## VarietyVictory -6.875 7.0789 10 -0.9712 0.3544 ## Correlation: ## (Intr) or().L or().Q or().C VrtyMr ## ordered(nitro).L 0.000 ## ordered(nitro).Q 0.000 0.000 ## ordered(nitro).C 0.000 0.000 0.000 ## VarietyMarvellous -0.454 0.000 0.000 0.000 ## VarietyVictory -0.454 0.000 0.000 0.000 0.500 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.841341 -0.662797 -0.066943 0.638225 1.660668 ## ## Number of Observations: 72 ## Number of Groups: ## Block Variety %in% Block ## 6 18 fm3Oats &lt;- update( fm1Oats, yield ~ ordered( nitro ) ) summary( fm3Oats ) ## Linear mixed-effects model fit by REML ## Data: Oats ## AIC BIC logLik ## 597.61 613.14 -291.8 ## ## Random effects: ## Formula: ~1 | Block ## (Intercept) ## StdDev: 14.506 ## ## Formula: ~1 | Variety %in% Block ## (Intercept) Residual ## StdDev: 11.039 12.75 ## ## Fixed effects: yield ~ ordered(nitro) ## Value Std.Error DF t-value p-value ## (Intercept) 103.972 6.6407 51 15.6569 0.0000 ## ordered(nitro).L 32.945 3.0052 51 10.9627 0.0000 ## ordered(nitro).Q -5.167 3.0052 51 -1.7193 0.0916 ## ordered(nitro).C -0.447 3.0052 51 -0.1488 0.8823 ## Correlation: ## (Intr) or().L or().Q ## ordered(nitro).L 0 ## ordered(nitro).Q 0 0 ## ordered(nitro).C 0 0 0 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.781556 -0.611689 0.022224 0.622007 1.681382 ## ## Number of Observations: 72 ## Number of Groups: ## Block Variety %in% Block ## 6 18 fm4Oats &lt;- lme( yield ~ nitro, data = Oats, random = ~ 1 | Block/Variety ) summary( fm4Oats ) ## Linear mixed-effects model fit by REML ## Data: Oats ## AIC BIC logLik ## 603.04 614.28 -296.52 ## ## Random effects: ## Formula: ~1 | Block ## (Intercept) ## StdDev: 14.506 ## ## Formula: ~1 | Variety %in% Block ## (Intercept) Residual ## StdDev: 11.005 12.867 ## ## Fixed effects: yield ~ nitro ## Value Std.Error DF t-value p-value ## (Intercept) 81.872 6.9453 53 11.788 0 ## nitro 73.667 6.7815 53 10.863 0 ## Correlation: ## (Intr) ## nitro -0.293 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.743808 -0.664752 0.017104 0.542988 1.802989 ## ## Number of Observations: 72 ## Number of Groups: ## Block Variety %in% Block ## 6 18 VarCorr( fm4Oats ) ## Variance StdDev ## Block = pdLogChol(1) ## (Intercept) 210.42 14.506 ## Variety = pdLogChol(1) ## (Intercept) 121.10 11.005 ## Residual 165.56 12.867 intervals( fm4Oats ) ## Approximate 95% confidence intervals ## ## Fixed effects: ## lower est. upper ## (Intercept) 67.942 81.872 95.803 ## nitro 60.065 73.667 87.269 ## attr(,&quot;label&quot;) ## [1] &quot;Fixed effects:&quot; ## ## Random Effects: ## Level: Block ## lower est. upper ## sd((Intercept)) 6.6089 14.506 31.839 ## Level: Variety ## lower est. upper ## sd((Intercept)) 6.4081 11.005 18.898 ## ## Within-group standard error: ## lower est. upper ## 10.637 12.867 15.565 plot(augPred(fm4Oats), aspect = 2.5, layout = c(6, 3), between = list(x = c(0, 0, 0.5, 0, 0))) # produces Figure 1.21 # cleanup proc.time() ## user system elapsed ## 3.94 0.63 6.33 "],
["chapter-2.html", "2 Chapter 2", " 2 Chapter 2 #-*- R -*- library( nlme ) options( width = 65, digits = 5 ) options( contrasts = c(unordered = &quot;contr.helmert&quot;, ordered = &quot;contr.poly&quot;) ) #pdf( file = &#39;ch02.pdf&#39; ) # Chapter 2 Theory and Computational Methods for Linear Mixed-Effects Models # 2.2 Likelihood Estimation for LME Models Xmat &lt;- matrix( c(1, 1, 1, 1, 8, 10, 12, 14), ncol = 2 ) Xmat ## [,1] [,2] ## [1,] 1 8 ## [2,] 1 10 ## [3,] 1 12 ## [4,] 1 14 Xqr &lt;- qr( Xmat ) # creates a QR structure qr.R( Xqr ) # returns R ## [,1] [,2] ## [1,] -2 -22.0000 ## [2,] 0 -4.4721 qr.Q( Xqr ) # returns Q-truncated ## [,1] [,2] ## [1,] -0.5 0.67082 ## [2,] -0.5 0.22361 ## [3,] -0.5 -0.22361 ## [4,] -0.5 -0.67082 qr.Q( Xqr, complete = TRUE ) # returns the full Q ## [,1] [,2] [,3] [,4] ## [1,] -0.5 0.67082 0.023607 0.54721 ## [2,] -0.5 0.22361 -0.439345 -0.71202 ## [3,] -0.5 -0.22361 0.807869 -0.21760 ## [4,] -0.5 -0.67082 -0.392131 0.38240 fm1Rail.lme &lt;- lme( travel ~ 1, data = Rail, random = ~ 1 | Rail, control = list( msVerbose = TRUE ) ) ## 0: 61.048859: -1.81959 ## 1: 61.048859: -1.81959 fm1Rail.lme &lt;- lme( travel ~ 1, data = Rail, random = ~ 1 | Rail, control = list( msVerbose = TRUE, niterEM = 0 )) ## 0: 67.893737: -0.431523 ## 1: 61.612483: -1.43152 ## 2: 61.138913: -1.98441 ## 3: 61.050114: -1.83866 ## 4: 61.048866: -1.81819 ## 5: 61.048859: -1.81960 ## 6: 61.048859: -1.81959 fm1Machine &lt;- lme( score ~ Machine, data = Machines, random = ~ 1 | Worker ) fm2Machine &lt;- update( fm1Machine, random = ~ 1 | Worker/Machine ) anova( fm1Machine, fm2Machine ) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm1Machine 1 5 300.46 310.12 -145.23 ## fm2Machine 2 6 231.27 242.86 -109.64 1 vs 2 71.191 &lt;.0001 OrthoFem &lt;- Orthodont[ Orthodont$Sex == &quot;Female&quot;, ] fm1OrthF &lt;- lme( distance ~ age, data = OrthoFem, random = ~ 1 | Subject ) fm2OrthF &lt;- update( fm1OrthF, random = ~ age | Subject ) orthLRTsim &lt;- simulate.lme( fm1OrthF, m2 = fm2OrthF, nsim = 1000 ) plot( orthLRTsim, df = c(1, 2) ) # produces Figure 2.3 machineLRTsim &lt;- simulate.lme(fm1Machine, m2 = fm2Machine, nsim= 1000) plot( machineLRTsim, df = c(0, 1), # produces Figure 2.4 layout = c(4,1), between = list(x = c(0, 0.5, 0)) ) stoolLRTsim &lt;- simulate.lme( list(fixed = effort ~ 1, data = ergoStool, random = ~ 1 | Subject), m2 = list(fixed = effort ~ Type), method = &quot;ML&quot;, nsim = 1000 ) plot( stoolLRTsim, df = c(3, 4) ) # Figure 2.5 data( PBIB, package = &#39;SASmixed&#39; ) ## Error in find.package(package, lib.loc, verbose = verbose): there is no package called &#39;SASmixed&#39; pbibLRTsim &lt;- simulate.lme(list( fixed = response ~ 1, data = PBIB, random = ~ 1 | Block ), m2 = list(fixed = response ~ Treatment, data = PBIB, random = ~ 1 | Block), method = &quot;ML&quot;, nsim = 1000 ) ## Error in simulate.lme(list(fixed = response ~ 1, data = PBIB, random = ~1 | : 객체 &#39;PBIB&#39;를 찾을 수 없습니다 plot( pbibLRTsim, df = c(14,16,18), weights = FALSE ) # Figure 2.6 ## Error in plot(pbibLRTsim, df = c(14, 16, 18), weights = FALSE): 객체 &#39;pbibLRTsim&#39;를 찾을 수 없습니다 summary( fm2Machine ) ## Linear mixed-effects model fit by REML ## Data: Machines ## AIC BIC logLik ## 231.27 242.86 -109.64 ## ## Random effects: ## Formula: ~1 | Worker ## (Intercept) ## StdDev: 4.781 ## ## Formula: ~1 | Machine %in% Worker ## (Intercept) Residual ## StdDev: 3.7295 0.96158 ## ## Fixed effects: score ~ Machine ## Value Std.Error DF t-value p-value ## (Intercept) 59.650 2.14467 36 27.8131 0.0000 ## Machine1 3.983 1.08849 10 3.6595 0.0044 ## Machine2 3.311 0.62844 10 5.2688 0.0004 ## Correlation: ## (Intr) Machn1 ## Machine1 0 ## Machine2 0 0 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.269587 -0.548466 -0.010706 0.439366 2.540058 ## ## Number of Observations: 54 ## Number of Groups: ## Worker Machine %in% Worker ## 6 18 fm1PBIB &lt;- lme(response ~ Treatment, data = PBIB, random = ~ 1 | Block) ## Error in is.data.frame(data): 객체 &#39;PBIB&#39;를 찾을 수 없습니다 anova( fm1PBIB ) ## Error in anova(fm1PBIB): 객체 &#39;fm1PBIB&#39;를 찾을 수 없습니다 fm2PBIB &lt;- update( fm1PBIB, method = &quot;ML&quot; ) ## Error in update(fm1PBIB, method = &quot;ML&quot;): 객체 &#39;fm1PBIB&#39;를 찾을 수 없습니다 fm3PBIB &lt;- update( fm2PBIB, response ~ 1 ) ## Error in update(fm2PBIB, response ~ 1): 객체 &#39;fm2PBIB&#39;를 찾을 수 없습니다 anova( fm2PBIB, fm3PBIB ) ## Error in anova(fm2PBIB, fm3PBIB): 객체 &#39;fm2PBIB&#39;를 찾을 수 없습니다 anova( fm2Machine ) ## numDF denDF F-value p-value ## (Intercept) 1 36 773.57 &lt;.0001 ## Machine 2 10 20.58 3e-04 # cleanup proc.time() ## user system elapsed ## 25.16 0.88 28.31 "],
["chapter-3.html", "3 Chapter 3", " 3 Chapter 3 #-*- R -*- # initialization library(nlme) options(width = 65, digits = 5) options(contrasts = c(unordered = &quot;contr.helmert&quot;, ordered = &quot;contr.poly&quot;)) #pdf(file = &#39;ch03.pdf&#39;) # Chapter 3 Describing the Structure of Grouped Data # 3.1 The Display Formula and Its Components formula( Rail ) ## travel ~ 1 | Rail formula( ergoStool ) ## effort ~ Type | Subject formula( Machines ) ## score ~ Machine | Worker formula( Orthodont ) ## distance ~ age | Subject formula( Pixel ) ## pixel ~ day | Dog/Side formula( Oats ) ## yield ~ nitro | Block table( Oxboys$Subject ) ## ## 10 26 25 9 2 6 7 17 16 15 8 20 1 18 5 23 11 21 3 24 22 ## 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 ## 12 13 14 19 4 ## 9 9 9 9 9 table( getGroups( Oxboys ) ) ## ## 10 26 25 9 2 6 7 17 16 15 8 20 1 18 5 23 11 21 3 24 22 ## 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 ## 12 13 14 19 4 ## 9 9 9 9 9 unique( table( getGroups( Oxboys ) ) ) # a more concise result ## [1] 9 unique( table( getCovariate( Oxboys ), getGroups( Oxboys ) ) ) ## [1] 1 0 length( unique( getCovariate( Oxboys ) ) ) ## [1] 16 unique( getGroups(Pixel, level = 1) ) ## [1] 1 2 3 4 5 6 7 8 9 10 ## Levels: 1 10 2 3 4 5 6 7 8 9 unique( getGroups(Pixel, level = 2) ) ## [1] 1/R 2/R 3/R 4/R 5/R 6/R 7/R 8/R 9/R 10/R 1/L 2/L ## [13] 3/L 4/L 5/L 6/L 7/L 8/L 9/L 10/L ## 20 Levels: 1/R &lt; 2/R &lt; 3/R &lt; 4/R &lt; 5/R &lt; 6/R &lt; 7/R &lt; ... &lt; 10/L Pixel.groups &lt;- getGroups( Pixel, level = 1:2 ) class( Pixel.groups ) ## [1] &quot;data.frame&quot; names( Pixel.groups ) ## [1] &quot;Dog&quot; &quot;Side&quot; unique( Pixel.groups[[&quot;Side&quot;]] ) ## [1] R L ## Levels: L R formula( PBG ) ## deltaBP ~ dose | Rabbit PBG.log &lt;- update( PBG, formula = deltaBP ~ log(dose) | Rabbit ) formula(PBG.log) ## deltaBP ~ log(dose) | Rabbit ## &lt;environment: 0x00000000105833e0&gt; unique( getCovariate(PBG.log) ) ## [1] 1.8326 2.5257 3.2189 3.9120 4.6052 5.2983 unique( getCovariate(PBG) ) ## [1] 6.25 12.50 25.00 50.00 100.00 200.00 # 3.2 Constructing groupedData Objects # The next line is not from the book. # It is added to ensure that the file is available write.table( Oxboys, &quot;oxboys.dat&quot; ) Oxboys.frm &lt;- read.table( &quot;oxboys.dat&quot;, header = TRUE ) class( Oxboys.frm ) # check the class of the result ## [1] &quot;data.frame&quot; dim( Oxboys.frm ) # check the dimensions ## [1] 234 4 Oxboys &lt;- groupedData( height ~ age | Subject, data = read.table(&quot;oxboys.dat&quot;, header = TRUE), labels = list(x = &quot;Centered age&quot;, y = &quot;Height&quot;), units = list(y = &quot;(cm)&quot;) ) Oxboys # display the object ## Grouped Data: height ~ age | Subject ## Subject age height Occasion ## 1 1 -1.0000 140.50 1 ## 2 1 -0.7479 143.40 2 ## 3 1 -0.4630 144.80 3 ## 4 1 -0.1643 147.10 4 ## 5 1 -0.0027 147.70 5 ## 6 1 0.2466 150.20 6 ## 7 1 0.5562 151.70 7 ## 8 1 0.7781 153.30 8 ## 9 1 0.9945 155.80 9 ## 10 2 -1.0000 136.90 1 ## 11 2 -0.7479 139.10 2 ## 12 2 -0.4630 140.10 3 ## 13 2 -0.1643 142.60 4 ## 14 2 -0.0027 143.20 5 ## 15 2 0.2466 144.00 6 ## 16 2 0.5562 145.80 7 ## 17 2 0.7781 146.80 8 ## 18 2 0.9945 148.30 9 ## 19 3 -1.0000 150.00 1 ## 20 3 -0.7479 152.10 2 ## 21 3 -0.4630 153.90 3 ## 22 3 -0.1643 155.80 4 ## 23 3 -0.0027 156.00 5 ## 24 3 0.2466 156.90 6 ## 25 3 0.5562 157.40 7 ## 26 3 0.7781 159.10 8 ## 27 3 0.9945 160.60 9 ## 28 4 -1.0000 155.70 1 ## 29 4 -0.7479 158.70 2 ## 30 4 -0.4630 160.60 3 ## 31 4 -0.1643 163.30 4 ## 32 4 -0.0027 164.40 5 ## 33 4 0.2466 167.30 6 ## 34 4 0.5562 170.70 7 ## 35 4 0.7781 172.00 8 ## 36 4 0.9945 174.80 9 ## 37 5 -1.0000 145.80 1 ## 38 5 -0.7479 147.30 2 ## 39 5 -0.4493 148.70 3 ## 40 5 -0.1643 149.78 4 ## 41 5 -0.0027 150.22 5 ## 42 5 0.2466 152.50 6 ## 43 5 0.5562 154.80 7 ## 44 5 0.7781 156.40 8 ## 45 5 0.9973 158.70 9 ## 46 6 -1.0000 142.40 1 ## 47 6 -0.7479 143.80 2 ## 48 6 -0.4630 145.20 3 ## 49 6 -0.1643 146.30 4 ## 50 6 -0.0027 147.10 5 ## 51 6 0.2466 148.10 6 ## 52 6 0.5562 148.90 7 ## 53 6 0.7781 149.10 8 ## 54 6 0.9945 151.00 9 ## 55 7 -1.0000 141.30 1 ## 56 7 -0.7479 142.40 2 ## 57 7 -0.4493 144.30 3 ## 58 7 -0.1643 145.20 4 ## 59 7 0.0000 146.10 5 ## 60 7 0.2466 146.80 6 ## 61 7 0.5562 147.90 7 ## 62 7 0.7945 150.50 8 ## 63 7 0.9945 151.80 9 ## 64 8 -1.0000 141.70 1 ## 65 8 -0.7479 143.70 2 ## 66 8 -0.4630 145.10 3 ## 67 8 -0.1643 147.90 4 ## 68 8 -0.0027 148.10 5 ## 69 8 0.2466 149.60 6 ## 70 8 0.5562 150.99 7 ## 71 8 0.7945 154.10 8 ## 72 8 1.0055 154.90 9 ## 73 9 -1.0000 132.70 1 ## 74 9 -0.7479 134.10 2 ## 75 9 -0.4493 135.30 3 ## 76 9 -0.1643 136.60 4 ## 77 9 -0.0027 137.50 5 ## 78 9 0.2466 139.10 6 ## 79 9 0.5562 140.90 7 ## 80 9 0.7945 143.70 8 ## 81 9 0.9945 144.70 9 ## 82 10 -1.0000 126.20 1 ## 83 10 -0.7479 128.20 2 ## 84 10 -0.4630 129.00 3 ## 85 10 -0.1643 129.40 4 ## 86 10 -0.0027 129.59 5 ## 87 10 0.2466 130.60 6 ## 88 10 0.5562 132.50 7 ## 89 10 0.7781 133.40 8 ## 90 10 0.9945 134.20 9 ## 91 11 -1.0000 142.50 1 ## 92 11 -0.7479 143.80 2 ## 93 11 -0.4630 145.60 3 ## 94 11 -0.1643 148.30 4 ## 95 11 -0.0027 149.40 5 ## 96 11 0.2466 151.60 6 ## 97 11 0.5562 154.80 7 ## 98 11 0.7781 156.90 8 ## 99 11 0.9945 159.20 9 ## 100 12 -1.0000 149.90 1 ## 101 12 -0.7479 151.70 2 ## 102 12 -0.4630 153.30 3 ## 103 12 -0.1643 156.10 4 ## 104 12 0.0000 156.70 5 ## 105 12 0.2466 157.80 6 ## 106 12 0.5562 160.70 7 ## 107 12 0.7781 162.70 8 ## 108 12 0.9945 163.80 9 ## 109 13 -1.0000 148.90 1 ## 110 13 -0.7150 149.80 2 ## 111 13 -0.4630 151.70 3 ## 112 13 -0.1643 154.40 4 ## 113 13 -0.0027 155.50 5 ## 114 13 0.2466 156.40 6 ## 115 13 0.5562 161.40 7 ## 116 13 0.7781 163.90 8 ## 117 13 0.9945 164.60 9 ## 118 14 -1.0000 151.60 1 ## 119 14 -0.7479 153.20 2 ## 120 14 -0.4630 155.20 3 ## 121 14 -0.1643 157.30 4 ## 122 14 0.0000 159.10 5 ## 123 14 0.2466 160.90 6 ## 124 14 0.5562 164.40 7 ## 125 14 0.7781 166.90 8 ## 126 14 0.9945 168.40 9 ## 127 15 -1.0000 137.50 1 ## 128 15 -0.7479 139.30 2 ## 129 15 -0.4630 140.90 3 ## 130 15 -0.1643 142.70 4 ## 131 15 -0.0027 144.20 5 ## 132 15 0.2466 145.70 6 ## 133 15 0.5562 147.09 7 ## 134 15 0.7781 150.20 8 ## 135 15 0.9945 152.30 9 ## 136 16 -1.0000 142.80 1 ## 137 16 -0.7479 144.90 2 ## 138 16 -0.4630 145.00 3 ## 139 16 -0.1643 146.70 4 ## 140 16 -0.0027 147.20 5 ## 141 16 0.2466 148.90 6 ## 142 16 0.5562 150.10 7 ## 143 16 0.7781 151.00 8 ## 144 16 0.9945 152.20 9 ## 145 17 -1.0000 134.90 1 ## 146 17 -0.7479 137.40 2 ## 147 17 -0.4630 138.20 3 ## 148 17 -0.1643 140.20 4 ## 149 17 -0.0027 143.60 5 ## 150 17 0.2466 144.20 6 ## 151 17 0.5562 147.90 7 ## 152 17 0.7781 150.30 8 ## 153 17 0.9945 151.80 9 ## 154 18 -1.0000 145.50 1 ## 155 18 -0.7479 146.20 2 ## 156 18 -0.4630 148.20 3 ## 157 18 -0.1643 150.30 4 ## 158 18 -0.0027 152.00 5 ## 159 18 0.2466 152.30 6 ## 160 18 0.5562 154.30 7 ## 161 18 0.7781 156.20 8 ## 162 18 0.9945 156.80 9 ## 163 19 -1.0000 156.90 1 ## 164 19 -0.7479 157.90 2 ## 165 19 -0.4630 160.30 3 ## 166 19 -0.1643 161.90 4 ## 167 19 0.0000 163.80 5 ## 168 19 0.2466 165.50 6 ## 169 19 0.5562 169.90 7 ## 170 19 0.7781 172.40 8 ## 171 19 0.9945 174.40 9 ## 172 20 -1.0000 146.50 1 ## 173 20 -0.7479 148.40 2 ## 174 20 -0.4630 149.30 3 ## 175 20 -0.1643 151.20 4 ## 176 20 -0.0027 152.10 5 ## 177 20 0.2466 152.40 6 ## 178 20 0.5562 153.90 7 ## 179 20 0.7781 154.90 8 ## 180 20 0.9945 155.40 9 ## 181 21 -1.0000 143.90 1 ## 182 21 -0.7479 145.10 2 ## 183 21 -0.4630 147.00 3 ## 184 21 -0.1643 149.20 4 ## 185 21 -0.0027 149.80 5 ## 186 21 0.2466 151.50 6 ## 187 21 0.5562 153.17 7 ## 188 21 0.7781 156.90 8 ## 189 21 0.9945 159.60 9 ## 190 22 -1.0000 147.40 1 ## 191 22 -0.7479 148.80 2 ## 192 22 -0.4630 150.10 3 ## 193 22 -0.1643 152.50 4 ## 194 22 -0.0027 154.70 5 ## 195 22 0.2466 156.00 6 ## 196 22 0.5562 158.40 7 ## 197 22 0.7781 161.50 8 ## 198 22 0.9945 163.30 9 ## 199 23 -1.0000 144.50 1 ## 200 23 -0.7479 146.00 2 ## 201 23 -0.4630 147.40 3 ## 202 23 -0.1643 149.20 4 ## 203 23 -0.0027 150.80 5 ## 204 23 0.2466 152.50 6 ## 205 23 0.5562 155.00 7 ## 206 23 0.7781 156.80 8 ## 207 23 0.9945 158.80 9 ## 208 24 -1.0000 147.80 1 ## 209 24 -0.7479 148.20 2 ## 210 24 -0.4630 150.20 3 ## 211 24 -0.1643 151.00 4 ## 212 24 -0.0027 152.20 5 ## 213 24 0.2466 153.60 6 ## 214 24 0.5562 155.80 7 ## 215 24 0.7781 159.20 8 ## 216 24 0.9945 161.60 9 ## 217 25 -1.0000 135.50 1 ## 218 25 -0.7479 136.60 2 ## 219 25 -0.4630 137.30 3 ## 220 25 -0.1643 138.20 4 ## 221 25 -0.0027 139.00 5 ## 222 25 0.2466 139.50 6 ## 223 25 0.5562 141.00 7 ## 224 25 0.7808 142.70 8 ## 225 25 0.9945 143.90 9 ## 226 26 -1.0000 132.20 1 ## 227 26 -0.7479 134.30 2 ## 228 26 -0.4630 135.10 3 ## 229 26 -0.1643 136.70 4 ## 230 26 -0.0027 138.40 5 ## 231 26 0.2466 138.90 6 ## 232 26 0.5562 141.80 7 ## 233 26 0.7781 142.60 8 ## 234 26 1.0055 143.10 9 unique( getGroups( Oxboys ) ) ## [1] 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ## [21] 21 22 23 24 25 26 ## 26 Levels: 10 &lt; 26 &lt; 25 &lt; 9 &lt; 2 &lt; 6 &lt; 7 &lt; 17 &lt; 16 &lt; 15 &lt; ... &lt; 4 plot( BodyWeight, outer = ~ Diet, aspect = 3 ) # Figure 3.3 plot( BodyWeight, outer = TRUE, aspect = 3 ) plot( Soybean, outer = ~ Year * Variety ) # Figure 6.10 plot( Soybean, outer = ~ Variety * Year ) gsummary( BodyWeight, invar = TRUE ) ## Rat Diet ## 2 2 1 ## 3 3 1 ## 4 4 1 ## 1 1 1 ## 8 8 1 ## 5 5 1 ## 6 6 1 ## 7 7 1 ## 11 11 2 ## 9 9 2 ## 10 10 2 ## 12 12 2 ## 13 13 3 ## 15 15 3 ## 14 14 3 ## 16 16 3 plot( PBG, inner = ~ Treatment, scales = list(x = list(log = 2))) ergoStool.mat &lt;- asTable( ergoStool ) ergoStool.mat ## ## T1 T2 T3 T4 ## 8 7 11 8 7 ## 5 8 11 8 7 ## 4 7 11 10 9 ## 9 9 13 10 8 ## 6 9 11 11 10 ## 3 7 14 13 9 ## 7 8 12 12 11 ## 1 12 15 12 10 ## 2 10 14 13 12 ergoStool.new &lt;- balancedGrouped( effort ~ Type | Subject, data = ergoStool.mat ) ## Warning in balancedGrouped(effort ~ Type | Subject, data = ## ergoStool.mat): 강제형변환에 의해 생성된 NA 입니다 ergoStool.new ## Grouped Data: effort ~ Type | Subject ## Type Subject effort ## 1 T1 8 7 ## 2 T2 8 11 ## 3 T3 8 8 ## 4 T4 8 7 ## 5 T1 5 8 ## 6 T2 5 11 ## 7 T3 5 8 ## 8 T4 5 7 ## 9 T1 4 7 ## 10 T2 4 11 ## 11 T3 4 10 ## 12 T4 4 9 ## 13 T1 9 9 ## 14 T2 9 13 ## 15 T3 9 10 ## 16 T4 9 8 ## 17 T1 6 9 ## 18 T2 6 11 ## 19 T3 6 11 ## 20 T4 6 10 ## 21 T1 3 7 ## 22 T2 3 14 ## 23 T3 3 13 ## 24 T4 3 9 ## 25 T1 7 8 ## 26 T2 7 12 ## 27 T3 7 12 ## 28 T4 7 11 ## 29 T1 1 12 ## 30 T2 1 15 ## 31 T3 1 12 ## 32 T4 1 10 ## 33 T1 2 10 ## 34 T2 2 14 ## 35 T3 2 13 ## 36 T4 2 12 # 3.3 Controlling Trellis Graphics Presentations of Grouped Data plot(CO2, layout=c(6,2), between=list(x=c(0,0,0.5,0,0))) plot( Spruce, layout = c(7, 4, 3), skip = c(rep(FALSE, 27), TRUE, rep(FALSE, 27), TRUE, rep(FALSE, 12), rep(TRUE, 2), rep(FALSE,13)) ) plot( Spruce, layout = c(9, 3, 3), skip = c(rep(FALSE, 66), TRUE, TRUE, rep(FALSE, 13)) ) unique( getCovariate(DNase) ) ## [1] 0.048828 0.195312 0.390625 0.781250 1.562500 3.125000 ## [7] 6.250000 12.500000 log( unique(getCovariate(DNase)), 2 ) ## [1] -4.35614 -2.35614 -1.35614 -0.35614 0.64386 1.64386 ## [7] 2.64386 3.64386 plot( DNase, layout=c(6,2), scales = list(x=list(log=2)) ) plot(Pixel, layout = c(4,5), between = list(x = c(0, 0.5, 0), y = 0.5)) plot( Pixel, displayLevel = 1 ) plot( Wafer, display = 1, collapse = 1 ) plot( Wafer, display = 1, collapse = 1, FUN = function(x) sqrt(var(x)), layout = c(10,1) ) # 3.4 Summaries sapply( ergoStool, data.class ) ## effort Type Subject ## &quot;numeric&quot; &quot;factor&quot; &quot;ordered&quot; gsummary( Theoph, inv = TRUE ) ## Subject Wt Dose ## 6 6 80.0 4.00 ## 7 7 64.6 4.95 ## 8 8 70.5 4.53 ## 11 11 65.0 4.92 ## 3 3 70.5 4.53 ## 2 2 72.4 4.40 ## 4 4 72.7 4.40 ## 9 9 86.4 3.10 ## 12 12 60.5 5.30 ## 10 10 58.2 5.50 ## 1 1 79.6 4.02 ## 5 5 54.6 5.86 gsummary( Theoph, omit = TRUE, inv = TRUE ) ## Wt Dose ## 6 80.0 4.00 ## 7 64.6 4.95 ## 8 70.5 4.53 ## 11 65.0 4.92 ## 3 70.5 4.53 ## 2 72.4 4.40 ## 4 72.7 4.40 ## 9 86.4 3.10 ## 12 60.5 5.30 ## 10 58.2 5.50 ## 1 79.6 4.02 ## 5 54.6 5.86 is.null(gsummary(Theoph, inv = TRUE, omit = TRUE)) # invariants present ## [1] FALSE is.null(gsummary(Oxboys, inv = TRUE, omit = TRUE)) # no invariants ## [1] TRUE gsummary( Theoph ) ## Subject Wt Dose Time conc ## 6 6 80.0 4.00 5.8882 3.5255 ## 7 7 64.6 4.95 5.8655 3.9109 ## 8 8 70.5 4.53 5.8900 4.2718 ## 11 11 65.0 4.92 5.8718 4.5109 ## 3 3 70.5 4.53 5.9073 5.0864 ## 2 2 72.4 4.40 5.8691 4.8236 ## 4 4 72.7 4.40 5.9400 4.9400 ## 9 9 86.4 3.10 5.8682 4.8936 ## 12 12 60.5 5.30 5.8764 5.4100 ## 10 10 58.2 5.50 5.9155 5.9309 ## 1 1 79.6 4.02 5.9500 6.4391 ## 5 5 54.6 5.86 5.8936 5.7827 gsummary( Theoph, FUN = max, omit = TRUE ) ## Wt Dose Time conc ## 6 80.0 4.00 23.85 6.44 ## 7 64.6 4.95 24.22 7.09 ## 8 70.5 4.53 24.12 7.56 ## 11 65.0 4.92 24.08 8.00 ## 3 70.5 4.53 24.17 8.20 ## 2 72.4 4.40 24.30 8.33 ## 4 72.7 4.40 24.65 8.60 ## 9 86.4 3.10 24.43 9.03 ## 12 60.5 5.30 24.15 9.75 ## 10 58.2 5.50 23.70 10.21 ## 1 79.6 4.02 24.37 10.50 ## 5 54.6 5.86 24.35 11.40 Quin.sum &lt;- gsummary( Quinidine, omit = TRUE, FUN = mean ) dim( Quin.sum ) ## [1] 136 13 Quin.sum[1:10, ] ## time conc dose interval Age Height Weight Race ## 109 30.2633 NA NA NA 70 67 58.000 Caucasian ## 70 0.7500 NA NA NA 68 69 75.000 Caucasian ## 23 52.0262 NA NA NA 75 72 108.000 Caucasian ## 92 8.8571 NA NA NA 68 72 65.000 Caucasian ## 111 18.1638 NA NA NA 68 66 56.000 Latin ## 5 24.3750 NA NA NA 62 71 66.000 Caucasian ## 18 196.8438 NA NA NA 87 69 85.375 Caucasian ## 24 31.2500 NA NA NA 55 69 89.000 Latin ## 2 12.2000 NA NA NA 58 69 85.000 Latin ## 88 4.7900 NA NA NA 85 72 77.000 Caucasian ## Smoke Ethanol Heart Creatinine glyco ## 109 no none No/Mild &gt;= 50 0.46000 ## 70 no former No/Mild &gt;= 50 1.15000 ## 23 yes none No/Mild &gt;= 50 0.83875 ## 92 yes former No/Mild &gt;= 50 1.27000 ## 111 yes former No/Mild &gt;= 50 1.23000 ## 5 yes none Severe &gt;= 50 1.39000 ## 18 no none No/Mild &lt; 50 1.26000 ## 24 no former No/Mild &gt;= 50 0.57000 ## 2 no current Moderate &gt;= 50 0.82000 ## 88 no none Moderate &gt;= 50 0.61000 Quinidine[Quinidine[[&quot;Subject&quot;]] == 3, 1:8] ## Grouped Data: conc ~ time | Subject ## Subject time conc dose interval Age Height Weight ## 17 3 0.00 NA 201 NA 67 69 69 ## 18 3 8.00 NA 201 NA 67 69 69 ## 19 3 16.00 NA 201 NA 67 69 69 ## 20 3 24.00 NA 201 NA 67 69 69 ## 21 3 32.00 NA 201 NA 67 69 69 ## 22 3 41.25 2.4 NA NA 67 69 69 ## 23 3 104.00 NA 201 8 67 69 69 ## 24 3 113.00 2.3 NA NA 67 69 69 ## 25 3 3865.00 NA 201 6 67 69 62 ## 26 3 3873.00 NA 201 NA 67 69 62 ## 27 3 3881.00 NA 201 NA 67 69 62 ## 28 3 3889.00 NA 201 NA 67 69 62 ## 29 3 3897.00 NA 201 NA 67 69 62 ## 30 3 3900.00 NA NA NA 67 69 62 ## 31 3 3905.00 NA 201 NA 67 69 62 ## 32 3 3909.00 4.7 NA NA 67 69 62 ## 33 3 4073.00 NA 201 8 67 69 62 Quin.sum1 &lt;- gsummary( Quinidine, omit = TRUE ) Quin.sum1[1:10, 1:7] ## time conc dose interval Age Height Weight ## 109 30.2633 0.50000 100.00 NaN 70 67 58.000 ## 70 0.7500 0.60000 201.00 8 68 69 75.000 ## 23 52.0262 0.56667 166.00 6 75 72 108.000 ## 92 8.8571 0.70000 83.00 NaN 68 72 65.000 ## 111 18.1638 0.90000 249.00 NaN 68 66 56.000 ## 5 24.3750 0.70000 301.00 NaN 62 71 66.000 ## 18 196.8438 0.93333 201.00 6 87 69 85.375 ## 24 31.2500 1.10000 187.88 NaN 55 69 89.000 ## 2 12.2000 1.20000 166.00 NaN 58 69 85.000 ## 88 4.7900 1.20000 201.00 8 85 72 77.000 summary( Quin.sum1 ) ## time conc dose interval ## Min. : 0.1 Min. :0.50 Min. : 83 Min. : 5.00 ## 1st Qu.: 19.3 1st Qu.:1.70 1st Qu.:198 1st Qu.: 6.00 ## Median : 47.2 Median :2.24 Median :201 Median : 6.00 ## Mean : 251.5 Mean :2.36 Mean :224 Mean : 6.99 ## 3rd Qu.: 171.1 3rd Qu.:2.92 3rd Qu.:249 3rd Qu.: 8.00 ## Max. :5364.9 Max. :5.77 Max. :498 Max. :12.00 ## NA&#39;s :29 ## Age Height Weight Race ## Min. :42.0 Min. :60.0 Min. : 41.0 Caucasian:91 ## 1st Qu.:61.0 1st Qu.:67.0 1st Qu.: 67.8 Latin :35 ## Median :66.0 Median :70.0 Median : 79.2 Black :10 ## Mean :66.9 Mean :69.6 Mean : 79.2 ## 3rd Qu.:73.0 3rd Qu.:72.0 3rd Qu.: 88.2 ## Max. :92.0 Max. :79.0 Max. :119.0 ## ## Smoke Ethanol Heart Creatinine glyco ## no :94 none :90 No/Mild :55 &lt; 50 : 36 Min. :0.390 ## yes:42 current:16 Moderate:40 &gt;= 50:100 1st Qu.:0.885 ## former :30 Severe :41 Median :1.174 ## Mean :1.212 ## 3rd Qu.:1.453 ## Max. :2.995 ## summary( Quinidine ) ## Subject time conc dose ## 223 : 47 Min. : 0 Min. :0.40 Min. : 83 ## 110 : 41 1st Qu.: 16 1st Qu.:1.60 1st Qu.:166 ## 81 : 40 Median : 60 Median :2.30 Median :201 ## 136 : 32 Mean : 373 Mean :2.45 Mean :225 ## 7 : 31 3rd Qu.: 241 3rd Qu.:3.00 3rd Qu.:249 ## 76 : 28 Max. :8096 Max. :9.40 Max. :603 ## (Other):1252 NA&#39;s :1110 NA&#39;s :443 ## interval Age Height Weight ## Min. : 4.00 Min. :42.0 Min. :60.0 Min. : 41.0 ## 1st Qu.: 6.00 1st Qu.:60.0 1st Qu.:67.0 1st Qu.: 69.5 ## Median : 6.00 Median :66.0 Median :69.0 Median : 78.0 ## Mean : 7.11 Mean :66.7 Mean :69.2 Mean : 79.7 ## 3rd Qu.: 8.00 3rd Qu.:74.0 3rd Qu.:72.0 3rd Qu.: 89.0 ## Max. :12.00 Max. :92.0 Max. :79.0 Max. :119.0 ## NA&#39;s :1222 ## Race Smoke Ethanol Heart ## Caucasian:968 no :1024 none :991 No/Mild :598 ## Latin :384 yes: 447 current:191 Moderate:375 ## Black :119 former :289 Severe :498 ## ## ## ## ## Creatinine glyco ## &lt; 50 : 418 Min. :0.39 ## &gt;= 50:1053 1st Qu.:0.93 ## Median :1.23 ## Mean :1.28 ## 3rd Qu.:1.54 ## Max. :3.16 ## sum( ifelse(is.na(Quinidine[[&quot;conc&quot;]]), 0, 1) ) ## [1] 361 sum( !is.na(Quinidine[[&quot;conc&quot;]]) ) ## [1] 361 sum( !is.na(Quinidine[[&quot;dose&quot;]]) ) ## [1] 1028 gapply( Quinidine, &quot;conc&quot;, function(x) sum(!is.na(x)) ) ## 109 70 23 92 111 5 18 24 2 88 91 117 120 13 89 27 ## 1 1 3 1 1 2 3 1 1 1 1 3 2 1 3 1 ## 53 122 129 132 16 106 15 22 57 77 115 121 123 11 48 126 ## 1 1 2 3 1 1 1 1 3 1 4 1 1 2 2 2 ## 223 19 38 42 52 56 63 83 104 118 137 17 29 34 46 73 ## 6 1 1 2 1 1 4 1 2 2 1 1 1 1 3 2 ## 87 103 138 45 44 97 36 37 72 100 8 71 6 14 26 75 ## 2 1 2 3 7 2 2 3 1 3 1 5 1 3 1 3 ## 20 96 99 134 12 49 67 85 112 127 55 68 124 1 35 47 ## 2 3 2 1 1 3 3 1 3 3 6 3 1 2 2 5 ## 79 95 114 135 105 116 62 65 107 130 66 139 33 80 125 110 ## 3 3 2 2 1 3 4 7 4 3 1 3 3 2 1 11 ## 128 136 21 43 90 102 40 84 98 30 82 93 108 119 32 133 ## 2 11 2 1 1 2 2 6 2 1 3 4 1 3 1 2 ## 7 9 76 94 58 113 50 39 78 25 61 3 64 60 59 10 ## 6 2 6 5 1 2 3 2 10 2 2 3 4 4 3 6 ## 69 4 81 54 41 74 28 51 ## 2 6 11 4 3 3 4 6 table( gapply(Quinidine, &quot;conc&quot;, function(x) sum(!is.na(x))) ) ## ## 1 2 3 4 5 6 7 10 11 ## 46 33 31 9 3 8 2 1 3 changeRecords &lt;- gapply( Quinidine, FUN = function(frm) any(is.na(frm[[&quot;conc&quot;]]) &amp; is.na(frm[[&quot;dose&quot;]])) ) changeRecords ## 109 70 23 92 111 5 18 24 2 88 ## FALSE FALSE FALSE FALSE FALSE FALSE TRUE FALSE FALSE FALSE ## 91 117 120 13 89 27 53 122 129 132 ## FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE TRUE ## 16 106 15 22 57 77 115 121 123 11 ## FALSE FALSE FALSE FALSE FALSE TRUE FALSE FALSE FALSE FALSE ## 48 126 223 19 38 42 52 56 63 83 ## TRUE FALSE TRUE FALSE FALSE FALSE FALSE FALSE TRUE FALSE ## 104 118 137 17 29 34 46 73 87 103 ## FALSE TRUE FALSE FALSE FALSE FALSE TRUE FALSE FALSE FALSE ## 138 45 44 97 36 37 72 100 8 71 ## FALSE TRUE TRUE TRUE FALSE TRUE FALSE FALSE FALSE TRUE ## 6 14 26 75 20 96 99 134 12 49 ## FALSE TRUE FALSE TRUE FALSE TRUE FALSE FALSE FALSE FALSE ## 67 85 112 127 55 68 124 1 35 47 ## FALSE FALSE TRUE TRUE TRUE FALSE FALSE FALSE FALSE TRUE ## 79 95 114 135 105 116 62 65 107 130 ## TRUE TRUE TRUE TRUE FALSE FALSE TRUE TRUE FALSE FALSE ## 66 139 33 80 125 110 128 136 21 43 ## FALSE TRUE TRUE TRUE FALSE TRUE FALSE TRUE FALSE FALSE ## 90 102 40 84 98 30 82 93 108 119 ## FALSE FALSE TRUE TRUE TRUE FALSE TRUE FALSE FALSE TRUE ## 32 133 7 9 76 94 58 113 50 39 ## FALSE TRUE TRUE FALSE TRUE TRUE FALSE FALSE TRUE FALSE ## 78 25 61 3 64 60 59 10 69 4 ## FALSE FALSE TRUE TRUE TRUE FALSE FALSE TRUE FALSE TRUE ## 81 54 41 74 28 51 ## TRUE TRUE TRUE FALSE TRUE FALSE sort( as.numeric( names(changeRecords)[changeRecords] ) ) ## [1] 3 4 7 10 14 18 28 33 37 40 41 44 45 46 47 ## [16] 48 50 54 55 61 62 63 64 65 71 75 76 77 79 80 ## [31] 81 82 84 94 95 96 97 98 110 112 114 118 119 127 132 ## [46] 133 135 136 139 223 Quinidine[29:31,] ## Grouped Data: conc ~ time | Subject ## Subject time conc dose interval Age Height Weight Race ## 29 3 3897 NA 201 NA 67 69 62 Caucasian ## 30 3 3900 NA NA NA 67 69 62 Caucasian ## 31 3 3905 NA 201 NA 67 69 62 Caucasian ## Smoke Ethanol Heart Creatinine glyco ## 29 yes former Moderate &lt; 50 1.71 ## 30 yes former Moderate &lt; 50 1.71 ## 31 yes former Moderate &lt; 50 1.71 Quinidine[Quinidine[[&quot;Subject&quot;]] == 4, ] ## Grouped Data: conc ~ time | Subject ## Subject time conc dose interval Age Height Weight Race ## 45 4 0.00 NA 332 NA 88 66 103 Black ## 46 4 7.00 NA 332 NA 88 66 103 Black ## 47 4 13.00 NA 332 NA 88 66 103 Black ## 48 4 19.00 NA 332 NA 88 66 103 Black ## 49 4 21.50 3.1 NA NA 88 66 103 Black ## 50 4 85.00 NA 249 6 88 66 103 Black ## 51 4 91.00 5.8 NA NA 88 66 103 Black ## 52 4 91.08 NA 249 NA 88 66 103 Black ## 53 4 97.00 NA 249 NA 88 66 103 Black ## 54 4 103.00 NA 249 NA 88 66 103 Black ## 55 4 105.00 NA NA NA 88 66 92 Black ## 56 4 109.00 NA 249 NA 88 66 92 Black ## 57 4 115.00 NA 249 NA 88 66 92 Black ## 58 4 145.00 NA 166 NA 88 66 92 Black ## 59 4 151.00 NA 166 NA 88 66 92 Black ## 60 4 156.00 3.1 NA NA 88 66 92 Black ## 61 4 157.00 NA 166 NA 88 66 92 Black ## 62 4 163.00 NA 166 NA 88 66 92 Black ## 63 4 169.00 NA 166 NA 88 66 92 Black ## 64 4 174.75 NA 201 NA 88 66 92 Black ## 65 4 177.00 NA NA NA 88 66 92 Black ## 66 4 181.50 3.1 NA NA 88 66 92 Black ## 67 4 245.00 NA 201 8 88 66 92 Black ## 68 4 249.00 NA NA NA 88 66 86 Black ## 69 4 252.50 3.2 NA NA 88 66 86 Black ## 70 4 317.00 NA 201 8 88 66 86 Black ## 71 4 326.00 1.9 NA NA 88 66 86 Black ## Smoke Ethanol Heart Creatinine glyco ## 45 yes none Severe &gt;= 50 1.48 ## 46 yes none Severe &gt;= 50 1.48 ## 47 yes none Severe &gt;= 50 1.48 ## 48 yes none Severe &gt;= 50 1.48 ## 49 yes none Severe &gt;= 50 1.48 ## 50 yes none Severe &gt;= 50 1.61 ## 51 yes none Severe &gt;= 50 1.61 ## 52 yes none Severe &gt;= 50 1.61 ## 53 yes none Severe &gt;= 50 1.61 ## 54 yes none Severe &gt;= 50 1.61 ## 55 yes none Severe &gt;= 50 1.61 ## 56 yes none Severe &gt;= 50 1.61 ## 57 yes none Severe &gt;= 50 1.61 ## 58 yes none Severe &gt;= 50 1.88 ## 59 yes none Severe &gt;= 50 1.88 ## 60 yes none Severe &gt;= 50 1.88 ## 61 yes none Severe &gt;= 50 1.88 ## 62 yes none Severe &gt;= 50 1.88 ## 63 yes none Severe &gt;= 50 1.88 ## 64 yes none Severe &gt;= 50 1.88 ## 65 yes none Severe &gt;= 50 1.68 ## 66 yes none Severe &gt;= 50 1.68 ## 67 yes none Severe &gt;= 50 1.87 ## 68 yes none Severe &gt;= 50 1.87 ## 69 yes none Severe &gt;= 50 1.87 ## 70 yes none Severe &gt;= 50 1.83 ## 71 yes none Severe &gt;= 50 1.83 # cleanup proc.time() ## user system elapsed ## 32.26 1.23 35.81 "],
["chapter-4.html", "4 Chapter 4", " 4 Chapter 4 #-*- R -*- # initialization library(nlme) library(lattice) options(width = 65, digits = 5) options(contrasts = c(unordered = &quot;contr.helmert&quot;, ordered = &quot;contr.poly&quot;)) #pdf(file = &#39;ch04.pdf&#39;) # Chapter 4 Fitting Linear Mixed-Effects Models # 4.1 Fitting Linear Models in S with lm and lmList fm1Orth.lm &lt;- lm(distance ~ age, Orthodont) fm1Orth.lm ## ## Call: ## lm(formula = distance ~ age, data = Orthodont) ## ## Coefficients: ## (Intercept) age ## 16.76 0.66 par(mfrow=c(2,2)) plot(fm1Orth.lm) # Figure 4.1 fm2Orth.lm &lt;- update(fm1Orth.lm, formula = distance ~ Sex*age) summary(fm2Orth.lm) ## ## Call: ## lm(formula = distance ~ Sex + age + Sex:age, data = Orthodont) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.616 -1.322 -0.168 1.330 5.247 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 16.8567 1.1094 15.19 &lt; 2e-16 *** ## Sex1 0.5161 1.1094 0.47 0.64 ## age 0.6320 0.0988 6.39 4.7e-09 *** ## Sex1:age -0.1524 0.0988 -1.54 0.13 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.26 on 104 degrees of freedom ## Multiple R-squared: 0.423, Adjusted R-squared: 0.406 ## F-statistic: 25.4 on 3 and 104 DF, p-value: 2.11e-12 fm3Orth.lm &lt;- update(fm2Orth.lm, formula = . ~ . - Sex) summary(fm3Orth.lm) ## ## Call: ## lm(formula = distance ~ age + Sex:age, data = Orthodont) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.742 -1.242 -0.189 1.268 5.267 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 16.7611 1.0861 15.43 &lt; 2e-16 *** ## age 0.6403 0.0968 6.61 1.6e-09 *** ## age:Sex1 -0.1074 0.0196 -5.47 3.0e-07 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.25 on 105 degrees of freedom ## Multiple R-squared: 0.422, Adjusted R-squared: 0.411 ## F-statistic: 38.3 on 2 and 105 DF, p-value: 3.31e-13 bwplot(getGroups(Orthodont)~resid(fm2Orth.lm)) # Figure 4.2 fm1Orth.lis &lt;- lmList(distance ~ age | Subject, Orthodont) getGroupsFormula(Orthodont) ## ~Subject ## &lt;environment: 0x000000000f336f10&gt; fm1Orth.lis &lt;- lmList(distance ~ age, Orthodont) formula(Orthodont) ## distance ~ age | Subject fm1Orth.lis &lt;- lmList(Orthodont) fm1Orth.lis ## Call: ## Model: distance ~ age | Subject ## Data: Orthodont ## ## Coefficients: ## (Intercept) age ## M16 16.95 0.550 ## M05 13.65 0.850 ## M02 14.85 0.775 ## M11 20.05 0.325 ## M07 14.95 0.800 ## M08 19.75 0.375 ## M03 16.00 0.750 ## M12 13.25 1.000 ## M13 2.80 1.950 ## M14 19.10 0.525 ## M09 14.40 0.975 ## M15 13.50 1.125 ## M06 18.95 0.675 ## M04 24.70 0.175 ## M01 17.30 0.950 ## M10 21.25 0.750 ## F10 13.55 0.450 ## F09 18.10 0.275 ## F06 17.00 0.375 ## F01 17.25 0.375 ## F05 19.60 0.275 ## F07 16.95 0.550 ## F02 14.20 0.800 ## F08 21.45 0.175 ## F03 14.40 0.850 ## F04 19.65 0.475 ## F11 18.95 0.675 ## ## Degrees of freedom: 108 total; 54 residual ## Residual standard error: 1.31 summary(fm1Orth.lis) ## Call: ## Model: distance ~ age | Subject ## Data: Orthodont ## ## Coefficients: ## (Intercept) ## Estimate Std. Error t value Pr(&gt;|t|) ## M16 16.95 3.2882 5.15484 3.6952e-06 ## M05 13.65 3.2882 4.15124 1.1817e-04 ## M02 14.85 3.2882 4.51619 3.4589e-05 ## M11 20.05 3.2882 6.09761 1.1888e-07 ## M07 14.95 3.2882 4.54660 3.1167e-05 ## M08 19.75 3.2882 6.00637 1.6657e-07 ## M03 16.00 3.2882 4.86592 1.0285e-05 ## M12 13.25 3.2882 4.02959 1.7626e-04 ## M13 2.80 3.2882 0.85154 3.9823e-01 ## M14 19.10 3.2882 5.80870 3.4496e-07 ## M09 14.40 3.2882 4.37933 5.5096e-05 ## M15 13.50 3.2882 4.10562 1.3737e-04 ## M06 18.95 3.2882 5.76308 4.0782e-07 ## M04 24.70 3.2882 7.51177 6.0816e-10 ## M01 17.30 3.2882 5.26128 2.5236e-06 ## M10 21.25 3.2882 6.46255 3.0655e-08 ## F10 13.55 3.2882 4.12083 1.3065e-04 ## F09 18.10 3.2882 5.50458 1.0478e-06 ## F06 17.00 3.2882 5.17004 3.4998e-06 ## F01 17.25 3.2882 5.24607 2.6653e-06 ## F05 19.60 3.2882 5.96076 1.9711e-07 ## F07 16.95 3.2882 5.15484 3.6952e-06 ## F02 14.20 3.2882 4.31851 6.7638e-05 ## F08 21.45 3.2882 6.52338 2.4438e-08 ## F03 14.40 3.2882 4.37933 5.5096e-05 ## F04 19.65 3.2882 5.97596 1.8636e-07 ## F11 18.95 3.2882 5.76308 4.0782e-07 ## age ## Estimate Std. Error t value Pr(&gt;|t|) ## M16 0.550 0.29293 1.87756 6.5847e-02 ## M05 0.850 0.29293 2.90168 5.3616e-03 ## M02 0.775 0.29293 2.64565 1.0658e-02 ## M11 0.325 0.29293 1.10947 2.7215e-01 ## M07 0.800 0.29293 2.73099 8.5114e-03 ## M08 0.375 0.29293 1.28015 2.0596e-01 ## M03 0.750 0.29293 2.56031 1.3288e-02 ## M12 1.000 0.29293 3.41374 1.2222e-03 ## M13 1.950 0.29293 6.65680 1.4857e-08 ## M14 0.525 0.29293 1.79221 7.8702e-02 ## M09 0.975 0.29293 3.32840 1.5779e-03 ## M15 1.125 0.29293 3.84046 3.2471e-04 ## M06 0.675 0.29293 2.30428 2.5081e-02 ## M04 0.175 0.29293 0.59740 5.5273e-01 ## M01 0.950 0.29293 3.24305 2.0301e-03 ## M10 0.750 0.29293 2.56031 1.3288e-02 ## F10 0.450 0.29293 1.53618 1.3033e-01 ## F09 0.275 0.29293 0.93878 3.5202e-01 ## F06 0.375 0.29293 1.28015 2.0596e-01 ## F01 0.375 0.29293 1.28015 2.0596e-01 ## F05 0.275 0.29293 0.93878 3.5202e-01 ## F07 0.550 0.29293 1.87756 6.5847e-02 ## F02 0.800 0.29293 2.73099 8.5114e-03 ## F08 0.175 0.29293 0.59740 5.5273e-01 ## F03 0.850 0.29293 2.90168 5.3616e-03 ## F04 0.475 0.29293 1.62153 1.1073e-01 ## F11 0.675 0.29293 2.30428 2.5081e-02 ## ## Residual standard error: 1.31 on 54 degrees of freedom pairs(fm1Orth.lis, id = 0.01, adj = -0.5) # Figure 4.3 fm2Orth.lis &lt;- update(fm1Orth.lis, distance ~ I(age-11)) intervals(fm2Orth.lis) ## , , (Intercept) ## ## lower est. upper ## M16 21.687 23.000 24.313 ## M05 21.687 23.000 24.313 ## M02 22.062 23.375 24.688 ## M11 22.312 23.625 24.938 ## M07 22.437 23.750 25.063 ## M08 22.562 23.875 25.188 ## M03 22.937 24.250 25.563 ## M12 22.937 24.250 25.563 ## M13 22.937 24.250 25.563 ## M14 23.562 24.875 26.188 ## M09 23.812 25.125 26.438 ## M15 24.562 25.875 27.188 ## M06 25.062 26.375 27.688 ## M04 25.312 26.625 27.938 ## M01 26.437 27.750 29.063 ## M10 28.187 29.500 30.813 ## F10 17.187 18.500 19.813 ## F09 19.812 21.125 22.438 ## F06 19.812 21.125 22.438 ## F01 20.062 21.375 22.688 ## F05 21.312 22.625 23.938 ## F07 21.687 23.000 24.313 ## F02 21.687 23.000 24.313 ## F08 22.062 23.375 24.688 ## F03 22.437 23.750 25.063 ## F04 23.562 24.875 26.188 ## F11 25.062 26.375 27.688 ## ## , , I(age - 11) ## ## lower est. upper ## M16 -0.037297 0.550 1.1373 ## M05 0.262703 0.850 1.4373 ## M02 0.187703 0.775 1.3623 ## M11 -0.262297 0.325 0.9123 ## M07 0.212703 0.800 1.3873 ## M08 -0.212297 0.375 0.9623 ## M03 0.162703 0.750 1.3373 ## M12 0.412703 1.000 1.5873 ## M13 1.362703 1.950 2.5373 ## M14 -0.062297 0.525 1.1123 ## M09 0.387703 0.975 1.5623 ## M15 0.537703 1.125 1.7123 ## M06 0.087703 0.675 1.2623 ## M04 -0.412297 0.175 0.7623 ## M01 0.362703 0.950 1.5373 ## M10 0.162703 0.750 1.3373 ## F10 -0.137297 0.450 1.0373 ## F09 -0.312297 0.275 0.8623 ## F06 -0.212297 0.375 0.9623 ## F01 -0.212297 0.375 0.9623 ## F05 -0.312297 0.275 0.8623 ## F07 -0.037297 0.550 1.1373 ## F02 0.212703 0.800 1.3873 ## F08 -0.412297 0.175 0.7623 ## F03 0.262703 0.850 1.4373 ## F04 -0.112297 0.475 1.0623 ## F11 0.087703 0.675 1.2623 plot(intervals(fm2Orth.lis)) # Figure 4.5 IGF ## Grouped Data: conc ~ age | Lot ## Lot age conc ## 1 1 7 4.90 ## 2 1 7 5.68 ## 3 1 8 5.32 ## 4 1 8 5.50 ## 5 1 13 4.94 ## 6 1 13 5.19 ## 7 1 14 5.18 ## 8 1 14 5.67 ## 9 1 15 5.02 ## 10 1 15 5.88 ## 11 1 22 5.12 ## 12 1 23 5.24 ## 13 1 24 5.88 ## 14 1 27 5.40 ## 15 1 28 5.59 ## 16 1 28 5.77 ## 17 1 30 5.57 ## 18 1 34 5.86 ## 19 1 34 5.87 ## 20 1 35 4.65 ## 21 1 35 5.34 ## 22 1 36 4.93 ## 23 1 36 5.33 ## 24 1 36 4.99 ## 25 1 41 3.38 ## 26 1 42 5.44 ## 27 1 42 5.24 ## 28 1 43 5.39 ## 29 2 3 5.34 ## 30 2 3 5.27 ## 31 2 3 5.48 ## 32 2 6 5.15 ## 33 2 11 4.23 ## 34 2 11 5.77 ## 35 2 11 5.06 ## 36 2 12 5.33 ## 37 2 12 5.78 ## 38 2 13 5.01 ## 39 2 13 4.85 ## 40 2 13 4.94 ## 41 2 18 5.14 ## 42 2 24 5.43 ## 43 2 24 5.66 ## 44 2 25 5.62 ## 45 2 25 5.53 ## 46 2 26 6.20 ## 47 2 27 5.30 ## 48 2 27 4.09 ## 49 2 32 5.78 ## 50 2 32 5.66 ## 51 2 34 5.07 ## 52 2 38 5.45 ## 53 2 40 4.76 ## 54 2 42 4.81 ## 55 2 45 4.92 ## 56 2 46 4.32 ## 57 2 47 3.30 ## 58 3 1 5.88 ## 59 3 2 5.91 ## 60 3 5 0.86 ## 61 3 6 5.40 ## 62 3 7 4.94 ## 63 3 8 5.42 ## 64 3 13 5.40 ## 65 3 15 5.68 ## 66 3 15 5.71 ## 67 3 21 9.55 ## 68 3 21 5.94 ## 69 3 21 6.17 ## 70 3 22 5.34 ## 71 3 22 8.14 ## 72 3 27 5.51 ## 73 3 28 5.31 ## 74 3 28 4.81 ## 75 3 28 5.26 ## 76 3 29 4.72 ## 77 3 30 5.08 ## 78 3 30 3.99 ## 79 3 33 4.87 ## 80 3 34 4.92 ## 81 3 34 6.13 ## 82 3 35 6.30 ## 83 3 36 5.97 ## 84 3 37 5.98 ## 85 3 41 6.68 ## 86 3 42 5.33 ## 87 3 43 6.08 ## 88 3 44 4.76 ## 89 3 47 5.31 ## 90 3 47 6.66 ## 91 3 48 5.52 ## 92 3 49 5.48 ## 93 3 50 5.10 ## 94 4 5 5.12 ## 95 4 5 5.08 ## 96 4 5 4.63 ## 97 4 5 5.38 ## 98 4 7 5.78 ## 99 4 9 9.34 ## 100 4 11 5.58 ## 101 4 11 5.19 ## 102 4 12 5.25 ## 103 4 12 5.44 ## 104 4 14 5.31 ## 105 4 14 4.71 ## 106 4 14 5.67 ## 107 4 14 4.65 ## 108 4 14 5.05 ## 109 4 15 4.23 ## 110 4 19 5.02 ## 111 4 19 4.98 ## 112 4 20 5.08 ## 113 4 20 4.84 ## 114 4 22 4.84 ## 115 4 22 5.53 ## 116 4 25 5.85 ## 117 4 25 5.32 ## 118 4 26 5.47 ## 119 5 1 5.49 ## 120 5 2 5.43 ## 121 5 6 5.02 ## 122 5 6 5.29 ## 123 5 7 6.25 ## 124 5 9 4.63 ## 125 5 10 5.18 ## 126 5 15 5.17 ## 127 5 15 4.98 ## 128 5 15 5.38 ## 129 5 15 3.76 ## 130 5 17 5.63 ## 131 5 21 6.12 ## 132 5 22 4.00 ## 133 5 23 6.53 ## 134 5 24 4.67 ## 135 5 24 5.55 ## 136 5 24 5.62 ## 137 5 29 4.58 ## 138 5 30 5.41 ## 139 5 35 4.84 ## 140 5 37 4.83 ## 141 5 37 5.36 ## 142 5 37 4.81 ## 143 5 37 5.35 ## 144 5 42 5.46 ## 145 5 43 5.09 ## 146 5 44 4.78 ## 147 5 44 4.44 ## 148 5 45 4.67 ## 149 5 48 4.98 ## 150 6 2 4.56 ## 151 6 3 5.83 ## 152 6 3 5.27 ## 153 6 4 4.90 ## 154 7 1 4.94 ## 155 7 2 4.78 ## 156 7 3 5.42 ## 157 7 4 5.42 ## 158 7 5 5.38 ## 159 7 7 5.55 ## 160 7 10 5.81 ## 161 7 10 5.62 ## 162 7 11 6.08 ## 163 7 15 4.80 ## 164 7 16 5.32 ## 165 7 17 4.95 ## 166 7 17 5.44 ## 167 7 18 5.48 ## 168 7 21 5.26 ## 169 7 22 5.21 ## 170 7 23 4.65 ## 171 7 24 4.62 ## 172 7 24 5.15 ## 173 7 26 4.71 ## 174 7 27 5.02 ## 175 7 29 5.38 ## 176 7 31 5.34 ## 177 7 31 5.10 ## 178 7 32 5.69 ## 179 7 36 5.00 ## 180 7 37 5.02 ## 181 7 38 9.74 ## 182 7 38 9.60 ## 183 7 39 5.58 ## 184 7 42 4.94 ## 185 7 43 4.66 ## 186 7 43 5.23 ## 187 7 45 5.62 ## 188 7 45 5.53 ## 189 7 45 5.45 ## 190 7 45 4.63 ## 191 7 47 5.01 ## 192 7 50 5.43 ## 193 8 1 6.17 ## 194 8 1 5.57 ## 195 8 2 4.82 ## 196 8 3 5.84 ## 197 8 6 5.55 ## 198 8 9 5.17 ## 199 8 9 6.50 ## 200 8 9 5.36 ## 201 9 4 5.47 ## 202 9 4 5.57 ## 203 9 5 5.36 ## 204 9 7 4.93 ## 205 9 8 5.49 ## 206 9 11 3.25 ## 207 9 13 5.53 ## 208 9 13 4.91 ## 209 9 13 5.74 ## 210 9 14 4.95 ## 211 9 15 5.07 ## 212 9 19 5.54 ## 213 9 20 5.29 ## 214 9 21 4.59 ## 215 9 25 5.66 ## 216 9 26 4.69 ## 217 9 26 5.18 ## 218 9 27 5.19 ## 219 9 27 5.35 ## 220 9 29 5.28 ## 221 9 29 5.50 ## 222 9 29 5.00 ## 223 9 30 5.47 ## 224 9 33 5.55 ## 225 9 34 5.75 ## 226 9 35 5.41 ## 227 9 35 5.65 ## 228 9 35 5.25 ## 229 9 36 5.81 ## 230 9 40 4.71 ## 231 9 41 4.95 ## 232 10 4 6.00 ## 233 10 5 5.74 ## 234 10 6 5.68 ## 235 10 6 5.83 ## 236 10 11 5.30 ## 237 10 13 5.63 plot(IGF) # Figure 4.6 fm1IGF.lis &lt;- lmList(IGF) coef(fm1IGF.lis) ## (Intercept) age ## 9 5.0986 0.0057276 ## 6 4.6300 0.1700000 ## 1 5.4929 -0.0077901 ## 10 6.0516 -0.0473282 ## 2 5.4764 -0.0144271 ## 8 5.5922 0.0060638 ## 5 5.3732 -0.0095140 ## 4 5.5768 -0.0166578 ## 3 5.2788 0.0100830 ## 7 5.2069 0.0093136 plot(intervals(fm1IGF.lis)) # Figure 4.7 fm1IGF.lm &lt;- lm(conc ~ age, data = IGF) summary(fm1IGF.lm) ## ## Call: ## lm(formula = conc ~ age, data = IGF) ## ## Residuals: ## Min 1Q Median 3Q Max ## -4.488 -0.374 -0.009 0.258 4.414 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 5.351059 0.103734 51.58 &lt;2e-16 *** ## age -0.000669 0.003943 -0.17 0.87 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 0.833 on 235 degrees of freedom ## Multiple R-squared: 0.000123, Adjusted R-squared: -0.00413 ## F-statistic: 0.0288 on 1 and 235 DF, p-value: 0.865 # 4.2 Fitting Linear Mixed-Effects Models with lme fm1Orth.lme &lt;- lme(distance ~ I(age-11), data = Orthodont, random = ~ I(age-11) | Subject) fm1Orth.lme &lt;- lme(distance ~ I(age-11), data = Orthodont) fm1Orth.lme &lt;- lme(fm2Orth.lis) fm1Orth.lme ## Linear mixed-effects model fit by REML ## Data: Orthodont ## Log-restricted-likelihood: -221.32 ## Fixed: distance ~ I(age - 11) ## (Intercept) I(age - 11) ## 24.02315 0.66019 ## ## Random effects: ## Formula: ~I(age - 11) | Subject ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 2.13433 (Intr) ## I(age - 11) 0.22643 0.503 ## Residual 1.31004 ## ## Number of Observations: 108 ## Number of Groups: 27 fm2Orth.lme &lt;- update(fm1Orth.lme, distance~Sex*I(age-11)) summary(fm2Orth.lme) ## Linear mixed-effects model fit by REML ## Data: Orthodont ## AIC BIC logLik ## 451.35 472.51 -217.68 ## ## Random effects: ## Formula: ~I(age - 11) | Subject ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 1.83033 (Intr) ## I(age - 11) 0.18035 0.206 ## Residual 1.31004 ## ## Fixed effects: distance ~ Sex + I(age - 11) + Sex:I(age - 11) ## Value Std.Error DF t-value p-value ## (Intercept) 23.8082 0.38071 79 62.537 0.0000 ## Sex1 -1.1605 0.38071 25 -3.048 0.0054 ## I(age - 11) 0.6320 0.06737 79 9.381 0.0000 ## Sex1:I(age - 11) -0.1524 0.06737 79 -2.262 0.0264 ## Correlation: ## (Intr) Sex1 I(-11) ## Sex1 0.185 ## I(age - 11) 0.102 0.019 ## Sex1:I(age - 11) 0.019 0.102 0.185 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -3.1680786 -0.3859391 0.0071036 0.4451545 3.8494635 ## ## Number of Observations: 108 ## Number of Groups: 27 fitted(fm2Orth.lme, level = 0:1) ## fixed Subject ## 1 22.616 24.846 ## 2 24.184 26.576 ## 3 25.753 28.307 ## 4 27.322 30.038 ## 5 22.616 21.275 ## 6 24.184 22.796 ## 7 25.753 24.318 ## 8 27.322 25.840 ## 9 22.616 22.033 ## 10 24.184 23.564 ## 11 25.753 25.096 ## 12 27.322 26.627 ## 13 22.616 24.465 ## 14 24.184 25.751 ## 15 25.753 27.038 ## 16 27.322 28.325 ## 17 22.616 20.902 ## 18 24.184 22.454 ## 19 25.753 24.006 ## 20 27.322 25.558 ## 21 22.616 23.885 ## 22 24.184 25.433 ## 23 25.753 26.980 ## 24 27.322 28.528 ## 25 22.616 21.574 ## 26 24.184 23.118 ## 27 25.753 24.663 ## 28 27.322 26.208 ## 29 22.616 21.992 ## 30 24.184 23.313 ## 31 25.753 24.634 ## 32 27.322 25.955 ## 33 22.616 22.608 ## 34 24.184 24.282 ## 35 25.753 25.957 ## 36 27.322 27.632 ## 37 22.616 26.473 ## 38 24.184 28.143 ## 39 25.753 29.813 ## 40 27.322 31.483 ## 41 22.616 21.817 ## 42 24.184 23.105 ## 43 25.753 24.393 ## 44 27.322 25.680 ## 45 22.616 21.849 ## 46 24.184 23.514 ## 47 25.753 25.179 ## 48 27.322 26.844 ## 49 22.616 21.150 ## 50 24.184 23.323 ## 51 25.753 25.496 ## 52 27.322 27.669 ## 53 22.616 22.727 ## 54 24.184 24.155 ## 55 25.753 25.582 ## 56 27.322 27.010 ## 57 22.616 23.131 ## 58 24.184 24.906 ## 59 25.753 26.681 ## 60 27.322 28.456 ## 61 22.616 21.123 ## 62 24.184 22.515 ## 63 25.753 23.906 ## 64 27.322 25.298 ## 65 21.209 20.210 ## 66 22.168 21.079 ## 67 23.127 21.949 ## 68 24.086 22.818 ## 69 21.209 21.271 ## 70 22.168 22.411 ## 71 23.127 23.551 ## 72 24.086 24.690 ## 73 21.209 21.869 ## 74 22.168 23.055 ## 75 23.127 24.241 ## 76 24.086 25.427 ## 77 21.209 23.096 ## 78 22.168 24.111 ## 79 23.127 25.127 ## 80 24.086 26.142 ## 81 21.209 21.340 ## 82 22.168 22.190 ## 83 23.127 23.039 ## 84 24.086 23.888 ## 85 21.209 19.998 ## 86 22.168 20.861 ## 87 23.127 21.724 ## 88 24.086 22.587 ## 89 21.209 21.455 ## 90 22.168 22.461 ## 91 23.127 23.467 ## 92 24.086 24.473 ## 93 21.209 22.048 ## 94 22.168 22.864 ## 95 23.127 23.679 ## 96 24.086 24.495 ## 97 21.209 20.072 ## 98 22.168 20.881 ## 99 23.127 21.691 ## 100 24.086 22.500 ## 101 21.209 17.723 ## 102 22.168 18.557 ## 103 23.127 19.391 ## 104 24.086 20.224 ## 105 21.209 24.217 ## 106 22.168 25.379 ## 107 23.127 26.541 ## 108 24.086 27.703 resid(fm2Orth.lme, level = 1) ## M01 M01 M01 M01 M02 M02 ## 1.154283 -1.576486 0.692746 0.961977 0.225217 -0.296407 ## M02 M02 M03 M03 M03 M03 ## -1.318032 0.660344 0.966890 -1.064494 -1.095878 0.872738 ## M04 M04 M04 M04 M05 M05 ## 1.035486 1.748672 -0.538141 -1.324955 -0.902492 1.045706 ## M05 M05 M06 M06 M06 M06 ## -1.506096 0.442103 0.614730 0.067279 0.019829 -0.027622 ## M07 M07 M07 M07 M08 M08 ## 0.426494 -1.118402 -0.163298 0.291806 2.008130 -1.812912 ## M08 M08 M09 M09 M09 M09 ## -0.133954 -0.454997 0.392480 -3.782285 5.042950 -1.631816 ## M10 M10 M10 M10 M11 M11 ## 1.027279 -0.142836 1.187049 0.016934 1.182757 -0.104955 ## M11 M11 M12 M12 M12 M12 ## -0.892667 -0.680378 -0.349193 -0.014198 -1.179204 1.155790 ## M13 M13 M13 M13 M14 M14 ## -4.150308 1.176924 0.504156 1.831387 -0.227160 1.345200 ## M14 M14 M15 M15 M15 M15 ## -0.082440 -1.010081 -0.131400 -0.406157 -0.680914 1.544329 ## M16 M16 M16 M16 F01 F01 ## 0.876807 -1.014648 -0.406104 -0.297560 0.790268 -1.079313 ## F01 F01 F02 F02 F02 F02 ## -0.448894 0.181525 -0.271239 -0.910917 0.449404 0.809726 ## F03 F03 F03 F03 F04 F04 ## -1.368686 0.945093 0.258872 0.572650 0.404093 0.388577 ## F04 F04 F05 F05 F05 F05 ## -0.126940 0.357543 0.159651 0.810487 -0.538676 -0.387840 ## F06 F06 F06 F06 F07 F07 ## 0.001678 0.138703 -0.724272 -0.087247 0.044844 0.038787 ## F07 F07 F08 F08 F08 F08 ## -0.467269 0.526674 0.951854 0.136320 -0.179213 -0.494747 ## F09 F09 F09 F09 F10 F10 ## -0.071889 0.118585 0.309059 -1.000467 -1.223341 0.442963 ## F10 F10 F11 F11 F11 F11 ## -0.390733 -0.724429 0.282766 -0.379285 1.458663 0.296612 ## attr(,&quot;label&quot;) ## [1] &quot;Residuals (mm)&quot; resid(fm2Orth.lme, level = 1, type = &quot;pearson&quot;) ## M01 M01 M01 M01 M02 ## 0.8811052 -1.2033880 0.5287974 0.7343114 0.1719165 ## M02 M02 M02 M03 M03 ## -0.2262581 -1.0061006 0.5040641 0.7380620 -0.8125661 ## M03 M03 M04 M04 M04 ## -0.8365227 0.6661921 0.7904232 1.3348239 -0.4107824 ## M04 M05 M05 M05 M05 ## -1.0113852 -0.6889046 0.7982247 -1.1496566 0.3374727 ## M06 M06 M06 M06 M07 ## 0.4692451 0.0513565 0.0151358 -0.0210849 0.3255581 ## M07 M07 M07 M08 M08 ## -0.8537162 -0.1246512 0.2227459 1.5328775 -1.3838606 ## M08 M08 M09 M09 M09 ## -0.1022522 -0.3473153 0.2995943 -2.8871533 3.8494635 ## M09 M10 M10 M10 M10 ## -1.2456233 0.7841584 -0.1090320 0.9061168 0.0129264 ## M11 M11 M11 M11 M12 ## 0.9028406 -0.0801158 -0.6814043 -0.5193571 -0.2665512 ## M12 M12 M12 M13 M13 ## -0.0108382 -0.9001287 0.8822558 -3.1680786 0.8983878 ## M13 M13 M14 M14 M14 ## 0.3848399 1.3979635 -0.1733994 1.0268390 -0.0629297 ## M14 M15 M15 M15 M15 ## -0.7710306 -0.1003021 -0.3100340 -0.5197659 1.1788415 ## M16 M16 M16 M16 F01 ## 0.6692984 -0.7745173 -0.3099937 -0.2271380 0.6032397 ## F01 F01 F01 F02 F02 ## -0.8238783 -0.3426570 0.1385643 -0.2070463 -0.6953357 ## F02 F02 F03 F03 F03 ## 0.3430464 0.6180928 -1.0447667 0.7214231 0.1976059 ## F03 F04 F04 F04 F04 ## 0.4371243 0.3084590 0.2966144 -0.0968981 0.2729252 ## F05 F05 F05 F05 F06 ## 0.1218671 0.6186738 -0.4111909 -0.2960520 0.0012809 ## F06 F06 F06 F07 F07 ## 0.1058771 -0.5528625 -0.0665984 0.0342312 0.0296079 ## F07 F07 F08 F08 F08 ## -0.3566833 0.4020292 0.7265839 0.1040580 -0.1368000 ## F08 F09 F09 F09 F09 ## -0.3776580 -0.0548753 0.0905202 0.2359157 -0.7636924 ## F10 F10 F10 F10 F11 ## -0.9338198 0.3381295 -0.2982604 -0.5529825 0.2158457 ## F11 F11 F11 ## -0.2895219 1.1134498 0.2264144 ## attr(,&quot;label&quot;) ## [1] &quot;Standardized residuals&quot; newOrth &lt;- data.frame(Subject = rep(c(&quot;M11&quot;,&quot;F03&quot;), c(3, 3)), Sex = rep(c(&quot;Male&quot;, &quot;Female&quot;), c(3, 3)), age = rep(16:18, 2)) predict(fm2Orth.lme, newdata = newOrth) ## M11 M11 M11 F03 F03 F03 ## 26.968 27.612 28.256 26.614 27.207 27.800 ## attr(,&quot;label&quot;) ## [1] &quot;Predicted values (mm)&quot; predict(fm2Orth.lme, newdata = newOrth, level = 0:1) ## Subject predict.fixed predict.Subject ## 1 M11 28.891 26.968 ## 2 M11 29.675 27.612 ## 3 M11 30.459 28.256 ## 4 F03 25.045 26.614 ## 5 F03 25.525 27.207 ## 6 F03 26.005 27.800 fm2Orth.lmeM &lt;- update(fm2Orth.lme, method = &quot;ML&quot;) summary(fm2Orth.lmeM) ## Linear mixed-effects model fit by maximum likelihood ## Data: Orthodont ## AIC BIC logLik ## 443.81 465.26 -213.9 ## ## Random effects: ## Formula: ~I(age - 11) | Subject ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 1.75219 (Intr) ## I(age - 11) 0.15414 0.234 ## Residual 1.31004 ## ## Fixed effects: distance ~ Sex + I(age - 11) + Sex:I(age - 11) ## Value Std.Error DF t-value p-value ## (Intercept) 23.8082 0.37332 79 63.775 0.0000 ## Sex1 -1.1605 0.37332 25 -3.109 0.0046 ## I(age - 11) 0.6320 0.06606 79 9.567 0.0000 ## Sex1:I(age - 11) -0.1524 0.06606 79 -2.307 0.0237 ## Correlation: ## (Intr) Sex1 I(-11) ## Sex1 0.185 ## I(age - 11) 0.102 0.019 ## Sex1:I(age - 11) 0.019 0.102 0.185 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -3.336029 -0.415398 0.010392 0.491695 3.858193 ## ## Number of Observations: 108 ## Number of Groups: 27 compOrth &lt;- compareFits(coef(fm2Orth.lis), coef(fm1Orth.lme)) compOrth ## , , (Intercept) ## ## coef(fm2Orth.lis) coef(fm1Orth.lme) ## M16 23.000 23.078 ## M05 23.000 23.128 ## M02 23.375 23.455 ## M11 23.625 23.607 ## M07 23.750 23.799 ## M08 23.875 23.841 ## M03 24.250 24.244 ## M12 24.250 24.285 ## M13 24.250 24.444 ## M14 24.875 24.772 ## M09 25.125 25.074 ## M15 25.875 25.778 ## M06 26.375 26.156 ## M04 26.625 26.299 ## M01 27.750 27.447 ## M10 29.500 28.999 ## F10 18.500 18.985 ## F09 21.125 21.334 ## F06 21.125 21.350 ## F01 21.375 21.577 ## F05 22.625 22.692 ## F07 23.000 23.078 ## F02 23.000 23.120 ## F08 23.375 23.355 ## F03 23.750 23.807 ## F04 24.875 24.764 ## F11 26.375 26.156 ## ## , , I(age - 11) ## ## coef(fm2Orth.lis) coef(fm1Orth.lme) ## M16 0.550 0.59133 ## M05 0.850 0.68579 ## M02 0.775 0.67469 ## M11 0.325 0.54136 ## M07 0.800 0.69509 ## M08 0.375 0.56545 ## M03 0.750 0.69604 ## M12 1.000 0.77475 ## M13 1.950 1.07385 ## M14 0.525 0.64607 ## M09 0.975 0.79609 ## M15 1.125 0.86836 ## M06 0.675 0.74338 ## M04 0.175 0.59430 ## M01 0.950 0.87587 ## M10 0.750 0.87133 ## F10 0.450 0.40959 ## F09 0.275 0.44214 ## F06 0.375 0.47363 ## F01 0.375 0.48198 ## F05 0.275 0.49223 ## F07 0.550 0.59133 ## F02 0.800 0.67004 ## F08 0.175 0.48578 ## F03 0.850 0.71083 ## F04 0.475 0.63032 ## F11 0.675 0.74338 plot(compOrth, mark = fixef(fm1Orth.lme)) # Figure 4.8 ## Figure 4.9 plot(comparePred(fm2Orth.lis, fm1Orth.lme, length.out = 2), layout = c(8,4), between = list(y = c(0, 0.5, 0))) plot(compareFits(ranef(fm2Orth.lme), ranef(fm2Orth.lmeM)), mark = c(0, 0)) fm4Orth.lm &lt;- lm(distance ~ Sex * I(age-11), Orthodont) summary(fm4Orth.lm) ## ## Call: ## lm(formula = distance ~ Sex * I(age - 11), data = Orthodont) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.616 -1.322 -0.168 1.330 5.247 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 23.8082 0.2210 107.73 &lt; 2e-16 *** ## Sex1 -1.1605 0.2210 -5.25 8.1e-07 *** ## I(age - 11) 0.6320 0.0988 6.39 4.7e-09 *** ## Sex1:I(age - 11) -0.1524 0.0988 -1.54 0.13 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.26 on 104 degrees of freedom ## Multiple R-squared: 0.423, Adjusted R-squared: 0.406 ## F-statistic: 25.4 on 3 and 104 DF, p-value: 2.11e-12 anova(fm2Orth.lme, fm4Orth.lm) ## Model df AIC BIC logLik Test L.Ratio ## fm2Orth.lme 1 8 451.35 472.51 -217.68 ## fm4Orth.lm 2 5 496.33 509.55 -243.17 1 vs 2 50.977 ## p-value ## fm2Orth.lme ## fm4Orth.lm &lt;.0001 #fm1IGF.lme &lt;- lme(fm1IGF.lis) #fm1IGF.lme #intervals(fm1IGF.lme) #summary(fm1IGF.lme) pd1 &lt;- pdDiag(~ age) pd1 ## Uninitialized positive definite matrix structure of class pdDiag. formula(pd1) ## ~age #fm2IGF.lme &lt;- update(fm1IGF.lme, random = pdDiag(~age)) (fm2IGF.lme &lt;- lme(conc ~ age, IGF, random = pdDiag(~age))) ## Linear mixed-effects model fit by REML ## Data: IGF ## Log-restricted-likelihood: -297.4 ## Fixed: conc ~ age ## (Intercept) age ## 5.3690370 -0.0019301 ## ## Random effects: ## Formula: ~age | Lot ## Structure: Diagonal ## (Intercept) age Residual ## StdDev: 3.6221e-05 0.0053722 0.8218 ## ## Number of Observations: 237 ## Number of Groups: 10 #anova(fm1IGF.lme, fm2IGF.lme) anova(fm2IGF.lme) ## numDF denDF F-value p-value ## (Intercept) 1 226 6438.9 &lt;.0001 ## age 1 226 0.2 0.6732 #update(fm1IGF.lme, random = list(Lot = pdDiag(~ age))) pd2 &lt;- pdDiag(value = diag(2), form = ~ age) pd2 ## Positive definite matrix structure of class pdDiag representing ## [,1] [,2] ## [1,] 1 0 ## [2,] 0 1 formula(pd2) ## ~age lme(conc ~ age, IGF, pdDiag(diag(2), ~age)) ## Linear mixed-effects model fit by REML ## Data: IGF ## Log-restricted-likelihood: -297.4 ## Fixed: conc ~ age ## (Intercept) age ## 5.3690370 -0.0019301 ## ## Random effects: ## Formula: ~age | Lot ## Structure: Diagonal ## (Intercept) age Residual ## StdDev: 3.1119e-05 0.0053722 0.8218 ## ## Number of Observations: 237 ## Number of Groups: 10 fm4OatsB &lt;- lme(yield ~ nitro, data = Oats, random =list(Block = pdCompSymm(~ Variety - 1))) summary(fm4OatsB) ## Linear mixed-effects model fit by REML ## Data: Oats ## AIC BIC logLik ## 603.04 614.28 -296.52 ## ## Random effects: ## Formula: ~Variety - 1 | Block ## Structure: Compound Symmetry ## StdDev Corr ## VarietyGolden Rain 18.208 ## VarietyMarvellous 18.208 0.635 ## VarietyVictory 18.208 0.635 0.635 ## Residual 12.867 ## ## Fixed effects: yield ~ nitro ## Value Std.Error DF t-value p-value ## (Intercept) 81.872 6.9453 65 11.788 0 ## nitro 73.667 6.7815 65 10.863 0 ## Correlation: ## (Intr) ## nitro -0.293 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.743807 -0.664752 0.017104 0.542988 1.802988 ## ## Number of Observations: 72 ## Number of Groups: 6 corMatrix(fm4OatsB$modelStruct$reStruct$Block)[1,2] ## [1] 0.63471 fm4OatsC &lt;- lme(yield ~ nitro, data = Oats, random=list(Block=pdBlocked(list(pdIdent(~ 1), pdIdent(~ Variety-1))))) summary(fm4OatsC) ## Linear mixed-effects model fit by REML ## Data: Oats ## AIC BIC logLik ## 603.04 614.28 -296.52 ## ## Random effects: ## Composite Structure: Blocked ## ## Block 1: (Intercept) ## Formula: ~1 | Block ## (Intercept) ## StdDev: 14.506 ## ## Block 2: VarietyGolden Rain, VarietyMarvellous, VarietyVictory ## Formula: ~Variety - 1 | Block ## Structure: Multiple of an Identity ## VarietyGolden Rain VarietyMarvellous VarietyVictory ## StdDev: 11.005 11.005 11.005 ## Residual ## StdDev: 12.867 ## ## Fixed effects: yield ~ nitro ## Value Std.Error DF t-value p-value ## (Intercept) 81.872 6.9453 65 11.788 0 ## nitro 73.667 6.7815 65 10.863 0 ## Correlation: ## (Intr) ## nitro -0.293 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.743807 -0.664752 0.017104 0.542988 1.802988 ## ## Number of Observations: 72 ## Number of Groups: 6 ## establishing the desired parameterization for contrasts options(contrasts = c(&quot;contr.treatment&quot;, &quot;contr.poly&quot;)) fm1Assay &lt;- lme(logDens ~ sample * dilut, Assay, random = pdBlocked(list(pdIdent(~ 1), pdIdent(~ sample - 1), pdIdent(~ dilut - 1)))) fm1Assay ## Linear mixed-effects model fit by REML ## Data: Assay ## Log-restricted-likelihood: 38.536 ## Fixed: logDens ~ sample * dilut ## (Intercept) sampleb samplec sampled ## -0.1827915 0.0807533 0.1339763 0.2076987 ## samplee samplef dilut2 dilut3 ## -0.0236724 0.0735692 0.2044290 0.4058631 ## dilut4 dilut5 sampleb:dilut2 samplec:dilut2 ## 0.5731910 0.7206355 0.0089389 -0.0084953 ## sampled:dilut2 samplee:dilut2 samplef:dilut2 sampleb:dilut3 ## 0.0010793 -0.0419175 0.0193521 -0.0250660 ## samplec:dilut3 sampled:dilut3 samplee:dilut3 samplef:dilut3 ## 0.0186451 0.0039886 -0.0277128 0.0543160 ## sampleb:dilut4 samplec:dilut4 sampled:dilut4 samplee:dilut4 ## 0.0607886 0.0052598 -0.0164855 0.0497988 ## samplef:dilut4 sampleb:dilut5 samplec:dilut5 sampled:dilut5 ## 0.0633719 -0.0457625 -0.0725982 -0.1777566 ## samplee:dilut5 samplef:dilut5 ## 0.0136109 0.0040234 ## ## Random effects: ## Composite Structure: Blocked ## ## Block 1: (Intercept) ## Formula: ~1 | Block ## (Intercept) ## StdDev: 0.0098087 ## ## Block 2: samplea, sampleb, samplec, sampled, samplee, samplef ## Formula: ~sample - 1 | Block ## Structure: Multiple of an Identity ## samplea sampleb samplec sampled samplee samplef ## StdDev: 0.025289 0.025289 0.025289 0.025289 0.025289 0.025289 ## ## Block 3: dilut1, dilut2, dilut3, dilut4, dilut5 ## Formula: ~dilut - 1 | Block ## Structure: Multiple of an Identity ## dilut1 dilut2 dilut3 dilut4 dilut5 ## StdDev: 0.0091257 0.0091257 0.0091257 0.0091257 0.0091257 ## Residual ## StdDev: 0.041566 ## ## Number of Observations: 60 ## Number of Groups: 2 anova(fm1Assay) ## numDF denDF F-value p-value ## (Intercept) 1 29 538.02 &lt;.0001 ## sample 5 29 11.21 &lt;.0001 ## dilut 4 29 420.79 &lt;.0001 ## sample:dilut 20 29 1.61 0.1193 formula(Oxide) ## Thickness ~ 1 | Lot/Wafer fm1Oxide &lt;- lme(Thickness ~ 1, Oxide) fm1Oxide ## Linear mixed-effects model fit by REML ## Data: Oxide ## Log-restricted-likelihood: -227.01 ## Fixed: Thickness ~ 1 ## (Intercept) ## 2000.2 ## ## Random effects: ## Formula: ~1 | Lot ## (Intercept) ## StdDev: 11.398 ## ## Formula: ~1 | Wafer %in% Lot ## (Intercept) Residual ## StdDev: 5.9888 3.5453 ## ## Number of Observations: 72 ## Number of Groups: ## Lot Wafer %in% Lot ## 8 24 intervals(fm1Oxide, which = &quot;var-cov&quot;) ## Approximate 95% confidence intervals ## ## Random Effects: ## Level: Lot ## lower est. upper ## sd((Intercept)) 6.3901 11.398 20.33 ## Level: Wafer ## lower est. upper ## sd((Intercept)) 4.0648 5.9888 8.8235 ## ## Within-group standard error: ## lower est. upper ## 2.9026 3.5453 4.3304 fm2Oxide &lt;- update(fm1Oxide, random = ~ 1 | Lot) anova(fm1Oxide, fm2Oxide) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm1Oxide 1 4 462.02 471.07 -227.01 ## fm2Oxide 2 3 497.13 503.92 -245.57 1 vs 2 37.11 &lt;.0001 coef(fm1Oxide, level = 1) ## (Intercept) ## 1 1996.7 ## 2 1988.9 ## 3 2001.0 ## 4 1995.7 ## 5 2013.6 ## 6 2019.6 ## 7 1992.0 ## 8 1993.8 coef(fm1Oxide, level = 2) ## (Intercept) ## 1/1 2003.2 ## 1/2 1984.7 ## 1/3 2001.1 ## 2/1 1989.6 ## 2/2 1988.1 ## 2/3 1986.0 ## 3/1 2002.5 ## 3/2 2000.4 ## 3/3 2000.4 ## 4/1 1995.7 ## 4/2 1999.0 ## 4/3 1991.2 ## 5/1 2009.2 ## 5/2 2016.6 ## 5/3 2018.7 ## 6/1 2031.3 ## 6/2 2021.7 ## 6/3 2011.0 ## 7/1 1990.2 ## 7/2 1991.4 ## 7/3 1992.0 ## 8/1 1993.7 ## 8/2 1995.2 ## 8/3 1990.7 ranef(fm1Oxide, level = 1:2) ## Level: Lot ## (Intercept) ## 1 -3.46347 ## 2 -11.22164 ## 3 0.86902 ## 4 -4.47102 ## 5 13.46345 ## 6 19.40802 ## 7 -8.19898 ## 8 -6.38538 ## ## Level: Wafer %in% Lot ## (Intercept) ## 1/1 6.545993 ## 1/2 -11.958939 ## 1/3 4.456726 ## 2/1 0.658593 ## 2/2 -0.833740 ## 2/3 -2.923007 ## 3/1 1.472819 ## 3/2 -0.616447 ## 3/3 -0.616447 ## 4/1 -0.013509 ## 4/2 3.269624 ## 4/3 -4.490509 ## 5/1 -4.431836 ## 5/2 3.029830 ## 5/3 5.119096 ## 6/1 11.734992 ## 6/2 2.184059 ## 6/3 -8.560740 ## 7/1 -1.749434 ## 7/2 -0.555567 ## 7/3 0.041366 ## 8/1 -0.090197 ## 8/2 1.402137 ## 8/3 -3.074863 fm1Wafer &lt;- lme(current ~ voltage + I(voltage^2), data = Wafer, random = list(Wafer = pdDiag(~voltage + I(voltage^2)), Site = pdDiag(~voltage + I(voltage^2)))) summary(fm1Wafer) ## Linear mixed-effects model fit by REML ## Data: Wafer ## AIC BIC logLik ## -281.51 -241.67 150.75 ## ## Random effects: ## Formula: ~voltage + I(voltage^2) | Wafer ## Structure: Diagonal ## (Intercept) voltage I(voltage^2) ## StdDev: 2.8048e-05 0.18709 0.02501 ## ## Formula: ~voltage + I(voltage^2) | Site %in% Wafer ## Structure: Diagonal ## (Intercept) voltage I(voltage^2) Residual ## StdDev: 8.1679e-06 0.13578 2.4475e-08 0.1154 ## ## Fixed effects: current ~ voltage + I(voltage^2) ## Value Std.Error DF t-value p-value ## (Intercept) -4.4612 0.051283 318 -86.991 0 ## voltage 5.9034 0.092685 318 63.693 0 ## I(voltage^2) 1.1704 0.022956 318 50.984 0 ## Correlation: ## (Intr) voltag ## voltage -0.735 ## I(voltage^2) 0.884 -0.698 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.896615 -0.535367 0.024856 0.798492 1.777664 ## ## Number of Observations: 400 ## Number of Groups: ## Wafer Site %in% Wafer ## 10 80 fitted(fm1Wafer, level = 0) ## 1 1 1 1 1 1 1 1 ## 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 ## 1 1 1 1 1 1 1 1 ## 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 ## 1 1 1 1 1 1 1 1 ## 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 ## 1 1 1 1 1 1 1 1 ## 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 ## 1 1 1 1 1 1 1 1 ## 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 ## 2 2 2 2 2 2 2 2 ## 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 ## 2 2 2 2 2 2 2 2 ## 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 ## 2 2 2 2 2 2 2 2 ## 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 ## 2 2 2 2 2 2 2 2 ## 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 ## 2 2 2 2 2 2 2 2 ## 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 ## 3 3 3 3 3 3 3 3 ## 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 ## 3 3 3 3 3 3 3 3 ## 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 ## 3 3 3 3 3 3 3 3 ## 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 ## 3 3 3 3 3 3 3 3 ## 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 ## 3 3 3 3 3 3 3 3 ## 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 ## 4 4 4 4 4 4 4 4 ## 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 ## 4 4 4 4 4 4 4 4 ## 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 ## 4 4 4 4 4 4 4 4 ## 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 ## 4 4 4 4 4 4 4 4 ## 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 ## 4 4 4 4 4 4 4 4 ## 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 ## 5 5 5 5 5 5 5 5 ## 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 ## 5 5 5 5 5 5 5 5 ## 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 ## 5 5 5 5 5 5 5 5 ## 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 ## 5 5 5 5 5 5 5 5 ## 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 ## 5 5 5 5 5 5 5 5 ## 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 ## 6 6 6 6 6 6 6 6 ## 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 ## 6 6 6 6 6 6 6 6 ## 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 ## 6 6 6 6 6 6 6 6 ## 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 ## 6 6 6 6 6 6 6 6 ## 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 ## 6 6 6 6 6 6 6 6 ## 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 ## 7 7 7 7 7 7 7 7 ## 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 ## 7 7 7 7 7 7 7 7 ## 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 ## 7 7 7 7 7 7 7 7 ## 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 ## 7 7 7 7 7 7 7 7 ## 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 ## 7 7 7 7 7 7 7 7 ## 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 ## 8 8 8 8 8 8 8 8 ## 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 ## 8 8 8 8 8 8 8 8 ## 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 ## 8 8 8 8 8 8 8 8 ## 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 ## 8 8 8 8 8 8 8 8 ## 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 ## 8 8 8 8 8 8 8 8 ## 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 ## 9 9 9 9 9 9 9 9 ## 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 ## 9 9 9 9 9 9 9 9 ## 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 ## 9 9 9 9 9 9 9 9 ## 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 ## 9 9 9 9 9 9 9 9 ## 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 ## 9 9 9 9 9 9 9 9 ## 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 ## 10 10 10 10 10 10 10 10 ## 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 ## 10 10 10 10 10 10 10 10 ## 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 ## 10 10 10 10 10 10 10 10 ## 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 ## 10 10 10 10 10 10 10 10 ## 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 1.0106 4.3083 ## 10 10 10 10 10 10 10 10 ## 7.9805 12.0272 16.4484 1.0106 4.3083 7.9805 12.0272 16.4484 ## attr(,&quot;label&quot;) ## [1] &quot;Fitted values (mA)&quot; resid(fm1Wafer, level = 1:2) ## Wafer Site ## 1 0.06149162 0.06806224 ## 2 -0.18986907 -0.18001314 ## 3 -0.01508552 -0.00194428 ## 4 0.10376228 0.12018884 ## 5 -0.05372566 -0.03401380 ## 6 0.19261162 0.07373575 ## 7 0.04413093 -0.13418288 ## 8 0.27591448 0.03816274 ## 9 0.43176228 0.13457261 ## 10 0.30627434 -0.05035328 ## 11 0.08461162 0.06017655 ## 12 -0.15006907 -0.18672169 ## 13 0.04531448 -0.00355567 ## 14 0.18576228 0.12467459 ## 15 0.05427434 -0.01903090 ## 16 0.04221162 0.07367077 ## 17 -0.23706907 -0.18988035 ## 18 -0.07708552 -0.01416723 ## 19 0.03576228 0.11441015 ## 20 -0.12172566 -0.02734823 ## 21 0.09269162 0.07669633 ## 22 -0.14906907 -0.17306201 ## 23 0.03331448 0.00132390 ## 24 0.15976228 0.11977406 ## 25 0.01427434 -0.03371154 ## 26 -0.05776838 0.11184053 ## 27 -0.45366907 -0.19925571 ## 28 -0.37928552 -0.04006770 ## 29 -0.33983772 0.08418455 ## 30 -0.55372566 -0.04489894 ## 31 0.04701162 0.08804816 ## 32 -0.23806907 -0.17651427 ## 33 -0.09088552 -0.00881244 ## 34 0.00776228 0.11035363 ## 35 -0.16572566 -0.04261605 ## 36 0.07939162 0.08484072 ## 37 -0.17226907 -0.16409543 ## 38 -0.00648552 0.00441267 ## 39 0.10176228 0.11538503 ## 40 -0.06372566 -0.04737837 ## 41 0.03870237 0.06547614 ## 42 -0.20957294 -0.16941229 ## 43 -0.04841066 0.00513687 ## 44 0.03678919 0.10372360 ## 45 -0.11737338 -0.03705208 ## 46 0.26610237 0.15185189 ## 47 0.11402706 -0.05734866 ## 48 0.30278934 0.07428837 ## 49 0.39078919 0.10516298 ## 50 0.22662662 -0.11612483 ## 51 0.29950237 0.20513460 ## 52 0.12962706 -0.01192459 ## 53 0.28098934 0.09225380 ## 54 0.32478919 0.08886977 ## 55 0.12062662 -0.16247668 ## 56 -0.03283763 0.07244875 ## 57 -0.34397294 -0.18604337 ## 58 -0.22541066 -0.01483791 ## 59 -0.17121081 0.09200513 ## 60 -0.35337338 -0.03751424 ## 61 0.26290237 0.16078551 ## 62 0.09582706 -0.05734823 ## 63 0.27418934 0.06995561 ## 64 0.35678919 0.10149703 ## 65 0.18862662 -0.11772397 ## 66 0.00034237 0.08786719 ## 67 -0.29857294 -0.16728570 ## 68 -0.17821066 -0.00316102 ## 69 -0.12721081 0.09160124 ## 70 -0.31537338 -0.05279891 ## 71 0.10050237 0.12728460 ## 72 -0.15397294 -0.11379959 ## 73 -0.02561066 0.02795380 ## 74 0.02278919 0.08974476 ## 75 -0.16937338 -0.08902669 ## 76 0.03210237 0.09718571 ## 77 -0.24437294 -0.14674793 ## 78 -0.12061066 0.00955601 ## 79 -0.07121081 0.09149753 ## 80 -0.26137338 -0.06612337 ## 81 -0.00409944 0.05271668 ## 82 -0.27807628 -0.19285210 ## 83 -0.12769594 -0.01406370 ## 84 -0.02941844 0.11262186 ## 85 -0.19744376 -0.02699540 ## 86 0.05232056 0.08924888 ## 87 -0.20827628 -0.15288379 ## 88 -0.06729594 0.00656070 ## 89 0.01458156 0.10690237 ## 90 -0.17144376 -0.06065879 ## 91 0.11864056 0.06278202 ## 92 -0.06447628 -0.14826409 ## 93 0.13490406 0.02318698 ## 94 0.26658156 0.12693521 ## 95 0.12055624 -0.04701938 ## 96 -0.04107944 0.05126487 ## 97 -0.34667628 -0.20815981 ## 98 -0.21249594 -0.02780732 ## 99 -0.12141844 0.10944234 ## 100 -0.29744376 -0.02041083 ## 101 0.12804056 0.07986763 ## 102 -0.06607628 -0.13833567 ## 103 0.12110406 0.02475821 ## 104 0.24058156 0.12014925 ## 105 0.08855624 -0.05596254 ## 106 -0.09183944 0.07030430 ## 107 -0.45247628 -0.20926067 ## 108 -0.36189594 -0.03760846 ## 109 -0.31141844 0.09394091 ## 110 -0.51944376 -0.03301254 ## 111 0.28604056 0.14670254 ## 112 0.15452372 -0.05448331 ## 113 0.35370406 0.07502801 ## 114 0.46858156 0.12023650 ## 115 0.29855624 -0.11945783 ## 116 0.25364056 0.18384549 ## 117 0.06612372 -0.03856887 ## 118 0.21110406 0.07151393 ## 119 0.27458156 0.10009390 ## 120 0.06255624 -0.14682895 ## 121 0.11316817 0.05952180 ## 122 -0.08270359 -0.16317315 ## 123 0.12374934 0.01645659 ## 124 0.26290695 0.12879101 ## 125 0.12456925 -0.03636987 ## 126 0.19934817 0.07559681 ## 127 0.05709641 -0.12853064 ## 128 0.28854934 0.04104661 ## 129 0.44490695 0.13552854 ## 130 0.31656925 -0.05468485 ## 131 0.01056817 0.10560627 ## 132 -0.30910359 -0.16654644 ## 133 -0.19825066 -0.00817447 ## 134 -0.13909305 0.09850219 ## 135 -0.34943075 -0.06431646 ## 136 0.00036817 0.07611606 ## 137 -0.31470359 -0.20108176 ## 138 -0.17805066 -0.02655490 ## 139 -0.08309305 0.10627666 ## 140 -0.25143075 -0.02418710 ## 141 0.01626817 0.11615210 ## 142 -0.31590359 -0.16607770 ## 143 -0.21225066 -0.01248281 ## 144 -0.15509305 0.09461677 ## 145 -0.36343075 -0.06377897 ## 146 0.00434817 0.05444574 ## 147 -0.28650359 -0.21135723 ## 148 -0.12565066 -0.02545553 ## 149 -0.00909305 0.11615087 ## 150 -0.16143075 -0.01113805 ## 151 0.09684817 0.08055152 ## 152 -0.13830359 -0.16274858 ## 153 0.03934934 0.00675602 ## 154 0.15890695 0.11816530 ## 155 0.00656925 -0.04232073 ## 156 0.11878817 0.08034713 ## 157 -0.09690359 -0.15456516 ## 158 0.09094934 0.01406724 ## 159 0.21890695 0.12280433 ## 160 0.06856925 -0.04675389 ## 161 -0.02965051 0.04243418 ## 162 -0.29982054 -0.19169351 ## 163 -0.15716517 -0.01299579 ## 164 -0.06768441 0.11252732 ## 165 -0.24677825 -0.03052418 ## 166 0.11694949 0.12912786 ## 167 -0.11442054 -0.09615298 ## 168 0.01323483 0.03759157 ## 169 0.07231559 0.10276153 ## 170 -0.14677825 -0.11024313 ## 171 0.19714949 0.10180544 ## 172 0.04917946 -0.09383661 ## 173 0.24523483 0.05454673 ## 174 0.36231559 0.12395547 ## 175 0.19522175 -0.09081039 ## 176 0.04874949 0.05806269 ## 177 -0.17702054 -0.16305075 ## 178 -0.01036517 0.00826122 ## 179 0.09431559 0.11759858 ## 180 -0.07277825 -0.04483866 ## 181 0.21414949 0.10269358 ## 182 0.07377946 -0.09340440 ## 183 0.27763483 0.05472302 ## 184 0.40231559 0.12367583 ## 185 0.24922175 -0.08514596 ## 186 -0.09203051 0.05611806 ## 187 -0.42602054 -0.20379768 ## 188 -0.32696517 -0.03066803 ## 189 -0.27168441 0.09868702 ## 190 -0.47877825 -0.03433253 ## 191 0.18794949 0.12949724 ## 192 0.00497946 -0.08269892 ## 193 0.16863483 0.05173032 ## 194 0.25631559 0.11018496 ## 195 0.06922175 -0.10613500 ## 196 0.09534949 0.12015665 ## 197 -0.14562054 -0.10840980 ## 198 -0.01976517 0.02984914 ## 199 0.04031559 0.10233349 ## 200 -0.17477825 -0.10035677 ## 201 0.11531105 0.07510481 ## 202 -0.09759502 -0.15790438 ## 203 0.09464644 0.01423395 ## 204 0.22363541 0.12311980 ## 205 0.07757191 -0.04304682 ## 206 0.12105105 0.10097976 ## 207 -0.11019502 -0.14030195 ## 208 0.05884644 0.01870386 ## 209 0.16563541 0.11545719 ## 210 -0.00442809 -0.06464196 ## 211 0.07959105 0.08122908 ## 212 -0.17279502 -0.17033797 ## 213 -0.00195356 0.00132250 ## 214 0.11363541 0.11773049 ## 215 -0.04642809 -0.04151399 ## 216 0.00701105 0.07671417 ## 217 -0.30459502 -0.20004034 ## 218 -0.16395356 -0.02454733 ## 219 -0.06636459 0.10789321 ## 220 -0.23442809 -0.02531873 ## 221 0.06699105 0.08593441 ## 222 -0.20259502 -0.17417998 ## 223 -0.04275356 -0.00486684 ## 224 0.06563541 0.11299381 ## 225 -0.09642809 -0.03959801 ## 226 -0.02054895 0.09377644 ## 227 -0.37139502 -0.19990693 ## 228 -0.26175356 -0.03310279 ## 229 -0.18836459 0.09744888 ## 230 -0.37642809 -0.03345192 ## 231 0.12425105 0.09210539 ## 232 -0.09719502 -0.14541351 ## 233 0.08164644 0.01735512 ## 234 0.19963541 0.11927126 ## 235 0.03957191 -0.05686507 ## 236 0.10487105 0.08304257 ## 237 -0.12399502 -0.15673774 ## 238 0.05504644 0.01138947 ## 239 0.17363541 0.11906420 ## 240 0.01757191 -0.04791354 ## 241 0.22735631 0.09705790 ## 242 0.13672355 -0.05872405 ## 243 0.34853878 0.08794197 ## 244 0.45700198 0.13125598 ## 245 0.26891317 -0.12198204 ## 246 -0.04964369 -0.00188639 ## 247 -0.25047645 -0.17884049 ## 248 -0.08266122 0.01285339 ## 249 0.00700198 0.12639524 ## 250 -0.18508683 -0.04181492 ## 251 0.49155631 0.16444523 ## 252 0.53592355 0.04525695 ## 253 0.81473878 0.16051664 ## 254 0.96300198 0.14522431 ## 255 0.79891317 -0.18242004 ## 256 0.03555631 -0.00064411 ## 257 -0.10647645 -0.16077707 ## 258 0.10313878 0.03073795 ## 259 0.22900198 0.13850095 ## 260 0.06691317 -0.04168807 ## 261 0.08435631 0.04744489 ## 262 -0.06447645 -0.11984357 ## 263 0.12213878 0.04831594 ## 264 0.21900198 0.12672344 ## 265 0.03091317 -0.07982108 ## 266 -0.10284369 -0.00815590 ## 267 -0.34867645 -0.20664475 ## 268 -0.19786122 -0.00848562 ## 269 -0.11299802 0.12372148 ## 270 -0.31108683 -0.02702344 ## 271 -0.10404369 0.03261450 ## 272 -0.38167645 -0.17668916 ## 273 -0.27586122 -0.00254484 ## 274 -0.23499802 0.10664747 ## 275 -0.47108683 -0.06111225 ## 276 -0.12784369 0.03033930 ## 277 -0.42207645 -0.18480196 ## 278 -0.32546122 -0.00909524 ## 279 -0.29299802 0.10245946 ## 280 -0.53108683 -0.05653786 ## 281 0.27274813 0.04784036 ## 282 0.26205976 -0.07530189 ## 283 0.54638501 0.09656948 ## 284 0.71872389 0.15645448 ## 285 0.58627640 -0.08844690 ## 286 0.24994813 0.06245695 ## 287 0.20665976 -0.07457702 ## 288 0.46478501 0.08980265 ## 289 0.61672389 0.14799593 ## 290 0.46627640 -0.09619715 ## 291 -0.03265187 0.01134376 ## 292 -0.24354024 -0.17754680 ## 293 -0.07561499 0.01237626 ## 294 0.01472389 0.12471295 ## 295 -0.17572360 -0.04373673 ## 296 -0.10845187 -0.01293808 ## 297 -0.35574024 -0.21246956 ## 298 -0.20121499 -0.01018741 ## 299 -0.11327611 0.12550836 ## 300 -0.30972360 -0.02318224 ## 301 -0.09605187 0.01818502 ## 302 -0.36254024 -0.19118490 ## 303 -0.23401499 -0.00554120 ## 304 -0.17127611 0.11431612 ## 305 -0.38772360 -0.04501293 ## 306 -0.12365187 -0.00999902 ## 307 -0.38934024 -0.21886096 ## 308 -0.24521499 -0.01790928 ## 309 -0.16327611 0.12085602 ## 310 -0.35972360 -0.01876504 ## 311 -0.10845187 0.03775481 ## 312 -0.40294024 -0.18363023 ## 313 -0.30021499 -0.00780163 ## 314 -0.25927611 0.10624058 ## 315 -0.49772360 -0.05910357 ## 316 0.28534813 0.11927594 ## 317 0.21765976 -0.03144853 ## 318 0.43578501 0.10364063 ## 319 0.54872389 0.13354342 ## 320 0.35627640 -0.14194017 ## 321 0.06624922 0.06199045 ## 322 -0.10693691 -0.11332506 ## 323 0.05805841 0.04954087 ## 324 0.13323515 0.12258823 ## 325 -0.08480667 -0.09758297 ## 326 0.05804922 0.01339019 ## 327 -0.08013691 -0.14712545 ## 328 0.12885841 0.03954035 ## 329 0.25123515 0.13958758 ## 330 0.07719333 -0.05678376 ## 331 0.00464922 0.04101925 ## 332 -0.19973691 -0.14518186 ## 333 -0.04454159 0.02819847 ## 334 0.02923515 0.12016023 ## 335 -0.18280667 -0.07369658 ## 336 0.08844922 -0.00273825 ## 337 -0.00893691 -0.14571810 ## 338 0.23045841 0.04808347 ## 339 0.37723515 0.14926649 ## 340 0.22519333 -0.04836907 ## 341 0.01724922 0.03290702 ## 342 -0.16773691 -0.14425019 ## 343 0.00085841 0.03217402 ## 344 0.08523515 0.12437967 ## 345 -0.11680667 -0.06983325 ## 346 -0.08475078 -0.02658510 ## 347 -0.30333691 -0.21608837 ## 348 -0.12414159 -0.00781022 ## 349 -0.01276485 0.13264937 ## 350 -0.18480667 -0.01030961 ## 351 -0.10435078 0.04277927 ## 352 -0.39433691 -0.17364182 ## 353 -0.29614159 -0.00188148 ## 354 -0.26476485 0.10306030 ## 355 -0.50880667 -0.06741649 ## 356 0.27864922 0.08222047 ## 357 0.24726309 -0.04738003 ## 358 0.49805841 0.10520091 ## 359 0.63523515 0.14416328 ## 360 0.46919333 -0.12009292 ## 361 -0.10740399 -0.01245128 ## 362 -0.35440119 -0.21197213 ## 363 -0.19980660 -0.00990119 ## 364 -0.11282023 0.12456154 ## 365 -0.30764208 -0.02278395 ## 366 0.23139601 0.06138547 ## 367 0.17939881 -0.07561699 ## 368 0.42879340 0.08877232 ## 369 0.57117977 0.14615343 ## 370 0.41035792 -0.09967369 ## 371 0.16259601 0.05009638 ## 372 0.06639881 -0.10235063 ## 373 0.29299340 0.06799414 ## 374 0.42117977 0.13993070 ## 375 0.25235792 -0.08514096 ## 376 -0.02280399 -0.02004480 ## 377 -0.19880119 -0.19466240 ## 378 0.00539340 0.01091179 ## 379 0.13117977 0.13807775 ## 380 -0.02764208 -0.01936449 ## 381 0.01539601 0.01189160 ## 382 -0.16040119 -0.16565781 ## 383 0.03099340 0.02398457 ## 384 0.14117977 0.13241874 ## 385 -0.03564208 -0.04615531 ## 386 -0.10540399 0.01467509 ## 387 -0.37340119 -0.19328257 ## 388 -0.24640660 -0.00624844 ## 389 -0.18482023 0.11537747 ## 390 -0.40564208 -0.04540484 ## 391 0.16419601 0.11344792 ## 392 0.01539881 -0.06072332 ## 393 0.17739340 0.07589723 ## 394 0.24317977 0.11630955 ## 395 0.01635792 -0.13588634 ## 396 -0.00840399 0.03700698 ## 397 -0.21640119 -0.14828474 ## 398 -0.06500660 0.02581533 ## 399 0.00517977 0.11870719 ## 400 -0.20764208 -0.07140917 newWafer &lt;- data.frame(Wafer = rep(1, 4), voltage = c(1, 1.5, 3, 3.5)) predict(fm1Wafer, newWafer, level = 0:1) ## Wafer predict.fixed predict.Wafer ## 1 1 2.6126 2.4014 ## 2 1 7.0273 6.7208 ## 3 1 23.7826 23.2315 ## 4 1 30.5381 29.9192 newWafer2 &lt;- data.frame(Wafer = rep(1, 4), Site = rep(3, 4), voltage = c(1, 1.5, 3, 3.5)) predict(fm1Wafer, newWafer2, level = 0:2) ## Wafer Site predict.fixed predict.Wafer predict.Site ## 1 1 1/3 2.6126 2.4014 2.4319 ## 2 1 1/3 7.0273 6.7208 6.7666 ## 3 1 1/3 23.7826 23.2315 23.3231 ## 4 1 1/3 30.5381 29.9192 30.0261 # 4.3 Examining a Fitted Model plot(fm2Orth.lme, Subject~resid(.), abline = 0) plot(fm2Orth.lme, resid(., type = &quot;p&quot;) ~ fitted(.) | Sex, id = 0.05, adj = -0.3) fm3Orth.lme &lt;- update(fm2Orth.lme, weights = varIdent(form = ~ 1 | Sex)) fm3Orth.lme ## Linear mixed-effects model fit by REML ## Data: Orthodont ## Log-restricted-likelihood: -205.76 ## Fixed: distance ~ Sex + I(age - 11) + Sex:I(age - 11) ## (Intercept) SexFemale ## 24.96875 -2.32102 ## I(age - 11) SexFemale:I(age - 11) ## 0.78437 -0.30483 ## ## Random effects: ## Formula: ~I(age - 11) | Subject ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 1.85498 (Intr) ## I(age - 11) 0.15652 0.394 ## Residual 1.62959 ## ## Variance function: ## Structure: Different standard deviations per stratum ## Formula: ~1 | Sex ## Parameter estimates: ## Male Female ## 1.00000 0.40885 ## Number of Observations: 108 ## Number of Groups: 27 plot(fm3Orth.lme, distance ~ fitted(.), id = 0.05, adj = -0.3) anova(fm2Orth.lme, fm3Orth.lme) ## Model df AIC BIC logLik Test L.Ratio ## fm2Orth.lme 1 8 451.35 472.51 -217.68 ## fm3Orth.lme 2 9 429.52 453.32 -205.76 1 vs 2 23.832 ## p-value ## fm2Orth.lme ## fm3Orth.lme &lt;.0001 qqnorm(fm3Orth.lme, ~resid(.) | Sex) plot(fm2IGF.lme, resid(., type = &quot;p&quot;) ~ fitted(.) | Lot, layout = c(5,2)) qqnorm(fm2IGF.lme, ~ resid(.), id = 0.05, adj = -0.75) plot(fm1Oxide) qqnorm(fm1Oxide) plot(fm1Wafer, resid(.) ~ voltage | Wafer) plot(fm1Wafer, resid(.) ~ voltage | Wafer, panel = function(x, y, ...) { panel.grid() panel.xyplot(x, y) panel.loess(x, y, lty = 2) panel.abline(0, 0) }) with(Wafer, coef(lm(resid(fm1Wafer) ~ cos(4.19*voltage)+sin(4.19*voltage)-1))) ## cos(4.19 * voltage) sin(4.19 * voltage) ## -0.051872 0.130405 nls(resid(fm1Wafer) ~ b3*cos(w*voltage) + b4*sin(w*voltage), Wafer, start = list(b3 = -0.0519, b4 = 0.1304, w = 4.19)) ## Nonlinear regression model ## model: resid(fm1Wafer) ~ b3 * cos(w * voltage) + b4 * sin(w * voltage) ## data: Wafer ## b3 b4 w ## -0.1117 0.0777 4.5679 ## residual sum-of-squares: 0.729 ## ## Number of iterations to convergence: 6 ## Achieved convergence tolerance: 1.12e-06 fm2Wafer &lt;- update(fm1Wafer, . ~ . + cos(4.5679*voltage) + sin(4.5679*voltage), random = list(Wafer=pdDiag(~voltage+I(voltage^2)), Site=pdDiag(~voltage+I(voltage^2)))) summary(fm2Wafer) ## Linear mixed-effects model fit by REML ## Data: Wafer ## AIC BIC logLik ## -1232.6 -1184.9 628.31 ## ## Random effects: ## Formula: ~voltage + I(voltage^2) | Wafer ## Structure: Diagonal ## (Intercept) voltage I(voltage^2) ## StdDev: 0.12888 0.34865 0.049074 ## ## Formula: ~voltage + I(voltage^2) | Site %in% Wafer ## Structure: Diagonal ## (Intercept) voltage I(voltage^2) Residual ## StdDev: 0.039675 0.23437 0.047541 0.011325 ## ## Fixed effects: current ~ voltage + I(voltage^2) + cos(4.5679 * voltage) + sin(4.5679 * voltage) ## Value Std.Error DF t-value p-value ## (Intercept) -4.2554 0.042235 316 -100.756 0 ## voltage 5.6224 0.114161 316 49.249 0 ## I(voltage^2) 1.2585 0.016958 316 74.212 0 ## cos(4.5679 * voltage) -0.0956 0.001124 316 -85.049 0 ## sin(4.5679 * voltage) 0.1043 0.001503 316 69.416 0 ## Correlation: ## (Intr) voltag I(v^2) c(4.*v ## voltage -0.029 ## I(voltage^2) 0.060 -0.031 ## cos(4.5679 * voltage) 0.162 -0.082 0.172 ## sin(4.5679 * voltage) 0.200 -0.101 0.212 0.567 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.427248 -0.403233 0.025346 0.393642 2.842694 ## ## Number of Observations: 400 ## Number of Groups: ## Wafer Site %in% Wafer ## 10 80 intervals(fm2Wafer) ## Approximate 95% confidence intervals ## ## Fixed effects: ## lower est. upper ## (Intercept) -4.338485 -4.255388 -4.172292 ## voltage 5.397744 5.622357 5.846969 ## I(voltage^2) 1.225147 1.258512 1.291878 ## cos(4.5679 * voltage) -0.097768 -0.095557 -0.093347 ## sin(4.5679 * voltage) 0.101388 0.104345 0.107303 ## attr(,&quot;label&quot;) ## [1] &quot;Fixed effects:&quot; ## ## Random Effects: ## Level: Wafer ## lower est. upper ## sd((Intercept)) 0.080182 0.128884 0.207166 ## sd(voltage) 0.213593 0.348651 0.569105 ## sd(I(voltage^2)) 0.029023 0.049074 0.082979 ## Level: Site ## lower est. upper ## sd((Intercept)) 0.021955 0.039675 0.071696 ## sd(voltage) 0.190881 0.234373 0.287774 ## sd(I(voltage^2)) 0.038290 0.047541 0.059028 ## ## Within-group standard error: ## lower est. upper ## 0.0092746 0.0113252 0.0138292 qqnorm(fm2Wafer) qqnorm(fm2Orth.lme, ~ranef(.), id = 0.10, cex = 0.7) pairs(fm2Orth.lme, ~ranef(.) | Sex, id = ~ Subject == &quot;M13&quot;, adj = -0.3) fm2IGF.lme ## Linear mixed-effects model fit by REML ## Data: IGF ## Log-restricted-likelihood: -297.4 ## Fixed: conc ~ age ## (Intercept) age ## 5.3690370 -0.0019301 ## ## Random effects: ## Formula: ~age | Lot ## Structure: Diagonal ## (Intercept) age Residual ## StdDev: 3.6221e-05 0.0053722 0.8218 ## ## Number of Observations: 237 ## Number of Groups: 10 c(0.00031074, 0.0053722)/abs(fixef(fm2IGF.lme)) ## (Intercept) age ## 5.7876e-05 2.7833e+00 fm3IGF.lme &lt;- update(fm2IGF.lme, random = ~ age - 1) anova(fm2IGF.lme, fm3IGF.lme) ## Model df AIC BIC logLik Test L.Ratio ## fm2IGF.lme 1 5 604.8 622.10 -297.4 ## fm3IGF.lme 2 4 602.8 616.64 -297.4 1 vs 2 1.4739e-07 ## p-value ## fm2IGF.lme ## fm3IGF.lme 0.9997 qqnorm(fm1Oxide, ~ranef(., level = 1), id=0.10) qqnorm(fm1Oxide, ~ranef(., level = 2), id=0.10) #fm3Wafer &lt;- update(fm2Wafer, # random = list(Wafer = ~voltage+I(voltage^2), # Site = pdDiag(~voltage+I(voltage^2))), # control = list(msVerbose = TRUE, msMaxIter = 200) # ) #fm3Wafer #anova(fm2Wafer, fm3Wafer) #fm4Wafer &lt;- update(fm2Wafer, # random = list(Wafer = ~ voltage + I(voltage^2), # Site = pdBlocked(list(~1, # ~voltage+I(voltage^2) - 1))), # control = list(msVerbose = TRUE, # msMaxIter = 200)) #fm4Wafer #anova(fm3Wafer, fm4Wafer) #qqnorm(fm4Wafer, ~ranef(., level = 2), id = 0.05, # cex = 0.7, layout = c(3, 1)) # The next line is not in the book but is needed to get fm1Machine fm1Machine &lt;- lme(score ~ Machine, data = Machines, random = ~ 1 | Worker) (fm3Machine &lt;- update(fm1Machine, random = ~Machine-1|Worker)) ## Linear mixed-effects model fit by REML ## Data: Machines ## Log-restricted-likelihood: -104.16 ## Fixed: score ~ Machine ## (Intercept) MachineB MachineC ## 52.3556 7.9667 13.9167 ## ## Random effects: ## Formula: ~Machine - 1 | Worker ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## MachineA 4.07928 MachnA MachnB ## MachineB 8.62529 0.803 ## MachineC 4.38948 0.623 0.771 ## Residual 0.96158 ## ## Number of Observations: 54 ## Number of Groups: 6 # cleanup proc.time() ## user system elapsed ## 40.90 1.73 46.00 "],
["chapter-5.html", "5 Chapter 5", " 5 Chapter 5 #-*- R -*- # initialization library(nlme) options(width = 65, digits = 5) options(contrasts = c(unordered = &quot;contr.helmert&quot;, ordered = &quot;contr.poly&quot;)) #pdf(file = &quot;ch05.pdf&quot;) # Chapter 5 Extending the Basic Linear Mixed-Effects Models # 5.1 General Formulation of the Extended Model vf1Fixed &lt;- varFixed(~ age) vf1Fixed &lt;- Initialize(vf1Fixed, data = Orthodont) varWeights(vf1Fixed) ## [1] 0.35355 0.31623 0.28868 0.26726 0.35355 0.31623 0.28868 ## [8] 0.26726 0.35355 0.31623 0.28868 0.26726 0.35355 0.31623 ## [15] 0.28868 0.26726 0.35355 0.31623 0.28868 0.26726 0.35355 ## [22] 0.31623 0.28868 0.26726 0.35355 0.31623 0.28868 0.26726 ## [29] 0.35355 0.31623 0.28868 0.26726 0.35355 0.31623 0.28868 ## [36] 0.26726 0.35355 0.31623 0.28868 0.26726 0.35355 0.31623 ## [43] 0.28868 0.26726 0.35355 0.31623 0.28868 0.26726 0.35355 ## [50] 0.31623 0.28868 0.26726 0.35355 0.31623 0.28868 0.26726 ## [57] 0.35355 0.31623 0.28868 0.26726 0.35355 0.31623 0.28868 ## [64] 0.26726 0.35355 0.31623 0.28868 0.26726 0.35355 0.31623 ## [71] 0.28868 0.26726 0.35355 0.31623 0.28868 0.26726 0.35355 ## [78] 0.31623 0.28868 0.26726 0.35355 0.31623 0.28868 0.26726 ## [85] 0.35355 0.31623 0.28868 0.26726 0.35355 0.31623 0.28868 ## [92] 0.26726 0.35355 0.31623 0.28868 0.26726 0.35355 0.31623 ## [99] 0.28868 0.26726 0.35355 0.31623 0.28868 0.26726 0.35355 ## [106] 0.31623 0.28868 0.26726 vf1Ident &lt;- varIdent(c(Female = 0.5), ~ 1 | Sex) vf1Ident &lt;- Initialize(vf1Ident, Orthodont) varWeights(vf1Ident) ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Female Female Female Female Female Female Female Female ## 1 2 2 2 2 2 2 2 2 ## Female Female Female Female Female Female Female Female Female ## 2 2 2 2 2 2 2 2 2 ## Female Female Female Female Female Female Female Female Female ## 2 2 2 2 2 2 2 2 2 ## Female Female Female Female Female Female Female Female Female ## 2 2 2 2 2 2 2 2 2 ## Female Female Female Female Female Female Female Female Female ## 2 2 2 2 2 2 2 2 2 vf2Ident &lt;- varIdent(form = ~ 1 | Sex, fixed = c(Female = 0.5)) vf2Ident &lt;- Initialize(vf2Ident, Orthodont) varWeights(vf2Ident) ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Male Male Male Male Male Male Male Male ## 1 1 1 1 1 1 1 1 1 ## Male Female Female Female Female Female Female Female Female ## 1 2 2 2 2 2 2 2 2 ## Female Female Female Female Female Female Female Female Female ## 2 2 2 2 2 2 2 2 2 ## Female Female Female Female Female Female Female Female Female ## 2 2 2 2 2 2 2 2 2 ## Female Female Female Female Female Female Female Female Female ## 2 2 2 2 2 2 2 2 2 ## Female Female Female Female Female Female Female Female Female ## 2 2 2 2 2 2 2 2 2 vf3Ident &lt;- varIdent(form = ~ 1 | Sex * age) vf3Ident &lt;- Initialize(vf3Ident, Orthodont) varWeights(vf3Ident) ## Male*8 Male*10 Male*12 Male*14 Male*8 Male*10 ## 1 1 1 1 1 1 ## Male*12 Male*14 Male*8 Male*10 Male*12 Male*14 ## 1 1 1 1 1 1 ## Male*8 Male*10 Male*12 Male*14 Male*8 Male*10 ## 1 1 1 1 1 1 ## Male*12 Male*14 Male*8 Male*10 Male*12 Male*14 ## 1 1 1 1 1 1 ## Male*8 Male*10 Male*12 Male*14 Male*8 Male*10 ## 1 1 1 1 1 1 ## Male*12 Male*14 Male*8 Male*10 Male*12 Male*14 ## 1 1 1 1 1 1 ## Male*8 Male*10 Male*12 Male*14 Male*8 Male*10 ## 1 1 1 1 1 1 ## Male*12 Male*14 Male*8 Male*10 Male*12 Male*14 ## 1 1 1 1 1 1 ## Male*8 Male*10 Male*12 Male*14 Male*8 Male*10 ## 1 1 1 1 1 1 ## Male*12 Male*14 Male*8 Male*10 Male*12 Male*14 ## 1 1 1 1 1 1 ## Male*8 Male*10 Male*12 Male*14 Female*8 Female*10 ## 1 1 1 1 1 1 ## Female*12 Female*14 Female*8 Female*10 Female*12 Female*14 ## 1 1 1 1 1 1 ## Female*8 Female*10 Female*12 Female*14 Female*8 Female*10 ## 1 1 1 1 1 1 ## Female*12 Female*14 Female*8 Female*10 Female*12 Female*14 ## 1 1 1 1 1 1 ## Female*8 Female*10 Female*12 Female*14 Female*8 Female*10 ## 1 1 1 1 1 1 ## Female*12 Female*14 Female*8 Female*10 Female*12 Female*14 ## 1 1 1 1 1 1 ## Female*8 Female*10 Female*12 Female*14 Female*8 Female*10 ## 1 1 1 1 1 1 ## Female*12 Female*14 Female*8 Female*10 Female*12 Female*14 ## 1 1 1 1 1 1 vf1Power &lt;- varPower(1) formula(vf1Power) ## ~fitted(.) ## &lt;environment: 0x0000000013c5a2f0&gt; vf2Power &lt;- varPower(fixed = 0.5) vf3Power &lt;- varPower(form = ~ fitted(.) | Sex, fixed = list(Male = 0.5, Female = 0)) vf1Exp &lt;- varExp(form = ~ age | Sex, fixed = c(Female = 0)) vf1ConstPower &lt;- varConstPower(power = 0.5, fixed = list(const = 1)) vf1Comb &lt;- varComb(varIdent(c(Female = 0.5), ~ 1 | Sex), varExp(1, ~ age)) vf1Comb &lt;- Initialize(vf1Comb, Orthodont) varWeights(vf1Comb) ## [1] 3.3546e-04 4.5400e-05 6.1442e-06 8.3153e-07 3.3546e-04 ## [6] 4.5400e-05 6.1442e-06 8.3153e-07 3.3546e-04 4.5400e-05 ## [11] 6.1442e-06 8.3153e-07 3.3546e-04 4.5400e-05 6.1442e-06 ## [16] 8.3153e-07 3.3546e-04 4.5400e-05 6.1442e-06 8.3153e-07 ## [21] 3.3546e-04 4.5400e-05 6.1442e-06 8.3153e-07 3.3546e-04 ## [26] 4.5400e-05 6.1442e-06 8.3153e-07 3.3546e-04 4.5400e-05 ## [31] 6.1442e-06 8.3153e-07 3.3546e-04 4.5400e-05 6.1442e-06 ## [36] 8.3153e-07 3.3546e-04 4.5400e-05 6.1442e-06 8.3153e-07 ## [41] 3.3546e-04 4.5400e-05 6.1442e-06 8.3153e-07 3.3546e-04 ## [46] 4.5400e-05 6.1442e-06 8.3153e-07 3.3546e-04 4.5400e-05 ## [51] 6.1442e-06 8.3153e-07 3.3546e-04 4.5400e-05 6.1442e-06 ## [56] 8.3153e-07 3.3546e-04 4.5400e-05 6.1442e-06 8.3153e-07 ## [61] 3.3546e-04 4.5400e-05 6.1442e-06 8.3153e-07 6.7093e-04 ## [66] 9.0800e-05 1.2288e-05 1.6631e-06 6.7093e-04 9.0800e-05 ## [71] 1.2288e-05 1.6631e-06 6.7093e-04 9.0800e-05 1.2288e-05 ## [76] 1.6631e-06 6.7093e-04 9.0800e-05 1.2288e-05 1.6631e-06 ## [81] 6.7093e-04 9.0800e-05 1.2288e-05 1.6631e-06 6.7093e-04 ## [86] 9.0800e-05 1.2288e-05 1.6631e-06 6.7093e-04 9.0800e-05 ## [91] 1.2288e-05 1.6631e-06 6.7093e-04 9.0800e-05 1.2288e-05 ## [96] 1.6631e-06 6.7093e-04 9.0800e-05 1.2288e-05 1.6631e-06 ## [101] 6.7093e-04 9.0800e-05 1.2288e-05 1.6631e-06 6.7093e-04 ## [106] 9.0800e-05 1.2288e-05 1.6631e-06 fm1Dial.lme &lt;- lme(rate ~(pressure + I(pressure^2) + I(pressure^3) + I(pressure^4))*QB, Dialyzer, ~ pressure + I(pressure^2)) fm1Dial.lme ## Linear mixed-effects model fit by REML ## Data: Dialyzer ## Log-restricted-likelihood: -326.39 ## Fixed: rate ~ (pressure + I(pressure^2) + I(pressure^3) + I(pressure^4)) * QB ## (Intercept) pressure I(pressure^2) ## -16.597990 88.673253 -42.731978 ## I(pressure^3) I(pressure^4) QB1 ## 9.216490 -0.775615 -0.631728 ## pressure:QB1 I(pressure^2):QB1 I(pressure^3):QB1 ## 0.310398 1.574171 0.050908 ## I(pressure^4):QB1 ## -0.085964 ## ## Random effects: ## Formula: ~pressure + I(pressure^2) | Subject ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 1.4987 (Intr) pressr ## pressure 4.9072 -0.507 ## I(pressure^2) 1.4739 0.311 -0.944 ## Residual 1.8214 ## ## Number of Observations: 140 ## Number of Groups: 20 plot(fm1Dial.lme, resid(.) ~ pressure, abline = 0) fm2Dial.lme &lt;- update(fm1Dial.lme, weights = varPower(form = ~ pressure)) fm2Dial.lme ## Linear mixed-effects model fit by REML ## Data: Dialyzer ## Log-restricted-likelihood: -309.51 ## Fixed: rate ~ (pressure + I(pressure^2) + I(pressure^3) + I(pressure^4)) * QB ## (Intercept) pressure I(pressure^2) ## -17.67989 93.71144 -49.18679 ## I(pressure^3) I(pressure^4) QB1 ## 12.24531 -1.24264 -0.92080 ## pressure:QB1 I(pressure^2):QB1 I(pressure^3):QB1 ## 1.35310 0.48033 0.49135 ## I(pressure^4):QB1 ## -0.14627 ## ## Random effects: ## Formula: ~pressure + I(pressure^2) | Subject ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 1.8571 (Intr) pressr ## pressure 5.3281 -0.522 ## I(pressure^2) 1.6483 0.362 -0.954 ## Residual 1.2626 ## ## Variance function: ## Structure: Power of variance covariate ## Formula: ~pressure ## Parameter estimates: ## power ## 0.74933 ## Number of Observations: 140 ## Number of Groups: 20 anova(fm1Dial.lme, fm2Dial.lme) ## Model df AIC BIC logLik Test L.Ratio ## fm1Dial.lme 1 17 686.78 735.53 -326.39 ## fm2Dial.lme 2 18 655.01 706.63 -309.51 1 vs 2 33.77 ## p-value ## fm1Dial.lme ## fm2Dial.lme &lt;.0001 plot(fm2Dial.lme, resid(., type = &quot;p&quot;) ~ pressure, abline = 0) intervals(fm2Dial.lme) ## Approximate 95% confidence intervals ## ## Fixed effects: ## lower est. upper ## (Intercept) -19.14806 -17.67989 -16.21172 ## pressure 87.23117 93.71144 100.19171 ## I(pressure^2) -57.61614 -49.18679 -40.75744 ## I(pressure^3) 7.96723 12.24531 16.52338 ## I(pressure^4) -1.95269 -1.24264 -0.53260 ## QB1 -2.47755 -0.92080 0.63596 ## pressure:QB1 -5.12717 1.35310 7.83337 ## I(pressure^2):QB1 -7.94902 0.48033 8.90968 ## I(pressure^3):QB1 -3.78673 0.49135 4.76942 ## I(pressure^4):QB1 -0.85631 -0.14627 0.56378 ## attr(,&quot;label&quot;) ## [1] &quot;Fixed effects:&quot; ## ## Random Effects: ## Level: Subject ## lower est. upper ## sd((Intercept)) 1.25583 1.85706 2.746115 ## sd(pressure) 3.62470 5.32810 7.832007 ## sd(I(pressure^2)) 1.09141 1.64827 2.489272 ## cor((Intercept),pressure) -0.80266 -0.52242 -0.053226 ## cor((Intercept),I(pressure^2)) -0.16526 0.36227 0.728629 ## cor(pressure,I(pressure^2)) -0.98500 -0.95390 -0.862778 ## ## Variance function: ## lower est. upper ## power 0.50801 0.74933 0.99065 ## attr(,&quot;label&quot;) ## [1] &quot;Variance function:&quot; ## ## Within-group standard error: ## lower est. upper ## 1.0607 1.2626 1.5029 plot(fm2Dial.lme, resid(.) ~ pressure|QB, abline = 0) fm3Dial.lme &lt;- update(fm2Dial.lme, weights=varPower(form = ~ pressure | QB)) fm3Dial.lme ## Linear mixed-effects model fit by REML ## Data: Dialyzer ## Log-restricted-likelihood: -309.15 ## Fixed: rate ~ (pressure + I(pressure^2) + I(pressure^3) + I(pressure^4)) * QB ## (Intercept) pressure I(pressure^2) ## -17.69504 93.75943 -49.23064 ## I(pressure^3) I(pressure^4) QB1 ## 12.26045 -1.24439 -1.01692 ## pressure:QB1 I(pressure^2):QB1 I(pressure^3):QB1 ## 1.83955 -0.19437 0.82722 ## I(pressure^4):QB1 ## -0.20035 ## ## Random effects: ## Formula: ~pressure + I(pressure^2) | Subject ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 1.8240 (Intr) pressr ## pressure 5.2423 -0.502 ## I(pressure^2) 1.6372 0.338 -0.951 ## Residual 1.2590 ## ## Variance function: ## Structure: Power of variance covariate, different strata ## Formula: ~pressure | QB ## Parameter estimates: ## 200 300 ## 0.64775 0.83780 ## Number of Observations: 140 ## Number of Groups: 20 anova(fm2Dial.lme, fm3Dial.lme) ## Model df AIC BIC logLik Test L.Ratio ## fm2Dial.lme 1 18 655.01 706.63 -309.51 ## fm3Dial.lme 2 19 656.30 710.78 -309.15 1 vs 2 0.71091 ## p-value ## fm2Dial.lme ## fm3Dial.lme 0.3991 fm4Dial.lme &lt;- update(fm2Dial.lme, weights = varConstPower(form = ~ pressure)) anova(fm2Dial.lme, fm4Dial.lme) ## Model df AIC BIC logLik Test L.Ratio ## fm2Dial.lme 1 18 655.01 706.63 -309.51 ## fm4Dial.lme 2 19 656.85 711.34 -309.43 1 vs 2 0.15915 ## p-value ## fm2Dial.lme ## fm4Dial.lme 0.6899 plot(augPred(fm2Dial.lme), grid = TRUE) anova(fm2Dial.lme) ## numDF denDF F-value p-value ## (Intercept) 1 112 552.98 &lt;.0001 ## pressure 1 112 2328.82 &lt;.0001 ## I(pressure^2) 1 112 1174.68 &lt;.0001 ## I(pressure^3) 1 112 359.92 &lt;.0001 ## I(pressure^4) 1 112 12.47 0.0006 ## QB 1 18 4.83 0.0414 ## pressure:QB 1 112 80.11 &lt;.0001 ## I(pressure^2):QB 1 112 1.35 0.2476 ## I(pressure^3):QB 1 112 2.24 0.1370 ## I(pressure^4):QB 1 112 0.17 0.6839 anova(fm2Dial.lme, Terms = 8:10) ## F-test for: I(pressure^2):QB, I(pressure^3):QB, I(pressure^4):QB ## numDF denDF F-value p-value ## 1 3 112 1.2535 0.2939 options(contrasts = c(&quot;contr.treatment&quot;, &quot;contr.poly&quot;)) fm1BW.lme &lt;- lme(weight ~ Time * Diet, BodyWeight, random = ~ Time) fm1BW.lme ## Linear mixed-effects model fit by REML ## Data: BodyWeight ## Log-restricted-likelihood: -575.86 ## Fixed: weight ~ Time * Diet ## (Intercept) Time Diet2 Diet3 Time:Diet2 ## 251.65165 0.35964 200.66549 252.07168 0.60584 ## Time:Diet3 ## 0.29834 ## ## Random effects: ## Formula: ~Time | Rat ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 36.93907 (Intr) ## Time 0.24841 -0.149 ## Residual 4.44361 ## ## Number of Observations: 176 ## Number of Groups: 16 fm2BW.lme &lt;- update(fm1BW.lme, weights = varPower()) fm2BW.lme ## Linear mixed-effects model fit by REML ## Data: BodyWeight ## Log-restricted-likelihood: -570.96 ## Fixed: weight ~ Time * Diet ## (Intercept) Time Diet2 Diet3 Time:Diet2 ## 251.60215 0.36109 200.77697 252.17017 0.60183 ## Time:Diet3 ## 0.29524 ## ## Random effects: ## Formula: ~Time | Rat ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 36.89802 (Intr) ## Time 0.24365 -0.145 ## Residual 0.17517 ## ## Variance function: ## Structure: Power of variance covariate ## Formula: ~fitted(.) ## Parameter estimates: ## power ## 0.54284 ## Number of Observations: 176 ## Number of Groups: 16 anova(fm1BW.lme, fm2BW.lme) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm1BW.lme 1 10 1171.7 1203.1 -575.86 ## fm2BW.lme 2 11 1163.9 1198.4 -570.96 1 vs 2 9.7983 0.0017 summary(fm2BW.lme) ## Linear mixed-effects model fit by REML ## Data: BodyWeight ## AIC BIC logLik ## 1163.9 1198.4 -570.96 ## ## Random effects: ## Formula: ~Time | Rat ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## (Intercept) 36.89802 (Intr) ## Time 0.24365 -0.145 ## Residual 0.17517 ## ## Variance function: ## Structure: Power of variance covariate ## Formula: ~fitted(.) ## Parameter estimates: ## power ## 0.54284 ## Fixed effects: weight ~ Time * Diet ## Value Std.Error DF t-value p-value ## (Intercept) 251.602 13.0673 157 19.2543 0.0000 ## Time 0.361 0.0884 157 4.0857 0.0001 ## Diet2 200.777 22.6562 13 8.8619 0.0000 ## Diet3 252.170 22.6616 13 11.1276 0.0000 ## Time:Diet2 0.602 0.1554 157 3.8722 0.0002 ## Time:Diet3 0.295 0.1559 157 1.8938 0.0601 ## Correlation: ## (Intr) Time Diet2 Diet3 Tm:Dt2 ## Time -0.152 ## Diet2 -0.577 0.088 ## Diet3 -0.577 0.088 0.333 ## Time:Diet2 0.087 -0.569 -0.157 -0.050 ## Time:Diet3 0.086 -0.567 -0.050 -0.158 0.322 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.937368 -0.443866 0.079864 0.580848 2.264898 ## ## Number of Observations: 176 ## Number of Groups: 16 anova(fm2BW.lme, L = c(&quot;Time:Diet2&quot; = 1, &quot;Time:Diet3&quot; = -1)) ## F-test for linear combination(s) ## Time:Diet2 Time:Diet3 ## 1 -1 ## numDF denDF F-value p-value ## 1 1 157 2.8626 0.0926 cs1CompSymm &lt;- corCompSymm(value = 0.3, form = ~ 1 | Subject) cs2CompSymm &lt;- corCompSymm(value = 0.3, form = ~ age | Subject) cs1CompSymm &lt;- Initialize(cs1CompSymm, data = Orthodont) corMatrix(cs1CompSymm) ## $M01 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M02 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M03 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M04 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M05 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M06 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M07 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M08 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M09 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M10 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M11 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M12 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M13 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M14 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M15 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $M16 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F01 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F02 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F03 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F04 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F05 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F06 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F07 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F08 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F09 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F10 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 ## ## $F11 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 0.3 0.3 0.3 ## [2,] 0.3 1.0 0.3 0.3 ## [3,] 0.3 0.3 1.0 0.3 ## [4,] 0.3 0.3 0.3 1.0 cs1Symm &lt;- corSymm(value = c(0.2, 0.1, -0.1, 0, 0.2, 0), form = ~ 1 | Subject) cs1Symm &lt;- Initialize(cs1Symm, data = Orthodont) corMatrix(cs1Symm) ## $M01 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M02 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M03 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M04 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M05 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M06 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M07 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M08 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M09 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M10 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M11 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M12 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M13 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M14 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M15 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $M16 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F01 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F02 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F03 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F04 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F05 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F06 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F07 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F08 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F09 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F10 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 ## ## $F11 ## [,1] [,2] [,3] [,4] ## [1,] 1.0 2.0000e-01 1.0000e-01 -1.0000e-01 ## [2,] 0.2 1.0000e+00 9.0206e-17 2.0000e-01 ## [3,] 0.1 9.0206e-17 1.0000e+00 -1.0408e-16 ## [4,] -0.1 2.0000e-01 -1.0408e-16 1.0000e+00 cs1AR1 &lt;- corAR1(0.8, form = ~ 1 | Subject) cs1AR1 &lt;- Initialize(cs1AR1, data = Orthodont) corMatrix(cs1AR1) ## $M01 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M02 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M03 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M04 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M05 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M06 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M07 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M08 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M09 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M10 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M11 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M12 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M13 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M14 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M15 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $M16 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F01 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F02 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F03 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F04 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F05 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F06 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F07 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F08 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F09 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F10 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 ## ## $F11 ## [,1] [,2] [,3] [,4] ## [1,] 1.000 0.80 0.64 0.512 ## [2,] 0.800 1.00 0.80 0.640 ## [3,] 0.640 0.80 1.00 0.800 ## [4,] 0.512 0.64 0.80 1.000 cs1ARMA &lt;- corARMA(0.4, form = ~ 1 | Subject, q = 1) cs1ARMA &lt;- Initialize(cs1ARMA, data = Orthodont) corMatrix(cs1ARMA) ## $M01 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M02 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M03 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M04 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M05 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M06 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M07 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M08 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M09 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M10 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M11 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M12 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M13 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M14 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M15 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $M16 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F01 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F02 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F03 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F04 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F05 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F06 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F07 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F08 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F09 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F10 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 ## ## $F11 ## [,1] [,2] [,3] [,4] ## [1,] 1.00000 0.34483 0.00000 0.00000 ## [2,] 0.34483 1.00000 0.34483 0.00000 ## [3,] 0.00000 0.34483 1.00000 0.34483 ## [4,] 0.00000 0.00000 0.34483 1.00000 cs2ARMA &lt;- corARMA(c(0.8, 0.4), form = ~ 1 | Subject, p=1, q=1) cs2ARMA &lt;- Initialize(cs2ARMA, data = Orthodont) corMatrix(cs2ARMA) ## $M01 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M02 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M03 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M04 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M05 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M06 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M07 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M08 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M09 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M10 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M11 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M12 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M13 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M14 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M15 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $M16 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F01 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F02 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F03 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F04 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F05 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F06 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F07 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F08 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F09 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F10 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 ## ## $F11 ## [,1] [,2] [,3] [,4] ## [1,] 1.0000 0.880 0.704 0.5632 ## [2,] 0.8800 1.000 0.880 0.7040 ## [3,] 0.7040 0.880 1.000 0.8800 ## [4,] 0.5632 0.704 0.880 1.0000 spatDat &lt;- data.frame(x = (0:4)/4, y = (0:4)/4) cs1Exp &lt;- corExp(1, form = ~ x + y) cs1Exp &lt;- Initialize(cs1Exp, spatDat) corMatrix(cs1Exp) ## [,1] [,2] [,3] [,4] [,5] ## [1,] 1.00000 0.70219 0.49307 0.34623 0.24312 ## [2,] 0.70219 1.00000 0.70219 0.49307 0.34623 ## [3,] 0.49307 0.70219 1.00000 0.70219 0.49307 ## [4,] 0.34623 0.49307 0.70219 1.00000 0.70219 ## [5,] 0.24312 0.34623 0.49307 0.70219 1.00000 cs2Exp &lt;- corExp(1, form = ~ x + y, metric = &quot;man&quot;) cs2Exp &lt;- Initialize(cs2Exp, spatDat) corMatrix(cs2Exp) ## [,1] [,2] [,3] [,4] [,5] ## [1,] 1.00000 0.60653 0.36788 0.22313 0.13534 ## [2,] 0.60653 1.00000 0.60653 0.36788 0.22313 ## [3,] 0.36788 0.60653 1.00000 0.60653 0.36788 ## [4,] 0.22313 0.36788 0.60653 1.00000 0.60653 ## [5,] 0.13534 0.22313 0.36788 0.60653 1.00000 cs3Exp &lt;- corExp(c(1, 0.2), form = ~ x + y, nugget = TRUE) cs3Exp &lt;- Initialize(cs3Exp, spatDat) corMatrix(cs3Exp) ## [,1] [,2] [,3] [,4] [,5] ## [1,] 1.00000 0.56175 0.39445 0.27698 0.19449 ## [2,] 0.56175 1.00000 0.56175 0.39445 0.27698 ## [3,] 0.39445 0.56175 1.00000 0.56175 0.39445 ## [4,] 0.27698 0.39445 0.56175 1.00000 0.56175 ## [5,] 0.19449 0.27698 0.39445 0.56175 1.00000 fm1Ovar.lme &lt;- lme(follicles ~ sin(2*pi*Time) + cos(2*pi*Time), data = Ovary, random = pdDiag(~sin(2*pi*Time))) fm1Ovar.lme ## Linear mixed-effects model fit by REML ## Data: Ovary ## Log-restricted-likelihood: -813.04 ## Fixed: follicles ~ sin(2 * pi * Time) + cos(2 * pi * Time) ## (Intercept) sin(2 * pi * Time) cos(2 * pi * Time) ## 12.18202 -3.29854 -0.86237 ## ## Random effects: ## Formula: ~sin(2 * pi * Time) | Mare ## Structure: Diagonal ## (Intercept) sin(2 * pi * Time) Residual ## StdDev: 3.0521 2.0793 3.1129 ## ## Number of Observations: 308 ## Number of Groups: 11 ACF(fm1Ovar.lme) ## lag ACF ## 1 0 1.000000 ## 2 1 0.379480 ## 3 2 0.179722 ## 4 3 0.035693 ## 5 4 0.059779 ## 6 5 0.002097 ## 7 6 0.064327 ## 8 7 0.071635 ## 9 8 0.048578 ## 10 9 0.027782 ## 11 10 -0.034276 ## 12 11 -0.077204 ## 13 12 -0.161132 ## 14 13 -0.196030 ## 15 14 -0.289337 plot(ACF(fm1Ovar.lme, maxLag = 10), alpha = 0.01) fm2Ovar.lme &lt;- update(fm1Ovar.lme, correlation = corAR1()) anova(fm1Ovar.lme, fm2Ovar.lme) ## Model df AIC BIC logLik Test L.Ratio ## fm1Ovar.lme 1 6 1638.1 1660.4 -813.04 ## fm2Ovar.lme 2 7 1563.5 1589.5 -774.72 1 vs 2 76.634 ## p-value ## fm1Ovar.lme ## fm2Ovar.lme &lt;.0001 if (interactive()) intervals(fm2Ovar.lme) fm3Ovar.lme &lt;- update(fm1Ovar.lme, correlation = corARMA(q = 2)) fm3Ovar.lme ## Linear mixed-effects model fit by REML ## Data: Ovary ## Log-restricted-likelihood: -777.62 ## Fixed: follicles ~ sin(2 * pi * Time) + cos(2 * pi * Time) ## (Intercept) sin(2 * pi * Time) cos(2 * pi * Time) ## 12.19419 -3.11453 -0.86911 ## ## Random effects: ## Formula: ~sin(2 * pi * Time) | Mare ## Structure: Diagonal ## (Intercept) sin(2 * pi * Time) Residual ## StdDev: 2.9741 1.6732 3.2442 ## ## Correlation Structure: ARMA(0,2) ## Formula: ~1 | Mare ## Parameter estimate(s): ## Theta1 Theta2 ## 0.47524 0.25701 ## Number of Observations: 308 ## Number of Groups: 11 anova(fm2Ovar.lme, fm3Ovar.lme, test = F) ## Model df AIC BIC logLik ## fm2Ovar.lme 1 7 1563.5 1589.5 -774.72 ## fm3Ovar.lme 2 8 1571.2 1601.0 -777.62 fm4Ovar.lme &lt;- update(fm1Ovar.lme, correlation = corCAR1(form = ~Time)) anova(fm2Ovar.lme, fm4Ovar.lme, test = F) ## Model df AIC BIC logLik ## fm2Ovar.lme 1 7 1563.5 1589.5 -774.72 ## fm4Ovar.lme 2 7 1565.5 1591.6 -775.77 (fm5Ovar.lme &lt;- update(fm1Ovar.lme, corr = corARMA(p = 1, q = 1))) ## Linear mixed-effects model fit by REML ## Data: Ovary ## Log-restricted-likelihood: -771.95 ## Fixed: follicles ~ sin(2 * pi * Time) + cos(2 * pi * Time) ## (Intercept) sin(2 * pi * Time) cos(2 * pi * Time) ## 12.12487 -2.91983 -0.84871 ## ## Random effects: ## Formula: ~sin(2 * pi * Time) | Mare ## Structure: Diagonal ## (Intercept) sin(2 * pi * Time) Residual ## StdDev: 2.6144 1.0049 3.7334 ## ## Correlation Structure: ARMA(1,1) ## Formula: ~1 | Mare ## Parameter estimate(s): ## Phi1 Theta1 ## 0.78689 -0.27936 ## Number of Observations: 308 ## Number of Groups: 11 anova(fm2Ovar.lme, fm5Ovar.lme) ## Model df AIC BIC logLik Test L.Ratio ## fm2Ovar.lme 1 7 1563.5 1589.5 -774.72 ## fm5Ovar.lme 2 8 1559.9 1589.7 -771.95 1 vs 2 5.5538 ## p-value ## fm2Ovar.lme ## fm5Ovar.lme 0.0184 plot(ACF(fm5Ovar.lme, maxLag = 10, resType = &quot;n&quot;), alpha = 0.01) Variogram(fm2BW.lme, form = ~ Time) ## variog dist n.pairs ## 1 0.34506 1 16 ## 2 0.99326 6 16 ## 3 0.76201 7 144 ## 4 0.68493 8 16 ## 5 0.68184 13 16 ## 6 0.95119 14 128 ## 7 0.89961 15 16 ## 8 1.69441 20 16 ## 9 1.12511 21 112 ## 10 1.08828 22 16 ## 11 0.89696 28 96 ## 12 0.93233 29 16 ## 13 0.85146 35 80 ## 14 0.75460 36 16 ## 15 1.08217 42 64 ## 16 1.56669 43 16 ## 17 0.64376 49 48 ## 18 0.67355 56 32 ## 19 0.58680 63 16 plot(Variogram(fm2BW.lme, form = ~ Time, maxDist = 42)) fm3BW.lme &lt;- update(fm2BW.lme, correlation = corExp(form = ~ Time)) intervals(fm3BW.lme) ## Approximate 95% confidence intervals ## ## Fixed effects: ## lower est. upper ## (Intercept) 225.637859 251.48677 277.33568 ## Time 0.192914 0.36259 0.53226 ## Diet2 151.729596 200.78555 249.84150 ## Diet3 203.512665 252.58990 301.66713 ## Time:Diet2 0.321775 0.62402 0.92627 ## Time:Diet3 0.002626 0.30656 0.61050 ## attr(,&quot;label&quot;) ## [1] &quot;Fixed effects:&quot; ## ## Random Effects: ## Level: Rat ## lower est. upper ## sd((Intercept)) 25.02845 36.91913 54.45891 ## sd(Time) 0.14747 0.23281 0.36756 ## cor((Intercept),Time) -0.62699 -0.14661 0.41455 ## ## Correlation structure: ## lower est. upper ## range 2.4616 4.8864 9.6996 ## attr(,&quot;label&quot;) ## [1] &quot;Correlation structure:&quot; ## ## Variance function: ## lower est. upper ## power 0.24463 0.59434 0.94405 ## attr(,&quot;label&quot;) ## [1] &quot;Variance function:&quot; ## ## Within-group standard error: ## lower est. upper ## 0.018105 0.138387 1.057789 anova(fm2BW.lme, fm3BW.lme) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm2BW.lme 1 11 1163.9 1198.4 -570.96 ## fm3BW.lme 2 12 1145.1 1182.8 -560.57 1 vs 2 20.781 &lt;.0001 fm4BW.lme &lt;- update(fm3BW.lme, correlation = corExp(form = ~ Time, nugget = TRUE)) anova(fm3BW.lme, fm4BW.lme) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm3BW.lme 1 12 1145.1 1182.8 -560.57 ## fm4BW.lme 2 13 1137.6 1178.4 -555.82 1 vs 2 9.5025 0.0021 plot(Variogram(fm3BW.lme, form = ~ Time, maxDist = 42)) plot(Variogram(fm3BW.lme, form = ~ Time, maxDist = 42, resType = &quot;n&quot;, robust = TRUE)) fm5BW.lme &lt;- update(fm3BW.lme, correlation = corRatio(form = ~ Time)) fm6BW.lme &lt;- update(fm3BW.lme, correlation = corSpher(form = ~ Time)) fm7BW.lme &lt;- update(fm3BW.lme, correlation = corLin(form = ~ Time)) fm8BW.lme &lt;- update(fm3BW.lme, correlation = corGaus(form = ~ Time)) anova(fm3BW.lme, fm5BW.lme, fm6BW.lme, fm7BW.lme, fm8BW.lme) ## Model df AIC BIC logLik ## fm3BW.lme 1 12 1145.1 1182.8 -560.57 ## fm5BW.lme 2 12 1148.8 1186.4 -562.38 ## fm6BW.lme 3 12 1150.8 1188.4 -563.39 ## fm7BW.lme 4 12 1150.8 1188.4 -563.39 ## fm8BW.lme 5 12 1150.8 1188.4 -563.39 fm1Orth.gls &lt;- gls(distance ~ Sex * I(age - 11), Orthodont, correlation = corSymm(form = ~ 1 | Subject), weights = varIdent(form = ~ 1 | age)) fm1Orth.gls ## Generalized least squares fit by REML ## Model: distance ~ Sex * I(age - 11) ## Data: Orthodont ## Log-restricted-likelihood: -212.27 ## ## Coefficients: ## (Intercept) SexFemale ## 24.93712 -2.27174 ## I(age - 11) SexFemale:I(age - 11) ## 0.82680 -0.35044 ## ## Correlation Structure: General ## Formula: ~1 | Subject ## Parameter estimate(s): ## Correlation: ## 1 2 3 ## 2 0.568 ## 3 0.659 0.581 ## 4 0.522 0.725 0.740 ## Variance function: ## Structure: Different standard deviations per stratum ## Formula: ~1 | age ## Parameter estimates: ## 8 10 12 14 ## 1.00000 0.87888 1.07446 0.95869 ## Degrees of freedom: 108 total; 104 residual ## Residual standard error: 2.3292 intervals(fm1Orth.gls) ## Approximate 95% confidence intervals ## ## Coefficients: ## lower est. upper ## (Intercept) 23.99941 24.93712 25.874835 ## SexFemale -3.74086 -2.27174 -0.802630 ## I(age - 11) 0.66376 0.82680 0.989845 ## SexFemale:I(age - 11) -0.60587 -0.35044 -0.095003 ## attr(,&quot;label&quot;) ## [1] &quot;Coefficients:&quot; ## ## Correlation structure: ## lower est. upper ## cor(1,2) 0.25295 0.56820 0.77437 ## cor(1,3) 0.38394 0.65895 0.82658 ## cor(1,4) 0.18478 0.52204 0.74930 ## cor(2,3) 0.27267 0.58061 0.78064 ## cor(2,4) 0.48205 0.72492 0.86433 ## cor(3,4) 0.51333 0.73962 0.86975 ## attr(,&quot;label&quot;) ## [1] &quot;Correlation structure:&quot; ## ## Variance function: ## lower est. upper ## 10 0.63223 0.87888 1.2217 ## 12 0.79935 1.07446 1.4443 ## 14 0.68137 0.95869 1.3489 ## attr(,&quot;label&quot;) ## [1] &quot;Variance function:&quot; ## ## Residual standard error: ## lower est. upper ## 1.7597 2.3292 3.0831 fm2Orth.gls &lt;- update(fm1Orth.gls, corr = corCompSymm(form = ~ 1 | Subject)) anova(fm1Orth.gls, fm2Orth.gls) ## Model df AIC BIC logLik Test L.Ratio ## fm1Orth.gls 1 14 452.55 489.57 -212.27 ## fm2Orth.gls 2 9 449.97 473.77 -215.99 1 vs 2 7.4256 ## p-value ## fm1Orth.gls ## fm2Orth.gls 0.1909 intervals(fm2Orth.gls) ## Approximate 95% confidence intervals ## ## Coefficients: ## lower est. upper ## (Intercept) 23.92956 24.86832 25.807077 ## SexFemale -3.66815 -2.19740 -0.726641 ## I(age - 11) 0.64160 0.79431 0.947029 ## SexFemale:I(age - 11) -0.55482 -0.31556 -0.076301 ## attr(,&quot;label&quot;) ## [1] &quot;Coefficients:&quot; ## ## Correlation structure: ## lower est. upper ## Rho 0.44608 0.63529 0.77825 ## attr(,&quot;label&quot;) ## [1] &quot;Correlation structure:&quot; ## ## Variance function: ## lower est. upper ## 10 0.63545 0.86236 1.1703 ## 12 0.76905 1.03395 1.3901 ## 14 0.67823 0.92037 1.2490 ## attr(,&quot;label&quot;) ## [1] &quot;Variance function:&quot; ## ## Residual standard error: ## lower est. upper ## 1.8023 2.3868 3.1609 fm3Orth.gls &lt;- update(fm2Orth.gls, weights = NULL) anova(fm2Orth.gls, fm3Orth.gls) ## Model df AIC BIC logLik Test L.Ratio ## fm2Orth.gls 1 9 449.97 473.77 -215.99 ## fm3Orth.gls 2 6 445.76 461.62 -216.88 1 vs 2 1.7849 ## p-value ## fm2Orth.gls ## fm3Orth.gls 0.6182 plot(fm3Orth.gls, resid(., type = &quot;n&quot;) ~ age | Sex) fm4Orth.gls &lt;- update(fm3Orth.gls, weights = varIdent(form = ~ 1 | Sex)) anova(fm3Orth.gls, fm4Orth.gls) ## Model df AIC BIC logLik Test L.Ratio ## fm3Orth.gls 1 6 445.76 461.62 -216.88 ## fm4Orth.gls 2 7 436.19 454.70 -211.09 1 vs 2 11.569 ## p-value ## fm3Orth.gls ## fm4Orth.gls 7e-04 qqnorm(fm4Orth.gls, ~resid(., type = &quot;n&quot;)) # not in book but needed for the following command fm3Orth.lme &lt;- lme(distance~Sex*I(age-11), data = Orthodont, random = ~ I(age-11) | Subject, weights = varIdent(form = ~ 1 | Sex)) anova(fm3Orth.lme, fm4Orth.gls, test = FALSE) ## Model df AIC BIC logLik ## fm3Orth.lme 1 9 429.52 453.32 -205.76 ## fm4Orth.gls 2 7 436.19 454.70 -211.09 fm1Dial.gls &lt;- gls(rate ~(pressure + I(pressure^2) + I(pressure^3) + I(pressure^4))*QB, Dialyzer) plot(fm1Dial.gls, resid(.) ~ pressure, abline = 0) fm2Dial.gls &lt;- update(fm1Dial.gls, weights = varPower(form = ~ pressure)) anova(fm1Dial.gls, fm2Dial.gls) ## Model df AIC BIC logLik Test L.Ratio ## fm1Dial.gls 1 11 761.17 792.71 -369.59 ## fm2Dial.gls 2 12 738.22 772.63 -357.11 1 vs 2 24.95 ## p-value ## fm1Dial.gls ## fm2Dial.gls &lt;.0001 ACF(fm2Dial.gls, form = ~ 1 | Subject) ## lag ACF ## 1 0 1.000000 ## 2 1 0.770851 ## 3 2 0.632301 ## 4 3 0.408306 ## 5 4 0.200737 ## 6 5 0.073116 ## 7 6 0.077802 plot(ACF(fm2Dial.gls, form = ~ 1 | Subject), alpha = 0.01) (fm3Dial.gls &lt;- update(fm2Dial.gls, corr = corAR1(0.771, form = ~ 1 | Subject))) ## Generalized least squares fit by REML ## Model: rate ~ (pressure + I(pressure^2) + I(pressure^3) + I(pressure^4)) * QB ## Data: Dialyzer ## Log-restricted-likelihood: -308.34 ## ## Coefficients: ## (Intercept) pressure I(pressure^2) ## -16.81845 92.33424 -49.26516 ## I(pressure^3) I(pressure^4) QB300 ## 11.39968 -1.01964 -1.59419 ## pressure:QB300 I(pressure^2):QB300 I(pressure^3):QB300 ## 1.70543 2.12680 0.47971 ## I(pressure^4):QB300 ## -0.22064 ## ## Correlation Structure: AR(1) ## Formula: ~1 | Subject ## Parameter estimate(s): ## Phi ## 0.7526 ## Variance function: ## Structure: Power of variance covariate ## Formula: ~pressure ## Parameter estimates: ## power ## 0.51824 ## Degrees of freedom: 140 total; 130 residual ## Residual standard error: 3.0463 intervals(fm3Dial.gls) ## Approximate 95% confidence intervals ## ## Coefficients: ## lower est. upper ## (Intercept) -18.8968 -16.81845 -14.740093 ## pressure 81.9144 92.33424 102.754095 ## I(pressure^2) -63.1040 -49.26516 -35.426272 ## I(pressure^3) 4.5648 11.39968 18.234542 ## I(pressure^4) -2.1248 -1.01964 0.085558 ## QB300 -4.7565 -1.59419 1.568148 ## pressure:QB300 -13.6410 1.70543 17.051845 ## I(pressure^2):QB300 -17.9484 2.12680 22.201987 ## I(pressure^3):QB300 -9.3503 0.47971 10.309706 ## I(pressure^4):QB300 -1.8021 -0.22064 1.360833 ## attr(,&quot;label&quot;) ## [1] &quot;Coefficients:&quot; ## ## Correlation structure: ## lower est. upper ## Phi 0.62844 0.7526 0.83937 ## attr(,&quot;label&quot;) ## [1] &quot;Correlation structure:&quot; ## ## Variance function: ## lower est. upper ## power 0.3806 0.51824 0.65587 ## attr(,&quot;label&quot;) ## [1] &quot;Variance function:&quot; ## ## Residual standard error: ## lower est. upper ## 2.5013 3.0463 3.7101 anova(fm2Dial.gls, fm3Dial.gls) ## Model df AIC BIC logLik Test L.Ratio ## fm2Dial.gls 1 12 738.22 772.63 -357.11 ## fm3Dial.gls 2 13 642.67 679.95 -308.34 1 vs 2 97.546 ## p-value ## fm2Dial.gls ## fm3Dial.gls &lt;.0001 anova(fm3Dial.gls, fm2Dial.lme, test = FALSE) ## Model df AIC BIC logLik ## fm3Dial.gls 1 13 642.67 679.95 -308.34 ## fm2Dial.lme 2 18 655.01 706.63 -309.51 fm1Wheat2 &lt;- gls(yield ~ variety - 1, Wheat2) Variogram(fm1Wheat2, form = ~ latitude + longitude) ## variog dist n.pairs ## 1 0.37026 4.3000 1143 ## 2 0.39572 5.6080 1259 ## 3 0.47019 8.3863 1263 ## 4 0.50774 9.3231 1241 ## 5 0.54502 10.5190 1242 ## 6 0.63965 12.7472 1241 ## 7 0.61183 13.3929 1283 ## 8 0.65711 14.7635 1252 ## 9 0.73844 16.1818 1221 ## 10 0.72832 17.3666 1261 ## 11 0.75117 18.4567 1288 ## 12 0.87492 20.2428 1254 ## 13 0.80516 21.6335 1256 ## 14 0.87118 22.6736 1182 ## 15 0.86812 24.6221 1257 ## 16 0.85929 26.2427 1264 ## 17 0.97088 28.5601 1235 ## 18 0.99293 30.7877 1226 ## 19 1.09617 34.5879 1263 ## 20 1.34146 39.3641 1234 plot(Variogram(fm1Wheat2, form = ~ latitude + longitude, maxDist = 32), xlim = c(0,32)) fm2Wheat2 &lt;- update(fm1Wheat2, corr = corSpher(c(28, 0.2), form = ~ latitude + longitude, nugget = TRUE)) fm2Wheat2 ## Generalized least squares fit by REML ## Model: yield ~ variety - 1 ## Data: Wheat2 ## Log-restricted-likelihood: -533.93 ## ## Coefficients: ## varietyARAPAHOE varietyBRULE varietyBUCKSKIN ## 26.659 25.850 34.848 ## varietyCENTURA varietyCENTURK78 varietyCHEYENNE ## 25.095 26.334 24.673 ## varietyCODY varietyCOLT varietyGAGE ## 22.489 25.184 24.321 ## varietyHOMESTEAD varietyKS831374 varietyLANCER ## 21.669 26.856 23.333 ## varietyLANCOTA varietyNE83404 varietyNE83406 ## 21.291 24.049 25.314 ## varietyNE83407 varietyNE83432 varietyNE83498 ## 25.192 21.818 28.705 ## varietyNE83T12 varietyNE84557 varietyNE85556 ## 22.145 21.781 27.973 ## varietyNE85623 varietyNE86482 varietyNE86501 ## 23.924 24.974 25.018 ## varietyNE86503 varietyNE86507 varietyNE86509 ## 27.224 27.453 22.408 ## varietyNE86527 varietyNE86582 varietyNE86606 ## 25.882 22.587 26.796 ## varietyNE86607 varietyNE86T666 varietyNE87403 ## 25.910 16.787 21.490 ## varietyNE87408 varietyNE87409 varietyNE87446 ## 24.319 26.320 22.219 ## varietyNE87451 varietyNE87457 varietyNE87463 ## 24.191 23.536 23.226 ## varietyNE87499 varietyNE87512 varietyNE87513 ## 22.173 22.575 21.825 ## varietyNE87522 varietyNE87612 varietyNE87613 ## 19.483 27.391 27.562 ## varietyNE87615 varietyNE87619 varietyNE87627 ## 23.819 28.485 18.480 ## varietyNORKAN varietyREDLAND varietyROUGHRIDER ## 22.145 27.983 25.748 ## varietySCOUT66 varietySIOUXLAND varietyTAM107 ## 26.878 25.656 22.770 ## varietyTAM200 varietyVONA ## 18.764 24.782 ## ## Correlation Structure: Spherical spatial correlation ## Formula: ~latitude + longitude ## Parameter estimate(s): ## range nugget ## 27.45748 0.20931 ## Degrees of freedom: 224 total; 168 residual ## Residual standard error: 7.4106 fm3Wheat2 &lt;- update(fm1Wheat2, corr = corRatio(c(12.5, 0.2), form = ~ latitude + longitude, nugget = TRUE)) fm3Wheat2 ## Generalized least squares fit by REML ## Model: yield ~ variety - 1 ## Data: Wheat2 ## Log-restricted-likelihood: -532.64 ## ## Coefficients: ## varietyARAPAHOE varietyBRULE varietyBUCKSKIN ## 26.546 26.284 35.037 ## varietyCENTURA varietyCENTURK78 varietyCHEYENNE ## 24.867 26.695 24.430 ## varietyCODY varietyCOLT varietyGAGE ## 23.366 25.176 24.459 ## varietyHOMESTEAD varietyKS831374 varietyLANCER ## 21.517 26.549 23.046 ## varietyLANCOTA varietyNE83404 varietyNE83406 ## 21.177 24.592 25.734 ## varietyNE83407 varietyNE83432 varietyNE83498 ## 25.527 21.817 29.084 ## varietyNE83T12 varietyNE84557 varietyNE85556 ## 21.576 21.321 27.917 ## varietyNE85623 varietyNE86482 varietyNE86501 ## 23.739 24.373 24.879 ## varietyNE86503 varietyNE86507 varietyNE86509 ## 27.300 27.366 22.174 ## varietyNE86527 varietyNE86582 varietyNE86606 ## 24.989 23.274 27.317 ## varietyNE86607 varietyNE86T666 varietyNE87403 ## 25.710 17.305 21.837 ## varietyNE87408 varietyNE87409 varietyNE87446 ## 24.657 26.314 22.113 ## varietyNE87451 varietyNE87457 varietyNE87463 ## 24.383 23.624 23.435 ## varietyNE87499 varietyNE87512 varietyNE87513 ## 21.900 22.743 21.644 ## varietyNE87522 varietyNE87612 varietyNE87613 ## 19.632 28.330 27.732 ## varietyNE87615 varietyNE87619 varietyNE87627 ## 24.013 28.661 19.099 ## varietyNORKAN varietyREDLAND varietyROUGHRIDER ## 22.684 27.670 25.619 ## varietySCOUT66 varietySIOUXLAND varietyTAM107 ## 26.289 25.740 22.476 ## varietyTAM200 varietyVONA ## 18.693 25.046 ## ## Correlation Structure: Rational quadratic spatial correlation ## Formula: ~latitude + longitude ## Parameter estimate(s): ## range nugget ## 13.46134 0.19358 ## Degrees of freedom: 224 total; 168 residual ## Residual standard error: 8.8468 anova(fm2Wheat2, fm3Wheat2) ## Model df AIC BIC logLik ## fm2Wheat2 1 59 1185.9 1370.2 -533.93 ## fm3Wheat2 2 59 1183.3 1367.6 -532.64 anova(fm1Wheat2, fm3Wheat2) ## Model df AIC BIC logLik Test L.Ratio p-value ## fm1Wheat2 1 57 1354.7 1532.8 -620.37 ## fm3Wheat2 2 59 1183.3 1367.6 -532.64 1 vs 2 175.46 &lt;.0001 plot(Variogram(fm3Wheat2, resType = &quot;n&quot;)) plot(fm3Wheat2, resid(., type = &quot;n&quot;) ~ fitted(.), abline = 0) qqnorm(fm3Wheat2, ~ resid(., type = &quot;n&quot;)) fm4Wheat2 &lt;- update(fm3Wheat2, model = yield ~ variety) anova(fm4Wheat2) ## Denom. DF: 168 ## numDF F-value p-value ## (Intercept) 1 30.3994 &lt;.0001 ## variety 55 1.8509 0.0015 anova(fm3Wheat2, L = c(-1, 0, 1)) ## Denom. DF: 168 ## F-test for linear combination(s) ## varietyARAPAHOE varietyBUCKSKIN ## -1 1 ## numDF F-value p-value ## 1 1 7.6967 0.0062 # cleanup proc.time() ## user system elapsed ## 53.88 2.21 59.76 "],
["chapter-6.html", "6 Chapter 6", " 6 Chapter 6 #-*- R -*- # initialization library(nlme) options(width = 65, digits = 5) options(contrasts = c(unordered = &quot;contr.helmert&quot;, ordered = &quot;contr.poly&quot;)) #pdf(file = &quot;ch06.pdf&quot;) # Chapter 6 Nonlinear Mixed-Effects Models: # Basic Concepts and Motivating Examples # 6.1 Indomethicin Kinetics plot(Indometh) fm1Indom.nls &lt;- nls(conc ~ SSbiexp(time, A1, lrc1, A2, lrc2), data = Indometh) summary(fm1Indom.nls) ## ## Formula: conc ~ SSbiexp(time, A1, lrc1, A2, lrc2) ## ## Parameters: ## Estimate Std. Error t value Pr(&gt;|t|) ## A1 2.773 0.253 10.95 4e-16 *** ## lrc1 0.886 0.222 3.99 0.00018 *** ## A2 0.607 0.267 2.27 0.02660 * ## lrc2 -1.092 0.409 -2.67 0.00966 ** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 0.174 on 62 degrees of freedom ## ## Number of iterations to convergence: 0 ## Achieved convergence tolerance: 3.3e-07 plot(fm1Indom.nls, Subject ~ resid(.), abline = 0) (fm1Indom.lis &lt;- nlsList(conc ~ SSbiexp(time, A1, lrc1, A2, lrc2), data = Indometh)) ## Call: ## Model: conc ~ SSbiexp(time, A1, lrc1, A2, lrc2) | Subject ## Data: Indometh ## ## Coefficients: ## A1 lrc1 A2 lrc2 ## 1 2.0293 0.57939 0.19155 -1.78778 ## 4 2.1981 0.24231 0.25452 -1.60269 ## 2 2.8277 0.80132 0.49892 -1.63535 ## 5 3.5661 1.04077 0.29150 -1.50685 ## 6 3.0022 1.08821 0.96852 -0.87314 ## 3 5.4683 1.74979 1.67575 -0.41220 ## ## Degrees of freedom: 66 total; 42 residual ## Residual standard error: 0.07555 plot(intervals(fm1Indom.lis)) (fm1Indom.nlme &lt;- nlme(fm1Indom.lis, random = pdDiag(A1 + lrc1 + A2 + lrc2 ~ 1), control = list(tolerance = 0.0001))) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: conc ~ SSbiexp(time, A1, lrc1, A2, lrc2) ## Data: Indometh ## Log-likelihood: 54.597 ## Fixed: list(A1 ~ 1, lrc1 ~ 1, A2 ~ 1, lrc2 ~ 1) ## A1 lrc1 A2 lrc2 ## 2.82754 0.77362 0.46147 -1.34410 ## ## Random effects: ## Formula: list(A1 ~ 1, lrc1 ~ 1, A2 ~ 1, lrc2 ~ 1) ## Level: Subject ## Structure: Diagonal ## A1 lrc1 A2 lrc2 Residual ## StdDev: 0.57141 0.15808 0.1116 8.5391e-06 0.081493 ## ## Number of Observations: 66 ## Number of Groups: 6 fm2Indom.nlme &lt;- update(fm1Indom.nlme, random = pdDiag(A1 + lrc1 + A2 ~ 1)) anova(fm1Indom.nlme, fm2Indom.nlme) ## Model df AIC BIC logLik Test L.Ratio ## fm1Indom.nlme 1 9 -91.193 -71.487 54.597 ## fm2Indom.nlme 2 8 -93.185 -75.667 54.592 1 vs 2 0.0087052 ## p-value ## fm1Indom.nlme ## fm2Indom.nlme 0.9257 (fm3Indom.nlme &lt;- update(fm2Indom.nlme, random = A1+lrc1+A2 ~ 1)) ## Warning in (function (model, data = sys.frame(sys.parent()), ## fixed, random, : Iteration 1, LME step: nlminb() did not converge ## (code = 1). Do increase &#39;msMaxIter&#39;! ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: conc ~ SSbiexp(time, A1, lrc1, A2, lrc2) ## Data: Indometh ## Log-likelihood: 58.473 ## Fixed: list(A1 ~ 1, lrc1 ~ 1, A2 ~ 1, lrc2 ~ 1) ## A1 lrc1 A2 lrc2 ## 2.81484 0.82928 0.56134 -1.14069 ## ## Random effects: ## Formula: list(A1 ~ 1, lrc1 ~ 1, A2 ~ 1) ## Level: Subject ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## A1 0.690446 A1 lrc1 ## lrc1 0.179038 0.932 ## A2 0.153714 0.471 0.118 ## Residual 0.078071 ## ## Number of Observations: 66 ## Number of Groups: 6 fm4Indom.nlme &lt;- update(fm3Indom.nlme, random = pdBlocked(list(A1 + lrc1 ~ 1, A2 ~ 1))) anova(fm3Indom.nlme, fm4Indom.nlme) ## Model df AIC BIC logLik Test L.Ratio ## fm3Indom.nlme 1 11 -94.946 -70.86 58.473 ## fm4Indom.nlme 2 9 -98.157 -78.45 58.078 1 vs 2 0.78937 ## p-value ## fm3Indom.nlme ## fm4Indom.nlme 0.6739 anova(fm2Indom.nlme, fm4Indom.nlme) ## Model df AIC BIC logLik Test L.Ratio ## fm2Indom.nlme 1 8 -93.185 -75.667 54.592 ## fm4Indom.nlme 2 9 -98.157 -78.450 58.078 1 vs 2 6.9721 ## p-value ## fm2Indom.nlme ## fm4Indom.nlme 0.0083 plot(fm4Indom.nlme, id = 0.05, adj = -1) qqnorm(fm4Indom.nlme) plot(augPred(fm4Indom.nlme, level = 0:1)) summary(fm4Indom.nlme) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: conc ~ SSbiexp(time, A1, lrc1, A2, lrc2) ## Data: Indometh ## AIC BIC logLik ## -98.157 -78.45 58.078 ## ## Random effects: ## Composite Structure: Blocked ## ## Block 1: A1, lrc1 ## Formula: list(A1 ~ 1, lrc1 ~ 1) ## Level: Subject ## Structure: General positive-definite ## StdDev Corr ## A1 0.71962 A1 ## lrc1 0.14867 1 ## ## Block 2: A2 ## Formula: A2 ~ 1 | Subject ## A2 Residual ## StdDev: 0.21294 0.0782 ## ## Fixed effects: list(A1 ~ 1, lrc1 ~ 1, A2 ~ 1, lrc2 ~ 1) ## Value Std.Error DF t-value p-value ## A1 2.78306 0.32708 57 8.5087 0 ## lrc1 0.89791 0.11068 57 8.1123 0 ## A2 0.65779 0.14280 57 4.6063 0 ## lrc2 -1.00037 0.14997 57 -6.6704 0 ## Correlation: ## A1 lrc1 A2 ## lrc1 0.602 ## A2 -0.058 0.556 ## lrc2 -0.109 0.570 0.702 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -3.45876 -0.43726 0.10965 0.50423 3.05716 ## ## Number of Observations: 66 ## Number of Groups: 6 # 6.3 Growth of Soybean Plants head(Soybean) ## Grouped Data: weight ~ Time | Plot ## Plot Variety Year Time weight ## 1 1988F1 F 1988 14 0.106 ## 2 1988F1 F 1988 21 0.261 ## 3 1988F1 F 1988 28 0.666 ## 4 1988F1 F 1988 35 2.110 ## 5 1988F1 F 1988 42 3.560 ## 6 1988F1 F 1988 49 6.230 plot(Soybean, outer = ~ Year * Variety) (fm1Soy.lis &lt;- nlsList(weight ~ SSlogis(Time, Asym, xmid, scal), data = Soybean)) ## Warning: 2 errors caught in nls(y ~ 1/(1 + exp((xmid - x)/scal)), data = xy, start = list(xmid = aux[[1L]], ## scal = aux[[2L]]), algorithm = &quot;plinear&quot;). The error messages and their frequencies are ## ## step factor 0.000488281 reduced below &#39;minFactor&#39; of 0.000976562 ## 1 ## 지정된 최대 반복수 50를 초과하였습니다 ## 1 ## Call: ## Model: weight ~ SSlogis(Time, Asym, xmid, scal) | Plot ## Data: Soybean ## ## Coefficients: ## Asym xmid scal ## 1988F4 15.1516 52.834 5.1768 ## 1988F2 19.7454 56.575 8.4066 ## 1988F1 20.3384 57.402 9.6047 ## 1988F7 19.8712 56.162 8.0693 ## 1988F5 30.6489 64.130 11.2628 ## 1988F8 22.7770 59.330 9.0006 ## 1988F6 23.2931 59.598 9.7188 ## 1988F3 23.6971 56.425 7.6424 ## 1988P1 17.3005 48.849 6.3624 ## 1988P5 17.7038 51.272 6.8091 ## 1988P4 24.0089 57.751 11.7447 ## 1988P8 28.2496 62.980 10.9471 ## 1988P7 27.4860 61.498 10.1778 ## 1988P3 24.9390 56.325 8.3159 ## 1988P2 36.6612 66.561 11.9161 ## 1988P6 163.7029 104.973 17.9297 ## 1989F6 8.5093 55.273 8.8561 ## 1989F5 9.6691 51.267 7.2059 ## 1989F4 11.2475 53.810 6.4866 ## 1989F1 11.2511 56.626 6.0681 ## 1989F2 11.2333 52.240 7.0164 ## 1989F7 10.0714 51.378 5.5002 ## 1989F8 10.6095 47.968 5.9609 ## 1989F3 18.4196 66.124 9.2248 ## 1989P7 15.4719 46.343 5.3939 ## 1989P4 18.1775 57.180 8.4021 ## 1989P6 20.4988 58.238 10.6135 ## 1989P5 NA NA NA ## 1989P1 21.6840 59.693 9.9728 ## 1989P3 22.2838 53.396 7.9006 ## 1989P2 28.2970 67.175 12.5235 ## 1989P8 NA NA NA ## 1990F2 19.4591 66.285 13.1572 ## 1990F3 19.8679 58.278 12.7963 ## 1990F4 27.4355 70.272 14.5602 ## 1990F5 18.7195 51.276 7.7584 ## 1990F1 19.7907 55.693 9.6170 ## 1990F8 20.2904 55.549 7.7711 ## 1990F7 19.8353 54.736 6.7922 ## 1990F6 21.1971 54.562 9.2636 ## 1990P8 18.5135 52.448 8.5810 ## 1990P7 19.1608 54.802 10.8473 ## 1990P3 19.1981 49.715 9.3223 ## 1990P1 18.4484 47.917 6.6118 ## 1990P6 17.6897 50.230 6.6269 ## 1990P5 19.5449 51.150 7.2932 ## 1990P2 25.7872 62.360 11.6569 ## 1990P4 26.1289 61.199 10.9715 ## ## Degrees of freedom: 396 total; 258 residual ## Residual standard error: 1.0209 (fm1Soy.nlme &lt;- nlme(fm1Soy.lis)) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: weight ~ SSlogis(Time, Asym, xmid, scal) ## Data: Soybean ## Log-likelihood: -739.84 ## Fixed: list(Asym ~ 1, xmid ~ 1, scal ~ 1) ## Asym xmid scal ## 19.2530 55.0198 8.4033 ## ## Random effects: ## Formula: list(Asym ~ 1, xmid ~ 1, scal ~ 1) ## Level: Plot ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## Asym 5.2012 Asym xmid ## xmid 4.1974 0.721 ## scal 1.4047 0.711 0.958 ## Residual 1.1235 ## ## Number of Observations: 412 ## Number of Groups: 48 fm2Soy.nlme &lt;- update(fm1Soy.nlme, weights = varPower()) ## Warning in (function (model, data = sys.frame(sys.parent()), ## fixed, random, : Iteration 1, LME step: nlminb() did not converge ## (code = 1). Do increase &#39;msMaxIter&#39;! ## Warning in (function (model, data = sys.frame(sys.parent()), ## fixed, random, : Iteration 6, LME step: nlminb() did not converge ## (code = 1). PORT message: false convergence (8) anova(fm1Soy.nlme, fm2Soy.nlme) ## Model df AIC BIC logLik Test L.Ratio ## fm1Soy.nlme 1 10 1499.67 1539.88 -739.84 ## fm2Soy.nlme 2 11 745.71 789.94 -361.86 1 vs 2 755.96 ## p-value ## fm1Soy.nlme ## fm2Soy.nlme &lt;.0001 plot(ranef(fm2Soy.nlme, augFrame = TRUE), form = ~ Year * Variety, layout = c(3,1)) soyFix &lt;- fixef(fm2Soy.nlme) options(contrasts = c(&quot;contr.treatment&quot;, &quot;contr.poly&quot;)) (fm3Soy.nlme &lt;- update(fm2Soy.nlme, fixed = Asym + xmid + scal ~ Year, start = c(soyFix[1], 0, 0, soyFix[2], 0, 0, soyFix[3], 0, 0))) ## Warning in (function (model, data = sys.frame(sys.parent()), ## fixed, random, : Iteration 1, LME step: nlminb() did not converge ## (code = 1). Do increase &#39;msMaxIter&#39;! ## Warning in (function (model, data = sys.frame(sys.parent()), ## fixed, random, : Iteration 6, LME step: nlminb() did not converge ## (code = 1). PORT message: false convergence (8) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: weight ~ SSlogis(Time, Asym, xmid, scal) ## Data: Soybean ## Log-likelihood: -326.01 ## Fixed: Asym + xmid + scal ~ Year ## Asym.(Intercept) Asym.Year1989 Asym.Year1990 ## 20.20758 -6.30311 -3.46519 ## xmid.(Intercept) xmid.Year1989 xmid.Year1990 ## 54.09913 -2.48046 -4.84821 ## scal.(Intercept) scal.Year1989 scal.Year1990 ## 8.05131 -0.93200 -0.66174 ## ## Random effects: ## Formula: list(Asym ~ 1, xmid ~ 1, scal ~ 1) ## Level: Plot ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## Asym.(Intercept) 2.7111e+00 As.(I) xm.(I) ## xmid.(Intercept) 7.3512e-12 0.992 ## scal.(Intercept) 1.0788e-01 0.999 0.993 ## Residual 2.1626e-01 ## ## Variance function: ## Structure: Power of variance covariate ## Formula: ~fitted(.) ## Parameter estimates: ## power ## 0.95011 ## Number of Observations: 412 ## Number of Groups: 48 anova(fm3Soy.nlme) ## numDF denDF F-value p-value ## Asym.(Intercept) 1 356 2057.4 &lt;.0001 ## Asym.Year 2 356 102.9 &lt;.0001 ## xmid.(Intercept) 1 356 11420.4 &lt;.0001 ## xmid.Year 2 356 9.4 1e-04 ## scal.(Intercept) 1 356 7967.3 &lt;.0001 ## scal.Year 2 356 11.1 &lt;.0001 # The following line is not in the book but needed to fit the model fm4Soy.nlme &lt;- nlme(weight ~ SSlogis(Time, Asym, xmid, scal), data = Soybean, fixed = list(Asym ~ Year*Variety, xmid ~ Year + Variety, scal ~ Year), random = Asym ~ 1, start = c(17, 0, 0, 0, 0, 0, 52, 0, 0, 0, 7.5, 0, 0), weights = varPower(0.95), control = list(verbose = TRUE)) # FIXME: An update doesn&#39;t work for the fixed argument when fixed is a list summary(fm4Soy.nlme) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: weight ~ SSlogis(Time, Asym, xmid, scal) ## Data: Soybean ## AIC BIC logLik ## 616.31 680.65 -292.15 ## ## Random effects: ## Formula: Asym ~ 1 | Plot ## Asym.(Intercept) Residual ## StdDev: 1.0359 0.21803 ## ## Variance function: ## Structure: Power of variance covariate ## Formula: ~fitted(.) ## Parameter estimates: ## power ## 0.94262 ## Fixed effects: list(Asym ~ Year * Variety, xmid ~ Year + Variety, scal ~ Year) ## Value Std.Error DF t-value p-value ## Asym.(Intercept) 19.434 0.95374 352 20.377 0.0000 ## Asym.Year1989 -8.842 1.07212 352 -8.247 0.0000 ## Asym.Year1990 -3.707 1.17700 352 -3.150 0.0018 ## Asym.VarietyP 1.623 1.03824 352 1.563 0.1189 ## Asym.Year1989:VarietyP 5.571 1.17084 352 4.758 0.0000 ## Asym.Year1990:VarietyP 0.147 1.17570 352 0.125 0.9004 ## xmid.(Intercept) 54.815 0.75475 352 72.627 0.0000 ## xmid.Year1989 -2.238 0.97170 352 -2.303 0.0218 ## xmid.Year1990 -4.970 0.97425 352 -5.102 0.0000 ## xmid.VarietyP -1.297 0.41436 352 -3.131 0.0019 ## scal.(Intercept) 8.063 0.14723 352 54.766 0.0000 ## scal.Year1989 -0.895 0.20127 352 -4.448 0.0000 ## scal.Year1990 -0.673 0.21217 352 -3.173 0.0016 ## Correlation: ## As.(I) As.Y1989 As.Y1990 Asy.VP A.Y1989: ## Asym.Year1989 -0.831 ## Asym.Year1990 -0.736 0.646 ## Asym.VarietyP -0.532 0.374 0.304 ## Asym.Year1989:VarietyP 0.339 -0.403 -0.249 -0.662 ## Asym.Year1990:VarietyP 0.318 -0.273 -0.447 -0.627 0.533 ## xmid.(Intercept) 0.729 -0.595 -0.523 -0.144 0.007 ## xmid.Year1989 -0.488 0.603 0.394 -0.021 0.133 ## xmid.Year1990 -0.489 0.433 0.661 -0.016 0.020 ## xmid.VarietyP -0.337 0.127 0.052 0.572 -0.114 ## scal.(Intercept) 0.432 -0.381 -0.345 0.023 -0.029 ## scal.Year1989 -0.311 0.369 0.252 -0.025 0.090 ## scal.Year1990 -0.296 0.263 0.398 -0.023 0.022 ## A.Y1990: xm.(I) x.Y198 x.Y199 xmd.VP ## Asym.Year1989 ## Asym.Year1990 ## Asym.VarietyP ## Asym.Year1989:VarietyP ## Asym.Year1990:VarietyP ## xmid.(Intercept) -0.011 ## xmid.Year1989 0.021 -0.705 ## xmid.Year1990 0.054 -0.706 0.545 ## xmid.VarietyP -0.057 -0.308 0.006 0.015 ## scal.(Intercept) -0.031 0.817 -0.629 -0.628 -0.022 ## scal.Year1989 0.023 -0.593 0.855 0.459 0.002 ## scal.Year1990 0.048 -0.563 0.437 0.840 0.004 ## sc.(I) s.Y198 ## Asym.Year1989 ## Asym.Year1990 ## Asym.VarietyP ## Asym.Year1989:VarietyP ## Asym.Year1990:VarietyP ## xmid.(Intercept) ## xmid.Year1989 ## xmid.Year1990 ## xmid.VarietyP ## scal.(Intercept) ## scal.Year1989 -0.731 ## scal.Year1990 -0.694 0.507 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.62787 -0.60802 -0.12370 0.56951 3.91853 ## ## Number of Observations: 412 ## Number of Groups: 48 plot(augPred(fm4Soy.nlme)) # 6.4 Clinical Study of Phenobarbital Kinetics (fm1Pheno.nlme &lt;- nlme(conc ~ phenoModel(Subject, time, dose, lCl, lV), data = Phenobarb, fixed = lCl + lV ~ 1, random = pdDiag(lCl + lV ~ 1), start = c(-5, 0), na.action = NULL, naPattern = ~ !is.na(conc))) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: conc ~ phenoModel(Subject, time, dose, lCl, lV) ## Data: Phenobarb ## Log-likelihood: -505.42 ## Fixed: lCl + lV ~ 1 ## lCl lV ## -5.09324 0.34253 ## ## Random effects: ## Formula: list(lCl ~ 1, lV ~ 1) ## Level: Subject ## Structure: Diagonal ## lCl lV Residual ## StdDev: 0.44021 0.45044 2.7927 ## ## Number of Observations: 155 ## Number of Groups: 59 fm1Pheno.ranef &lt;- ranef(fm1Pheno.nlme, augFrame = TRUE) # FIXME: these plots encounter difficulties plot(fm1Pheno.ranef, form = lCl ~ Wt + ApgarInd) plot(fm1Pheno.ranef, form = lV ~ Wt + ApgarInd) options(contrasts = c(&quot;contr.treatment&quot;, &quot;contr.poly&quot;)) ## This fit just ping-pongs ##fm2Pheno.nlme &lt;- ## update(fm1Pheno.nlme, ## fixed = list(lCl ~ Wt, lV ~ Wt + ApgarInd), ## start = c(-5.0935, 0, 0.34259, 0, 0), ## control = list(pnlsTol = 1e-4, maxIter = 500, ## msVerbose = TRUE)) ##summary(fm2Pheno.nlme) ##fm3Pheno.nlme &lt;- ## update(fm2Pheno.nlme, ## fixed = lCl + lV ~ Wt, ## start = fixef(fm2Pheno.nlme)[-5]) ##plot(fm3Pheno.nlme, conc ~ fitted(.), abline = c(0,1)) # cleanup proc.time() ## user system elapsed ## 72.57 2.51 80.23 "],
["chapter-8.html", "7 Chapter 8", " 7 Chapter 8 #-*- R -*- # initialization library(nlme) library(lattice) options(width = 65, digits = 5) options(contrasts = c(unordered = &quot;contr.helmert&quot;, ordered = &quot;contr.poly&quot;)) #pdf(file = &quot;ch08.pdf&quot;) # Chapter 8 Fitting Nonlinear Mixed-Effects Models # 8.1 Fitting Nonlinear Models in S with nls and nlsList ## outer = ~1 is used to display all five curves in one panel plot(Orange, outer = ~1) logist &lt;- function(x, Asym, xmid, scal) Asym/(1 + exp(-(x - xmid)/scal)) logist &lt;- deriv(~Asym/(1+exp(-(x-xmid)/scal)), c(&quot;Asym&quot;, &quot;xmid&quot;, &quot;scal&quot;), function(x, Asym, xmid, scal){}) Asym &lt;- 180; xmid &lt;- 700; scal &lt;- 300 logist(Orange$age[1:7], Asym, xmid, scal) ## [1] 22.617 58.931 84.606 132.061 153.802 162.681 170.962 ## attr(,&quot;gradient&quot;) ## Asym xmid scal ## [1,] 0.12565 -0.065916 0.127878 ## [2,] 0.32739 -0.132124 0.095129 ## [3,] 0.47004 -0.149461 0.017935 ## [4,] 0.73367 -0.117238 -0.118802 ## [5,] 0.85446 -0.074616 -0.132070 ## [6,] 0.90378 -0.052175 -0.116872 ## [7,] 0.94979 -0.028614 -0.084125 fm1Oran.nls &lt;- nls(circumference ~ logist(age, Asym, xmid, scal), data = Orange, start = c(Asym = 170, xmid = 700, scal = 500)) summary(fm1Oran.nls) ## ## Formula: circumference ~ logist(age, Asym, xmid, scal) ## ## Parameters: ## Estimate Std. Error t value Pr(&gt;|t|) ## Asym 192.7 20.2 9.52 7.5e-11 *** ## xmid 728.8 107.3 6.79 1.1e-07 *** ## scal 353.5 81.5 4.34 0.00013 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 23.4 on 32 degrees of freedom ## ## Number of iterations to convergence: 5 ## Achieved convergence tolerance: 4.39e-06 plot(fm1Oran.nls) plot(fm1Oran.nls, Tree ~ resid(.), abline = 0) Orange.sortAvg &lt;- sortedXyData(&quot;age&quot;, &quot;circumference&quot;, Orange) Orange.sortAvg ## x y ## 1 118 31.0 ## 2 484 57.8 ## 3 664 93.2 ## 4 1004 134.2 ## 5 1231 145.6 ## 6 1372 173.4 ## 7 1582 175.8 NLSstClosestX(Orange.sortAvg, 130) ## [1] 969.17 logistInit &lt;- function(mCall, LHS, data) { xy &lt;- sortedXyData(mCall[[&quot;x&quot;]], LHS, data) if(nrow(xy) &lt; 3) { stop(&quot;Too few distinct input values to fit a logistic&quot;) } Asym &lt;- max(abs(xy[,&quot;y&quot;])) if (Asym != max(xy[,&quot;y&quot;])) Asym &lt;- -Asym # negative asymptote xmid &lt;- NLSstClosestX(xy, 0.5 * Asym) scal &lt;- NLSstClosestX(xy, 0.75 * Asym) - xmid value &lt;- c(Asym, xmid, scal) names(value) &lt;- mCall[c(&quot;Asym&quot;, &quot;xmid&quot;, &quot;scal&quot;)] value } logist &lt;- selfStart(logist, initial = logistInit) class(logist) ## [1] &quot;selfStart&quot; logist &lt;- selfStart(~ Asym/(1 + exp(-(x - xmid)/scal)), initial = logistInit, parameters = c(&quot;Asym&quot;, &quot;xmid&quot;, &quot;scal&quot;)) getInitial(circumference ~ logist(age, Asym, xmid, scal), Orange) ## Asym xmid scal ## 175.80 637.05 347.46 nls(circumference ~ logist(age, Asym, xmid, scal), Orange) ## Nonlinear regression model ## model: circumference ~ logist(age, Asym, xmid, scal) ## data: Orange ## Asym xmid scal ## 193 729 354 ## residual sum-of-squares: 17480 ## ## Number of iterations to convergence: 4 ## Achieved convergence tolerance: 8.63e-07 getInitial(circumference ~ SSlogis(age,Asym,xmid,scal), Orange) ## Asym xmid scal ## 192.69 728.76 353.53 nls(circumference ~ SSlogis(age, Asym, xmid, scal), Orange) ## Nonlinear regression model ## model: circumference ~ SSlogis(age, Asym, xmid, scal) ## data: Orange ## Asym xmid scal ## 193 729 354 ## residual sum-of-squares: 17480 ## ## Number of iterations to convergence: 0 ## Achieved convergence tolerance: 2.21e-06 fm1Oran.lis &lt;- nlsList(circumference ~ SSlogis(age, Asym, xmid, scal) | Tree, data = Orange) fm1Oran.lis &lt;- nlsList(SSlogis, Orange) fm1Oran.lis.noSS &lt;- nlsList(circumference ~ Asym/(1+exp(-(age-xmid)/scal)), data = Orange, start = c(Asym = 170, xmid = 700, scal = 500)) fm1Oran.lis ## Call: ## Model: circumference ~ SSlogis(age, Asym, xmid, scal) | Tree ## Data: Orange ## ## Coefficients: ## Asym xmid scal ## 3 158.83 734.84 400.95 ## 1 154.16 627.19 362.57 ## 5 207.26 861.30 379.95 ## 2 219.00 700.35 332.49 ## 4 225.30 710.71 303.14 ## ## Degrees of freedom: 35 total; 20 residual ## Residual standard error: 7.98 summary(fm1Oran.lis) ## Call: ## Model: circumference ~ SSlogis(age, Asym, xmid, scal) | Tree ## Data: Orange ## ## Coefficients: ## Asym ## Estimate Std. Error t value Pr(&gt;|t|) ## 3 158.83 19.235 8.2574 0.00046020 ## 1 154.16 13.594 11.3404 0.00016902 ## 5 207.26 22.023 9.4111 0.00073756 ## 2 219.00 13.359 16.3938 0.00010521 ## 4 225.30 11.839 19.0299 0.00010404 ## xmid ## Estimate Std. Error t value Pr(&gt;|t|) ## 3 734.84 130.807 5.6178 0.00201061 ## 1 627.19 92.893 6.7518 0.00126293 ## 5 861.30 107.991 7.9757 0.00138949 ## 2 700.35 61.350 11.4155 0.00043456 ## 4 710.71 51.172 13.8887 0.00035794 ## scal ## Estimate Std. Error t value Pr(&gt;|t|) ## 3 400.95 94.776 4.2306 0.0057139 ## 1 362.57 81.205 4.4649 0.0058611 ## 5 379.95 66.751 5.6920 0.0048740 ## 2 332.49 49.385 6.7326 0.0032407 ## 4 303.14 41.611 7.2852 0.0041511 ## ## Residual standard error: 7.98 on 20 degrees of freedom plot(intervals(fm1Oran.lis), layout = c(3,1)) plot(fm1Oran.lis, Tree ~ resid(.), abline = 0) Theoph[1:4,] ## Grouped Data: conc ~ Time | Subject ## Subject Wt Dose Time conc ## 1 1 79.6 4.02 0.00 0.74 ## 2 1 79.6 4.02 0.25 2.84 ## 3 1 79.6 4.02 0.57 6.57 ## 4 1 79.6 4.02 1.12 10.50 fm1Theo.lis &lt;- nlsList(conc ~ SSfol(Dose, Time, lKe, lKa, lCl), data = Theoph) fm1Theo.lis ## Call: ## Model: conc ~ SSfol(Dose, Time, lKe, lKa, lCl) | Subject ## Data: Theoph ## ## Coefficients: ## lKe lKa lCl ## 6 -2.3073 0.15162 -2.9732 ## 7 -2.2804 -0.38605 -2.9643 ## 8 -2.3864 0.31883 -3.0691 ## 11 -2.3215 1.34782 -2.8604 ## 3 -2.5081 0.89754 -3.2300 ## 2 -2.2861 0.66406 -3.1063 ## 4 -2.4365 0.15826 -3.2861 ## 9 -2.4461 2.18219 -3.4208 ## 12 -2.2483 -0.18284 -3.1702 ## 10 -2.6041 -0.36312 -3.4283 ## 1 -2.9196 0.57516 -3.9159 ## 5 -2.4255 0.38629 -3.1326 ## ## Degrees of freedom: 132 total; 96 residual ## Residual standard error: 0.70019 plot(intervals(fm1Theo.lis), layout = c(3,1)) pairs(fm1Theo.lis, id = 0.1) # 8.2 Fitting Nonlinear Mixed-Effects Models with nlme ## no need to specify groups, as Orange is a groupedData object ## random is omitted - by default it is equal to fixed (fm1Oran.nlme &lt;- nlme(circumference ~ SSlogis(age, Asym, xmid, scal), data = Orange, fixed = Asym + xmid + scal ~ 1, start = fixef(fm1Oran.lis))) ## Warning in nlme.formula(circumference ~ SSlogis(age, Asym, xmid, ## scal), : Iteration 1, LME step: nlminb() did not converge (code = ## 1). Do increase &#39;msMaxIter&#39;! ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: circumference ~ SSlogis(age, Asym, xmid, scal) ## Data: Orange ## Log-likelihood: -129.99 ## Fixed: Asym + xmid + scal ~ 1 ## Asym xmid scal ## 192.10 727.60 356.61 ## ## Random effects: ## Formula: list(Asym ~ 1, xmid ~ 1, scal ~ 1) ## Level: Tree ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## Asym 27.0508 Asym xmid ## xmid 24.2521 -0.328 ## scal 36.6009 -0.992 0.443 ## Residual 7.3216 ## ## Number of Observations: 35 ## Number of Groups: 5 summary(fm1Oran.nlme) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: circumference ~ SSlogis(age, Asym, xmid, scal) ## Data: Orange ## AIC BIC logLik ## 279.98 295.53 -129.99 ## ## Random effects: ## Formula: list(Asym ~ 1, xmid ~ 1, scal ~ 1) ## Level: Tree ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## Asym 27.0508 Asym xmid ## xmid 24.2521 -0.328 ## scal 36.6009 -0.992 0.443 ## Residual 7.3216 ## ## Fixed effects: Asym + xmid + scal ~ 1 ## Value Std.Error DF t-value p-value ## Asym 192.10 14.052 28 13.670 0 ## xmid 727.60 34.587 28 21.037 0 ## scal 356.61 30.499 28 11.693 0 ## Correlation: ## Asym xmid ## xmid 0.277 ## scal -0.193 0.665 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -1.81870 -0.52152 0.17421 0.51768 1.64528 ## ## Number of Observations: 35 ## Number of Groups: 5 summary(fm1Oran.nls) ## ## Formula: circumference ~ logist(age, Asym, xmid, scal) ## ## Parameters: ## Estimate Std. Error t value Pr(&gt;|t|) ## Asym 192.7 20.2 9.52 7.5e-11 *** ## xmid 728.8 107.3 6.79 1.1e-07 *** ## scal 353.5 81.5 4.34 0.00013 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 23.4 on 32 degrees of freedom ## ## Number of iterations to convergence: 5 ## Achieved convergence tolerance: 4.39e-06 pairs(fm1Oran.nlme) fm2Oran.nlme &lt;- update(fm1Oran.nlme, random = Asym ~ 1) anova(fm1Oran.nlme, fm2Oran.nlme) ## Model df AIC BIC logLik Test L.Ratio ## fm1Oran.nlme 1 10 279.98 295.54 -129.99 ## fm2Oran.nlme 2 5 273.17 280.95 -131.59 1 vs 2 3.1876 ## p-value ## fm1Oran.nlme ## fm2Oran.nlme 0.6711 plot(fm1Oran.nlme) ## level = 0:1 requests fixed (0) and within-group (1) predictions plot(augPred(fm2Oran.nlme, level = 0:1), layout = c(5,1)) qqnorm(fm2Oran.nlme, abline = c(0,1)) (fm1Theo.nlme &lt;- nlme(fm1Theo.lis)) ## Warning in (function (model, data = sys.frame(sys.parent()), ## fixed, random, : Iteration 2, LME step: nlminb() did not converge ## (code = 1). Do increase &#39;msMaxIter&#39;! ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: conc ~ SSfol(Dose, Time, lKe, lKa, lCl) ## Data: Theoph ## Log-likelihood: -173.32 ## Fixed: list(lKe ~ 1, lKa ~ 1, lCl ~ 1) ## lKe lKa lCl ## -2.43267 0.45141 -3.21445 ## ## Random effects: ## Formula: list(lKe ~ 1, lKa ~ 1, lCl ~ 1) ## Level: Subject ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## lKe 0.13104 lKe lKa ## lKa 0.63778 0.012 ## lCl 0.25118 0.995 -0.089 ## Residual 0.68183 ## ## Number of Observations: 132 ## Number of Groups: 12 if (interactive()) intervals(fm1Theo.nlme, which = &quot;var-cov&quot;) (fm2Theo.nlme &lt;- update(fm1Theo.nlme, random = pdDiag(lKe + lKa + lCl ~ 1))) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: conc ~ SSfol(Dose, Time, lKe, lKa, lCl) ## Data: Theoph ## Log-likelihood: -177.02 ## Fixed: list(lKe ~ 1, lKa ~ 1, lCl ~ 1) ## lKe lKa lCl ## -2.4546 0.4655 -3.2272 ## ## Random effects: ## Formula: list(lKe ~ 1, lKa ~ 1, lCl ~ 1) ## Level: Subject ## Structure: Diagonal ## lKe lKa lCl Residual ## StdDev: 1.9302e-05 0.64386 0.16692 0.70923 ## ## Number of Observations: 132 ## Number of Groups: 12 fm3Theo.nlme &lt;- update(fm2Theo.nlme, random = pdDiag(lKa + lCl ~ 1)) anova(fm1Theo.nlme, fm3Theo.nlme, fm2Theo.nlme) ## Model df AIC BIC logLik Test L.Ratio ## fm1Theo.nlme 1 10 366.64 395.47 -173.32 ## fm3Theo.nlme 2 6 366.04 383.34 -177.02 1 vs 2 7.4012 ## fm2Theo.nlme 3 7 368.05 388.23 -177.02 2 vs 3 0.0041 ## p-value ## fm1Theo.nlme ## fm3Theo.nlme 0.1161 ## fm2Theo.nlme 0.9488 plot(fm3Theo.nlme) qqnorm(fm3Theo.nlme, ~ ranef(.)) CO2 ## Grouped Data: uptake ~ conc | Plant ## Plant Type Treatment conc uptake ## 1 Qn1 Quebec nonchilled 95 16.0 ## 2 Qn1 Quebec nonchilled 175 30.4 ## 3 Qn1 Quebec nonchilled 250 34.8 ## 4 Qn1 Quebec nonchilled 350 37.2 ## 5 Qn1 Quebec nonchilled 500 35.3 ## 6 Qn1 Quebec nonchilled 675 39.2 ## 7 Qn1 Quebec nonchilled 1000 39.7 ## 8 Qn2 Quebec nonchilled 95 13.6 ## 9 Qn2 Quebec nonchilled 175 27.3 ## 10 Qn2 Quebec nonchilled 250 37.1 ## 11 Qn2 Quebec nonchilled 350 41.8 ## 12 Qn2 Quebec nonchilled 500 40.6 ## 13 Qn2 Quebec nonchilled 675 41.4 ## 14 Qn2 Quebec nonchilled 1000 44.3 ## 15 Qn3 Quebec nonchilled 95 16.2 ## 16 Qn3 Quebec nonchilled 175 32.4 ## 17 Qn3 Quebec nonchilled 250 40.3 ## 18 Qn3 Quebec nonchilled 350 42.1 ## 19 Qn3 Quebec nonchilled 500 42.9 ## 20 Qn3 Quebec nonchilled 675 43.9 ## 21 Qn3 Quebec nonchilled 1000 45.5 ## 22 Qc1 Quebec chilled 95 14.2 ## 23 Qc1 Quebec chilled 175 24.1 ## 24 Qc1 Quebec chilled 250 30.3 ## 25 Qc1 Quebec chilled 350 34.6 ## 26 Qc1 Quebec chilled 500 32.5 ## 27 Qc1 Quebec chilled 675 35.4 ## 28 Qc1 Quebec chilled 1000 38.7 ## 29 Qc2 Quebec chilled 95 9.3 ## 30 Qc2 Quebec chilled 175 27.3 ## 31 Qc2 Quebec chilled 250 35.0 ## 32 Qc2 Quebec chilled 350 38.8 ## 33 Qc2 Quebec chilled 500 38.6 ## 34 Qc2 Quebec chilled 675 37.5 ## 35 Qc2 Quebec chilled 1000 42.4 ## 36 Qc3 Quebec chilled 95 15.1 ## 37 Qc3 Quebec chilled 175 21.0 ## 38 Qc3 Quebec chilled 250 38.1 ## 39 Qc3 Quebec chilled 350 34.0 ## 40 Qc3 Quebec chilled 500 38.9 ## 41 Qc3 Quebec chilled 675 39.6 ## 42 Qc3 Quebec chilled 1000 41.4 ## 43 Mn1 Mississippi nonchilled 95 10.6 ## 44 Mn1 Mississippi nonchilled 175 19.2 ## 45 Mn1 Mississippi nonchilled 250 26.2 ## 46 Mn1 Mississippi nonchilled 350 30.0 ## 47 Mn1 Mississippi nonchilled 500 30.9 ## 48 Mn1 Mississippi nonchilled 675 32.4 ## 49 Mn1 Mississippi nonchilled 1000 35.5 ## 50 Mn2 Mississippi nonchilled 95 12.0 ## 51 Mn2 Mississippi nonchilled 175 22.0 ## 52 Mn2 Mississippi nonchilled 250 30.6 ## 53 Mn2 Mississippi nonchilled 350 31.8 ## 54 Mn2 Mississippi nonchilled 500 32.4 ## 55 Mn2 Mississippi nonchilled 675 31.1 ## 56 Mn2 Mississippi nonchilled 1000 31.5 ## 57 Mn3 Mississippi nonchilled 95 11.3 ## 58 Mn3 Mississippi nonchilled 175 19.4 ## 59 Mn3 Mississippi nonchilled 250 25.8 ## 60 Mn3 Mississippi nonchilled 350 27.9 ## 61 Mn3 Mississippi nonchilled 500 28.5 ## 62 Mn3 Mississippi nonchilled 675 28.1 ## 63 Mn3 Mississippi nonchilled 1000 27.8 ## 64 Mc1 Mississippi chilled 95 10.5 ## 65 Mc1 Mississippi chilled 175 14.9 ## 66 Mc1 Mississippi chilled 250 18.1 ## 67 Mc1 Mississippi chilled 350 18.9 ## 68 Mc1 Mississippi chilled 500 19.5 ## 69 Mc1 Mississippi chilled 675 22.2 ## 70 Mc1 Mississippi chilled 1000 21.9 ## 71 Mc2 Mississippi chilled 95 7.7 ## 72 Mc2 Mississippi chilled 175 11.4 ## 73 Mc2 Mississippi chilled 250 12.3 ## 74 Mc2 Mississippi chilled 350 13.0 ## 75 Mc2 Mississippi chilled 500 12.5 ## 76 Mc2 Mississippi chilled 675 13.7 ## 77 Mc2 Mississippi chilled 1000 14.4 ## 78 Mc3 Mississippi chilled 95 10.6 ## 79 Mc3 Mississippi chilled 175 18.0 ## 80 Mc3 Mississippi chilled 250 17.9 ## 81 Mc3 Mississippi chilled 350 17.9 ## 82 Mc3 Mississippi chilled 500 17.9 ## 83 Mc3 Mississippi chilled 675 18.9 ## 84 Mc3 Mississippi chilled 1000 19.9 plot(CO2, outer = ~Treatment*Type, layout = c(4,1)) (fm1CO2.lis &lt;- nlsList(SSasympOff, CO2)) ## Call: ## Model: uptake ~ SSasympOff(conc, Asym, lrc, c0) | Plant ## Data: CO2 ## ## Coefficients: ## Asym lrc c0 ## Qn1 38.140 -4.3806 51.223 ## Qn2 42.872 -4.6657 55.858 ## Qn3 44.228 -4.4861 54.650 ## Qc1 36.429 -4.8617 31.075 ## Qc3 40.684 -4.9452 35.089 ## Qc2 39.819 -4.4638 72.094 ## Mn3 28.483 -4.5916 46.972 ## Mn2 32.128 -4.4662 56.039 ## Mn1 34.085 -5.0646 36.408 ## Mc2 13.555 -4.5609 13.057 ## Mc3 18.535 -3.4652 67.849 ## Mc1 21.787 -5.1423 -20.400 ## ## Degrees of freedom: 84 total; 48 residual ## Residual standard error: 1.7982 (fm1CO2.nlme &lt;- nlme(fm1CO2.lis)) ## Warning in (function (model, data = sys.frame(sys.parent()), ## fixed, random, : Iteration 1, LME step: nlminb() did not converge ## (code = 1). Do increase &#39;msMaxIter&#39;! ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: uptake ~ SSasympOff(conc, Asym, lrc, c0) ## Data: CO2 ## Log-likelihood: -201.31 ## Fixed: list(Asym ~ 1, lrc ~ 1, c0 ~ 1) ## Asym lrc c0 ## 32.4738 -4.6362 43.5461 ## ## Random effects: ## Formula: list(Asym ~ 1, lrc ~ 1, c0 ~ 1) ## Level: Plant ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## Asym 9.51051 Asym lrc ## lrc 0.12842 -0.162 ## c0 10.37887 1.000 -0.141 ## Residual 1.76654 ## ## Number of Observations: 84 ## Number of Groups: 12 (fm2CO2.nlme &lt;- update(fm1CO2.nlme, random = Asym + lrc ~ 1)) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: uptake ~ SSasympOff(conc, Asym, lrc, c0) ## Data: CO2 ## Log-likelihood: -202.76 ## Fixed: list(Asym ~ 1, lrc ~ 1, c0 ~ 1) ## Asym lrc c0 ## 32.4118 -4.5603 49.3436 ## ## Random effects: ## Formula: list(Asym ~ 1, lrc ~ 1) ## Level: Plant ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## Asym 9.65939 Asym ## lrc 0.19951 -0.777 ## Residual 1.80792 ## ## Number of Observations: 84 ## Number of Groups: 12 anova(fm1CO2.nlme, fm2CO2.nlme) ## Model df AIC BIC logLik Test L.Ratio ## fm1CO2.nlme 1 10 422.62 446.93 -201.31 ## fm2CO2.nlme 2 7 419.52 436.53 -202.76 1 vs 2 2.8955 ## p-value ## fm1CO2.nlme ## fm2CO2.nlme 0.408 plot(fm2CO2.nlme,id = 0.05,cex = 0.8,adj = -0.5) fm2CO2.nlmeRE &lt;- ranef(fm2CO2.nlme, augFrame = TRUE) fm2CO2.nlmeRE ## Asym lrc Type Treatment conc uptake ## Qn1 6.17160 0.0483620 Quebec nonchilled 435 33.229 ## Qn2 10.53259 -0.1728430 Quebec nonchilled 435 35.157 ## Qn3 12.21809 -0.0579871 Quebec nonchilled 435 37.614 ## Qc1 3.35212 -0.0755864 Quebec chilled 435 29.971 ## Qc3 7.47431 -0.1924164 Quebec chilled 435 32.586 ## Qc2 7.92847 -0.1803236 Quebec chilled 435 32.700 ## Mn3 -4.07335 0.0334494 Mississippi nonchilled 435 24.114 ## Mn2 -0.14198 0.0056458 Mississippi nonchilled 435 27.343 ## Mn1 0.24066 -0.1938592 Mississippi nonchilled 435 26.400 ## Mc2 -18.79916 0.3193677 Mississippi chilled 435 12.143 ## Mc3 -13.11682 0.2994289 Mississippi chilled 435 17.300 ## Mc1 -11.78652 0.1667619 Mississippi chilled 435 18.000 class(fm2CO2.nlmeRE) ## [1] &quot;ranef.lme&quot; &quot;data.frame&quot; plot(fm2CO2.nlmeRE, form = ~ Type * Treatment) contrasts(CO2$Type) ## [,1] ## Quebec -1 ## Mississippi 1 contrasts(CO2$Treatment) ## [,1] ## nonchilled -1 ## chilled 1 fm3CO2.nlme &lt;- update(fm2CO2.nlme, fixed = list(Asym ~ Type * Treatment, lrc + c0 ~ 1), start = c(32.412, 0, 0, 0, -4.5603, 49.344)) summary(fm3CO2.nlme) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: uptake ~ SSasympOff(conc, Asym, lrc, c0) ## Data: CO2 ## AIC BIC logLik ## 393.68 417.98 -186.84 ## ## Random effects: ## Formula: list(Asym ~ 1, lrc ~ 1) ## Level: Plant ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## Asym.(Intercept) 2.92989 As.(I) ## lrc 0.16374 -0.906 ## Residual 1.84956 ## ## Fixed effects: list(Asym ~ Type * Treatment, lrc + c0 ~ 1) ## Value Std.Error DF t-value p-value ## Asym.(Intercept) 32.447 0.9359 67 34.669 0.0000 ## Asym.Type1 -7.107 0.5981 67 -11.884 0.0000 ## Asym.Treatment1 -3.814 0.5884 67 -6.482 0.0000 ## Asym.Type1:Treatment1 -1.195 0.5885 67 -2.031 0.0462 ## lrc -4.589 0.0848 67 -54.105 0.0000 ## c0 49.482 4.4566 67 11.103 0.0000 ## Correlation: ## As.(I) Asym.Ty1 Asym.Tr1 A.T1:T lrc ## Asym.Type1 -0.044 ## Asym.Treatment1 -0.021 0.151 ## Asym.Type1:Treatment1 -0.023 0.161 0.225 ## lrc -0.660 0.202 0.113 0.132 ## c0 -0.113 0.060 0.018 0.063 0.653 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.892938 -0.461602 -0.032803 0.520763 2.887703 ## ## Number of Observations: 84 ## Number of Groups: 12 anova(fm3CO2.nlme, Terms = 2:4) ## F-test for: Asym.Type, Asym.Treatment, Asym.Type:Treatment ## numDF denDF F-value p-value ## 1 3 67 54.818 &lt;.0001 fm3CO2.nlmeRE &lt;- ranef(fm3CO2.nlme, aug = TRUE) plot(fm3CO2.nlmeRE, form = ~ Type * Treatment) fm3CO2.fix &lt;- fixef(fm3CO2.nlme) fm4CO2.nlme &lt;- update(fm3CO2.nlme, fixed = list(Asym + lrc ~ Type * Treatment, c0 ~ 1), start = c(fm3CO2.fix[1:5], 0, 0, 0, fm3CO2.fix[6])) ## Warning in (function (model, data = sys.frame(sys.parent()), ## fixed, random, : Iteration 1, LME step: nlminb() did not converge ## (code = 1). Do increase &#39;msMaxIter&#39;! summary(fm4CO2.nlme) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: uptake ~ SSasympOff(conc, Asym, lrc, c0) ## Data: CO2 ## AIC BIC logLik ## 388.42 420.02 -181.21 ## ## Random effects: ## Formula: list(Asym ~ 1, lrc ~ 1) ## Level: Plant ## Structure: General positive-definite, Log-Cholesky parametrization ## StdDev Corr ## Asym.(Intercept) 2.349584 As.(I) ## lrc.(Intercept) 0.079545 -0.92 ## Residual 1.792030 ## ## Fixed effects: list(Asym + lrc ~ Type * Treatment, c0 ~ 1) ## Value Std.Error DF t-value p-value ## Asym.(Intercept) 32.342 0.7848 64 41.209 0.0000 ## Asym.Type1 -7.990 0.7785 64 -10.264 0.0000 ## Asym.Treatment1 -4.210 0.7781 64 -5.410 0.0000 ## Asym.Type1:Treatment1 -2.725 0.7780 64 -3.502 0.0008 ## lrc.(Intercept) -4.509 0.0809 64 -55.745 0.0000 ## lrc.Type1 0.133 0.0552 64 2.417 0.0185 ## lrc.Treatment1 0.100 0.0551 64 1.812 0.0746 ## lrc.Type1:Treatment1 0.185 0.0554 64 3.345 0.0014 ## c0 50.513 4.3647 64 11.573 0.0000 ## Correlation: ## As.(I) Asym.Ty1 Asym.Tr1 A.T1:T lr.(I) ## Asym.Type1 -0.017 ## Asym.Treatment1 -0.010 -0.017 ## Asym.Type1:Treatment1 -0.020 -0.006 -0.011 ## lrc.(Intercept) -0.471 0.004 0.001 0.009 ## lrc.Type1 -0.048 -0.548 -0.005 -0.018 0.402 ## lrc.Treatment1 -0.031 -0.004 -0.551 -0.033 0.322 ## lrc.Type1:Treatment1 -0.026 -0.015 -0.032 -0.547 0.351 ## c0 -0.133 0.038 0.020 0.019 0.735 ## lrc.Ty1 lrc.Tr1 l.T1:T ## Asym.Type1 ## Asym.Treatment1 ## Asym.Type1:Treatment1 ## lrc.(Intercept) ## lrc.Type1 ## lrc.Treatment1 0.375 ## lrc.Type1:Treatment1 0.395 0.487 ## c0 0.104 0.083 0.140 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.862148 -0.494306 -0.042384 0.566220 3.040308 ## ## Number of Observations: 84 ## Number of Groups: 12 fm5CO2.nlme &lt;- update(fm4CO2.nlme, random = Asym ~ 1) anova(fm4CO2.nlme, fm5CO2.nlme) ## Model df AIC BIC logLik Test L.Ratio ## fm4CO2.nlme 1 13 388.42 420.02 -181.21 ## fm5CO2.nlme 2 11 387.06 413.79 -182.53 1 vs 2 2.6367 ## p-value ## fm4CO2.nlme ## fm5CO2.nlme 0.2676 CO2$type &lt;- 2 * (as.integer(CO2$Type) - 1.5) CO2$treatment &lt;- 2 * (as.integer(CO2$Treatment) - 1.5) fm1CO2.nls &lt;- nls(uptake ~ SSasympOff(conc, Asym.Intercept + Asym.Type * type + Asym.Treatment * treatment + Asym.TypeTreatment * type * treatment, lrc.Intercept + lrc.Type * type + lrc.Treatment * treatment + lrc.TypeTreatment * type * treatment, c0), data = CO2, start = c(Asym.Intercept = 32.371, Asym.Type = -8.0086, Asym.Treatment = -4.2001, Asym.TypeTreatment = -2.7253, lrc.Intercept = -4.5267, lrc.Type = 0.13112, lrc.Treatment = 0.093928, lrc.TypeTreatment = 0.17941, c0 = 50.126)) anova(fm5CO2.nlme, fm1CO2.nls) ## Model df AIC BIC logLik Test L.Ratio ## fm5CO2.nlme 1 11 387.06 413.79 -182.53 ## fm1CO2.nls 2 10 418.34 442.65 -199.17 1 vs 2 33.289 ## p-value ## fm5CO2.nlme ## fm1CO2.nls &lt;.0001 # plot(augPred(fm5CO2.nlme, level = 0:1), ## FIXME: problem with levels # layout = c(6,2)) ## Actually a problem with contrasts. ## This fit just ping-pongs. #fm1Quin.nlme &lt;- # nlme(conc ~ quinModel(Subject, time, conc, dose, interval, # lV, lKa, lCl), # data = Quinidine, fixed = lV + lKa + lCl ~ 1, # random = pdDiag(lV + lCl ~ 1), groups = ~ Subject, # start = list(fixed = c(5, -0.3, 2)), # na.action = NULL, naPattern = ~ !is.na(conc), verbose = TRUE) #fm1Quin.nlme #fm1Quin.nlmeRE &lt;- ranef(fm1Quin.nlme, aug = TRUE) #fm1Quin.nlmeRE[1:3,] # plot(fm1Quin.nlmeRE, form = lCl ~ Age + Smoke + Ethanol + ## FIXME: problem in max # Weight + Race + Height + glyco + Creatinine + Heart, # control = list(cex.axis = 0.7)) #fm1Quin.fix &lt;- fixef(fm1Quin.nlme) #fm2Quin.nlme &lt;- update(fm1Quin.nlme, # fixed = list(lCl ~ glyco, lKa + lV ~ 1), # start = c(fm1Quin.fix[3], 0, fm1Quin.fix[2:1])) fm2Quin.nlme &lt;- nlme(conc ~ quinModel(Subject, time, conc, dose, interval, lV, lKa, lCl), data = Quinidine, fixed = list(lCl ~ glyco, lV + lKa ~ 1), random = pdDiag(diag(c(0.3,0.3)), form = lV + lCl ~ 1), groups = ~ Subject, start = list(fixed = c(2.5, 0, 5.4, -0.2)), na.action = NULL, naPattern = ~ !is.na(conc)) summary(fm2Quin.nlme) # wrong values ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: conc ~ quinModel(Subject, time, conc, dose, interval, lV, lKa, lCl) ## Data: Quinidine ## AIC BIC logLik ## 892.07 919.29 -439.04 ## ## Random effects: ## Formula: list(lV ~ 1, lCl ~ 1) ## Level: Subject ## Structure: Diagonal ## lV lCl.(Intercept) Residual ## StdDev: 0.0002627 0.27109 0.65106 ## ## Fixed effects: list(lCl ~ glyco, lV + lKa ~ 1) ## Value Std.Error DF t-value p-value ## lCl.(Intercept) 3.1248 0.065491 222 47.714 0.000 ## lCl.glyco -0.5015 0.042816 222 -11.714 0.000 ## lV 5.2721 0.094795 222 55.616 0.000 ## lKa -0.8436 0.303914 222 -2.776 0.006 ## Correlation: ## lC.(I) lCl.gl lV ## lCl.glyco -0.880 ## lV -0.072 0.027 ## lKa -0.272 0.149 0.538 ## ## Standardized Within-Group Residuals: ## Min Q1 Med Q3 Max ## -2.54585 -0.53423 -0.02214 0.50534 3.50158 ## ## Number of Observations: 361 ## Number of Groups: 136 options(contrasts = c(&quot;contr.treatment&quot;, &quot;contr.poly&quot;)) fm2Quin.fix &lt;- fixef(fm2Quin.nlme) ## subsequent fits don&#39;t work #fm3Quin.nlme &lt;- update(fm2Quin.nlme, # fixed = list(lCl ~ glyco + Creatinine, lKa + lV ~ 1), # start = c(fm2Quin.fix[1:2], 0.2, fm2Quin.fix[3:4])) #summary(fm3Quin.nlme) #fm3Quin.fix &lt;- fixef(fm3Quin.nlme) #fm4Quin.nlme &lt;- update(fm3Quin.nlme, # fixed = list(lCl ~ glyco + Creatinine + Weight, lKa + lV ~ 1), # start = c(fm3Quin.fix[1:3], 0, fm3Quin.fix[4:5])) #summary(fm4Quin.nlme) ## This fit just ping-pongs ##fm1Wafer.nlmeR &lt;- ## nlme(current ~ A + B * cos(4.5679 * voltage) + ## C * sin(4.5679 * voltage), data = Wafer, ## fixed = list(A ~ voltage + I(voltage^2), B + C ~ 1), ## random = list(Wafer = A ~ voltage + I(voltage^2), ## Site = pdBlocked(list(A~1, A~voltage+I(voltage^2)-1))), ### start = fixef(fm4Wafer), method = &quot;REML&quot;, control = list(tolerance=1e-2)) ## start = c(-4.255, 5.622, 1.258, -0.09555, 0.10434), ## method = &quot;REML&quot;, control = list(tolerance = 1e-2)) ##fm1Wafer.nlmeR ##fm1Wafer.nlme &lt;- update(fm1Wafer.nlmeR, method = &quot;ML&quot;) (fm2Wafer.nlme &lt;- nlme(current ~ A + B * cos(w * voltage + pi/4), data = Wafer, fixed = list(A ~ voltage + I(voltage^2), B + w ~ 1), random = list(Wafer = pdDiag(list(A ~ voltage + I(voltage^2), B + w ~ 1)), Site = pdDiag(list(A ~ voltage+I(voltage^2), B ~ 1))), start = c(-4.255, 5.622, 1.258, -0.09555, 4.5679))) ## Nonlinear mixed-effects model fit by maximum likelihood ## Model: current ~ A + B * cos(w * voltage + pi/4) ## Data: Wafer ## Log-likelihood: 662.75 ## Fixed: list(A ~ voltage + I(voltage^2), B + w ~ 1) ## A.(Intercept) A.voltage A.I(voltage^2) B ## -4.26538 5.63310 1.25595 -0.14064 ## w ## 4.59331 ## ## Random effects: ## Formula: list(A ~ voltage + I(voltage^2), B ~ 1, w ~ 1) ## Level: Wafer ## Structure: Diagonal ## A.(Intercept) A.voltage A.I(voltage^2) B ## StdDev: 0.12699 0.33706 0.04883 0.0050593 ## w ## StdDev: 5.4811e-05 ## ## Formula: list(A ~ voltage + I(voltage^2), B ~ 1) ## Level: Site %in% Wafer ## Structure: Diagonal ## A.(Intercept) A.voltage A.I(voltage^2) B ## StdDev: 0.061831 0.26875 0.055905 4.4861e-06 ## Residual ## StdDev: 0.0078558 ## ## Number of Observations: 400 ## Number of Groups: ## Wafer Site %in% Wafer ## 10 80 plot(fm2Wafer.nlme, resid(.) ~ voltage | Wafer, panel = function(x, y, ...) { panel.grid() panel.xyplot(x, y) panel.loess(x, y, lty = 2) panel.abline(0, 0) }) ## anova(fm1Wafer.nlme, fm2Wafer.nlme, test = FALSE) # intervals(fm2Wafer.nlme) # 8.3 Extending the Basic nlme Model #fm4Theo.nlme &lt;- update(fm3Theo.nlme, # weights = varConstPower(power = 0.1)) # this fit is way off #fm4Theo.nlme #anova(fm3Theo.nlme, fm4Theo.nlme) #plot(fm4Theo.nlme) ## xlim used to hide an unusually high fitted value and enhance ## visualization of the heteroscedastic pattern # plot(fm4Quin.nlme, xlim = c(0, 6.2)) #fm5Quin.nlme &lt;- update(fm4Quin.nlme, weights = varPower()) #summary(fm5Quin.nlme) #anova(fm4Quin.nlme, fm5Quin.nlme) #plot(fm5Quin.nlme, xlim = c(0, 6.2)) var.nlme &lt;- nlme(follicles ~ A + B * sin(2 * pi * w * Time) + C * cos(2 * pi * w *Time), data = Ovary, fixed = A + B + C + w ~ 1, random = pdDiag(A + B + w ~ 1), # start = c(fixef(fm5Ovar.lme), 1)) start = c(12.18, -3.298, -0.862, 1)) ##fm1Ovar.nlme ##ACF(fm1Ovar.nlme) ##plot(ACF(fm1Ovar.nlme, maxLag = 10), alpha = 0.05) ##fm2Ovar.nlme &lt;- update(fm1Ovar.nlme, correlation = corAR1(0.311)) ##fm3Ovar.nlme &lt;- update(fm1Ovar.nlme, correlation = corARMA(p=0, q=2)) ##anova(fm2Ovar.nlme, fm3Ovar.nlme, test = FALSE) ##intervals(fm2Ovar.nlme) ##fm4Ovar.nlme &lt;- update(fm2Ovar.nlme, random = A ~ 1) ##anova(fm2Ovar.nlme, fm4Ovar.nlme) ##if (interactive()) fm5Ovar.nlme &lt;- update(fm4Ovar.nlme, correlation = corARMA(p=1, q=1)) # anova(fm4Ovar.nlme, fm5Ovar.nlme) # plot(ACF(fm5Ovar.nlme, maxLag = 10, resType = &quot;n&quot;), # alpha = 0.05) # fm5Ovar.lmeML &lt;- update(fm5Ovar.lme, method = &quot;ML&quot;) # intervals(fm5Ovar.lmeML) # fm6Ovar.lmeML &lt;- update(fm5Ovar.lmeML, random = ~1) # anova(fm5Ovar.lmeML, fm6Ovar.lmeML) # anova(fm6Ovar.lmeML, fm5Ovar.nlme) # intervals(fm5Ovar.nlme, which = &quot;fixed&quot;) fm1Dial.lis &lt;- nlsList(rate ~ SSasympOff(pressure, Asym, lrc, c0) | QB, data = Dialyzer) fm1Dial.lis ## Call: ## Model: rate ~ SSasympOff(pressure, Asym, lrc, c0) | QB ## Data: Dialyzer ## ## Coefficients: ## Asym lrc c0 ## 200 44.989 0.76486 0.22424 ## 300 62.217 0.25282 0.22484 ## ## Degrees of freedom: 140 total; 134 residual ## Residual standard error: 3.8043 plot(intervals(fm1Dial.lis)) fm1Dial.gnls &lt;- gnls(rate ~ SSasympOff(pressure, Asym, lrc, c0), data = Dialyzer, params = list(Asym + lrc ~ QB, c0 ~ 1), start = c(53.6, 8.6, 0.51, -0.26, 0.225)) fm1Dial.gnls ## Generalized nonlinear least squares fit ## Model: rate ~ SSasympOff(pressure, Asym, lrc, c0) ## Data: Dialyzer ## Log-likelihood: -382.65 ## ## Coefficients: ## Asym.(Intercept) Asym.QB300 lrc.(Intercept) ## 44.98645 17.24009 0.76558 ## lrc.QB300 c0 ## -0.51368 0.22449 ## ## Degrees of freedom: 140 total; 135 residual ## Residual standard error: 3.7902 Dialyzer$QBcontr &lt;- 2 * (Dialyzer$QB == 300) - 1 fm1Dial.nls &lt;- nls(rate ~ SSasympOff(pressure, Asym.Int + Asym.QB * QBcontr, lrc.Int + lrc.QB * QBcontr, c0), data = Dialyzer, start = c(Asym.Int = 53.6, Asym.QB = 8.6, lrc.Int = 0.51, lrc.QB = -0.26, c0 = 0.225)) summary(fm1Dial.nls) ## ## Formula: rate ~ SSasympOff(pressure, Asym.Int + Asym.QB * QBcontr, lrc.Int + ## lrc.QB * QBcontr, c0) ## ## Parameters: ## Estimate Std. Error t value Pr(&gt;|t|) ## Asym.Int 53.6065 0.7054 75.99 &lt; 2e-16 *** ## Asym.QB 8.6201 0.6792 12.69 &lt; 2e-16 *** ## lrc.Int 0.5087 0.0552 9.21 5.5e-16 *** ## lrc.QB -0.2568 0.0450 -5.70 7.0e-08 *** ## c0 0.2245 0.0106 21.13 &lt; 2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 3.79 on 135 degrees of freedom ## ## Number of iterations to convergence: 4 ## Achieved convergence tolerance: 7.26e-06 logLik(fm1Dial.nls) ## &#39;log Lik.&#39; -382.65 (df=6) plot(fm1Dial.gnls, resid(.) ~ pressure, abline = 0) fm2Dial.gnls &lt;- update(fm1Dial.gnls, weights = varPower(form = ~ pressure)) anova(fm1Dial.gnls, fm2Dial.gnls) ## Model df AIC BIC logLik Test L.Ratio ## fm1Dial.gnls 1 6 777.29 794.94 -382.65 ## fm2Dial.gnls 2 7 748.47 769.07 -367.24 1 vs 2 30.815 ## p-value ## fm1Dial.gnls ## fm2Dial.gnls &lt;.0001 ACF(fm2Dial.gnls, form = ~ 1 | Subject) ## lag ACF ## 1 0 1.0000000 ## 2 1 0.7156705 ## 3 2 0.5045422 ## 4 3 0.2948121 ## 5 4 0.2097493 ## 6 5 0.1385694 ## 7 6 -0.0020188 plot(ACF(fm2Dial.gnls, form = ~ 1 | Subject), alpha = 0.05) fm3Dial.gnls &lt;- update(fm2Dial.gnls, corr = corAR1(0.716, form = ~ 1 | Subject)) fm3Dial.gnls ## Generalized nonlinear least squares fit ## Model: rate ~ SSasympOff(pressure, Asym, lrc, c0) ## Data: Dialyzer ## Log-likelihood: -322.52 ## ## Coefficients: ## Asym.(Intercept) Asym.QB300 lrc.(Intercept) ## 46.91103 16.39980 0.54166 ## lrc.QB300 c0 ## -0.33947 0.21478 ## ## Correlation Structure: AR(1) ## Formula: ~1 | Subject ## Parameter estimate(s): ## Phi ## 0.74441 ## Variance function: ## Structure: Power of variance covariate ## Formula: ~pressure ## Parameter estimates: ## power ## 0.57232 ## Degrees of freedom: 140 total; 135 residual ## Residual standard error: 3.1845 intervals(fm3Dial.gnls) ## Approximate 95% confidence intervals ## ## Coefficients: ## lower est. upper ## Asym.(Intercept) 43.87664 46.91103 49.94542 ## Asym.QB300 11.63269 16.39980 21.16690 ## lrc.(Intercept) 0.43527 0.54166 0.64806 ## lrc.QB300 -0.48743 -0.33947 -0.19151 ## c0 0.20637 0.21478 0.22318 ## attr(,&quot;label&quot;) ## [1] &quot;Coefficients:&quot; ## ## Correlation structure: ## lower est. upper ## Phi 0.62176 0.74441 0.83143 ## attr(,&quot;label&quot;) ## [1] &quot;Correlation structure:&quot; ## ## Variance function: ## lower est. upper ## power 0.44262 0.57232 0.70201 ## attr(,&quot;label&quot;) ## [1] &quot;Variance function:&quot; ## ## Residual standard error: ## lower est. upper ## 2.5923 3.1271 3.7722 anova(fm2Dial.gnls, fm3Dial.gnls) ## Model df AIC BIC logLik Test L.Ratio ## fm2Dial.gnls 1 7 748.47 769.07 -367.24 ## fm3Dial.gnls 2 8 661.04 684.58 -322.52 1 vs 2 89.433 ## p-value ## fm2Dial.gnls ## fm3Dial.gnls &lt;.0001 # restore two fitted models fm2Dial.lme &lt;- lme(rate ~(pressure + I(pressure^2) + I(pressure^3) + I(pressure^4))*QB, Dialyzer, ~ pressure + I(pressure^2), weights = varPower(form = ~ pressure)) fm2Dial.lmeML &lt;- update(fm2Dial.lme, method = &quot;ML&quot;) fm3Dial.gls &lt;- gls(rate ~(pressure + I(pressure^2) + I(pressure^3) + I(pressure^4))*QB, Dialyzer, weights = varPower(form = ~ pressure), corr = corAR1(0.771, form = ~ 1 | Subject)) fm3Dial.glsML &lt;- update(fm3Dial.gls, method = &quot;ML&quot;) anova( fm2Dial.lmeML, fm3Dial.glsML, fm3Dial.gnls, test = FALSE) ## Model df AIC BIC logLik ## fm2Dial.lmeML 1 18 651.75 704.70 -307.87 ## fm3Dial.glsML 2 13 647.56 685.80 -310.78 ## fm3Dial.gnls 3 8 661.04 684.58 -322.52 # cleanup proc.time() ## user system elapsed ## 91.13 3.15 101.68 "]
]
